{"ast":null,"code":"/*! @name videojs-vr @version 1.8.0 @license Apache-2.0 */\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inheritsLoose from '@babel/runtime/helpers/inheritsLoose';\nimport window$1 from 'global/window';\nimport document$1 from 'global/document';\nimport WebVRPolyfill from 'webvr-polyfill';\nimport videojs from 'video.js';\nimport { Matrix4, Vector3, PerspectiveCamera, Quaternion, EventDispatcher, MOUSE, Spherical, Vector2, Euler, Math as Math$1, SphereBufferGeometry, MeshBasicMaterial, BackSide, Mesh, SphereGeometry, BufferGeometry, BoxGeometry, Matrix3, Scene, VideoTexture, LinearFilter, RGBFormat, WebGLRenderer, AudioContext, ShaderMaterial } from 'three';\nvar version = \"1.8.0\";\n/**\n * @author dmarcos / https://github.com/dmarcos\n * @author mrdoob / http://mrdoob.com\n */\n\nvar VRControls = function VRControls(object, onError) {\n  var scope = this;\n  var vrDisplay, vrDisplays;\n  var standingMatrix = new Matrix4();\n  var frameData = null;\n\n  if ('VRFrameData' in window) {\n    frameData = new VRFrameData();\n  }\n\n  function gotVRDisplays(displays) {\n    vrDisplays = displays;\n\n    if (displays.length > 0) {\n      vrDisplay = displays[0];\n    } else {\n      if (onError) onError('VR input not available.');\n    }\n  }\n\n  if (navigator.getVRDisplays) {\n    navigator.getVRDisplays().then(gotVRDisplays).catch(function () {\n      console.warn('VRControls: Unable to get VR Displays');\n    });\n  } // the Rift SDK returns the position in meters\n  // this scale factor allows the user to define how meters\n  // are converted to scene units.\n\n\n  this.scale = 1; // If true will use \"standing space\" coordinate system where y=0 is the\n  // floor and x=0, z=0 is the center of the room.\n\n  this.standing = false; // Distance from the users eyes to the floor in meters. Used when\n  // standing=true but the VRDisplay doesn't provide stageParameters.\n\n  this.userHeight = 1.6;\n\n  this.getVRDisplay = function () {\n    return vrDisplay;\n  };\n\n  this.setVRDisplay = function (value) {\n    vrDisplay = value;\n  };\n\n  this.getVRDisplays = function () {\n    console.warn('VRControls: getVRDisplays() is being deprecated.');\n    return vrDisplays;\n  };\n\n  this.getStandingMatrix = function () {\n    return standingMatrix;\n  };\n\n  this.update = function () {\n    if (vrDisplay) {\n      var pose;\n\n      if (vrDisplay.getFrameData) {\n        vrDisplay.getFrameData(frameData);\n        pose = frameData.pose;\n      } else if (vrDisplay.getPose) {\n        pose = vrDisplay.getPose();\n      }\n\n      if (pose.orientation !== null) {\n        object.quaternion.fromArray(pose.orientation);\n      }\n\n      if (pose.position !== null) {\n        object.position.fromArray(pose.position);\n      } else {\n        object.position.set(0, 0, 0);\n      }\n\n      if (this.standing) {\n        if (vrDisplay.stageParameters) {\n          object.updateMatrix();\n          standingMatrix.fromArray(vrDisplay.stageParameters.sittingToStandingTransform);\n          object.applyMatrix(standingMatrix);\n        } else {\n          object.position.setY(object.position.y + this.userHeight);\n        }\n      }\n\n      object.position.multiplyScalar(scope.scale);\n    }\n  };\n\n  this.dispose = function () {\n    vrDisplay = null;\n  };\n};\n/**\n * @author dmarcos / https://github.com/dmarcos\n * @author mrdoob / http://mrdoob.com\n *\n * WebVR Spec: http://mozvr.github.io/webvr-spec/webvr.html\n *\n * Firefox: http://mozvr.com/downloads/\n * Chromium: https://webvr.info/get-chrome\n */\n\n\nvar VREffect = function VREffect(renderer, onError) {\n  var vrDisplay, vrDisplays;\n  var eyeTranslationL = new Vector3();\n  var eyeTranslationR = new Vector3();\n  var renderRectL, renderRectR;\n  var headMatrix = new Matrix4();\n  var eyeMatrixL = new Matrix4();\n  var eyeMatrixR = new Matrix4();\n  var frameData = null;\n\n  if ('VRFrameData' in window) {\n    frameData = new window.VRFrameData();\n  }\n\n  function gotVRDisplays(displays) {\n    vrDisplays = displays;\n\n    if (displays.length > 0) {\n      vrDisplay = displays[0];\n    } else {\n      if (onError) onError('HMD not available');\n    }\n  }\n\n  if (navigator.getVRDisplays) {\n    navigator.getVRDisplays().then(gotVRDisplays).catch(function () {\n      console.warn('VREffect: Unable to get VR Displays');\n    });\n  } //\n\n\n  this.isPresenting = false;\n  var scope = this;\n  var rendererSize = renderer.getSize();\n  var rendererUpdateStyle = false;\n  var rendererPixelRatio = renderer.getPixelRatio();\n\n  this.getVRDisplay = function () {\n    return vrDisplay;\n  };\n\n  this.setVRDisplay = function (value) {\n    vrDisplay = value;\n  };\n\n  this.getVRDisplays = function () {\n    console.warn('VREffect: getVRDisplays() is being deprecated.');\n    return vrDisplays;\n  };\n\n  this.setSize = function (width, height, updateStyle) {\n    rendererSize = {\n      width: width,\n      height: height\n    };\n    rendererUpdateStyle = updateStyle;\n\n    if (scope.isPresenting) {\n      var eyeParamsL = vrDisplay.getEyeParameters('left');\n      renderer.setPixelRatio(1);\n      renderer.setSize(eyeParamsL.renderWidth * 2, eyeParamsL.renderHeight, false);\n    } else {\n      renderer.setPixelRatio(rendererPixelRatio);\n      renderer.setSize(width, height, updateStyle);\n    }\n  }; // VR presentation\n\n\n  var canvas = renderer.domElement;\n  var defaultLeftBounds = [0.0, 0.0, 0.5, 1.0];\n  var defaultRightBounds = [0.5, 0.0, 0.5, 1.0];\n\n  function onVRDisplayPresentChange() {\n    var wasPresenting = scope.isPresenting;\n    scope.isPresenting = vrDisplay !== undefined && vrDisplay.isPresenting;\n\n    if (scope.isPresenting) {\n      var eyeParamsL = vrDisplay.getEyeParameters('left');\n      var eyeWidth = eyeParamsL.renderWidth;\n      var eyeHeight = eyeParamsL.renderHeight;\n\n      if (!wasPresenting) {\n        rendererPixelRatio = renderer.getPixelRatio();\n        rendererSize = renderer.getSize();\n        renderer.setPixelRatio(1);\n        renderer.setSize(eyeWidth * 2, eyeHeight, false);\n      }\n    } else if (wasPresenting) {\n      renderer.setPixelRatio(rendererPixelRatio);\n      renderer.setSize(rendererSize.width, rendererSize.height, rendererUpdateStyle);\n    }\n  }\n\n  window.addEventListener('vrdisplaypresentchange', onVRDisplayPresentChange, false);\n\n  this.setFullScreen = function (boolean) {\n    return new Promise(function (resolve, reject) {\n      if (vrDisplay === undefined) {\n        reject(new Error('No VR hardware found.'));\n        return;\n      }\n\n      if (scope.isPresenting === boolean) {\n        resolve();\n        return;\n      }\n\n      if (boolean) {\n        resolve(vrDisplay.requestPresent([{\n          source: canvas\n        }]));\n      } else {\n        resolve(vrDisplay.exitPresent());\n      }\n    });\n  };\n\n  this.requestPresent = function () {\n    return this.setFullScreen(true);\n  };\n\n  this.exitPresent = function () {\n    return this.setFullScreen(false);\n  };\n\n  this.requestAnimationFrame = function (f) {\n    if (vrDisplay !== undefined) {\n      return vrDisplay.requestAnimationFrame(f);\n    } else {\n      return window.requestAnimationFrame(f);\n    }\n  };\n\n  this.cancelAnimationFrame = function (h) {\n    if (vrDisplay !== undefined) {\n      vrDisplay.cancelAnimationFrame(h);\n    } else {\n      window.cancelAnimationFrame(h);\n    }\n  };\n\n  this.submitFrame = function () {\n    if (vrDisplay !== undefined && scope.isPresenting) {\n      vrDisplay.submitFrame();\n    }\n  };\n\n  this.autoSubmitFrame = true; // render\n\n  var cameraL = new PerspectiveCamera();\n  cameraL.layers.enable(1);\n  var cameraR = new PerspectiveCamera();\n  cameraR.layers.enable(2);\n\n  this.render = function (scene, camera, renderTarget, forceClear) {\n    if (vrDisplay && scope.isPresenting) {\n      var autoUpdate = scene.autoUpdate;\n\n      if (autoUpdate) {\n        scene.updateMatrixWorld();\n        scene.autoUpdate = false;\n      }\n\n      if (Array.isArray(scene)) {\n        console.warn('VREffect.render() no longer supports arrays. Use object.layers instead.');\n        scene = scene[0];\n      } // When rendering we don't care what the recommended size is, only what the actual size\n      // of the backbuffer is.\n\n\n      var size = renderer.getSize();\n      var layers = vrDisplay.getLayers();\n      var leftBounds;\n      var rightBounds;\n\n      if (layers.length) {\n        var layer = layers[0];\n        leftBounds = layer.leftBounds !== null && layer.leftBounds.length === 4 ? layer.leftBounds : defaultLeftBounds;\n        rightBounds = layer.rightBounds !== null && layer.rightBounds.length === 4 ? layer.rightBounds : defaultRightBounds;\n      } else {\n        leftBounds = defaultLeftBounds;\n        rightBounds = defaultRightBounds;\n      }\n\n      renderRectL = {\n        x: Math.round(size.width * leftBounds[0]),\n        y: Math.round(size.height * leftBounds[1]),\n        width: Math.round(size.width * leftBounds[2]),\n        height: Math.round(size.height * leftBounds[3])\n      };\n      renderRectR = {\n        x: Math.round(size.width * rightBounds[0]),\n        y: Math.round(size.height * rightBounds[1]),\n        width: Math.round(size.width * rightBounds[2]),\n        height: Math.round(size.height * rightBounds[3])\n      };\n\n      if (renderTarget) {\n        renderer.setRenderTarget(renderTarget);\n        renderTarget.scissorTest = true;\n      } else {\n        renderer.setRenderTarget(null);\n        renderer.setScissorTest(true);\n      }\n\n      if (renderer.autoClear || forceClear) renderer.clear();\n      if (camera.parent === null) camera.updateMatrixWorld();\n      camera.matrixWorld.decompose(cameraL.position, cameraL.quaternion, cameraL.scale);\n      cameraR.position.copy(cameraL.position);\n      cameraR.quaternion.copy(cameraL.quaternion);\n      cameraR.scale.copy(cameraL.scale);\n\n      if (vrDisplay.getFrameData) {\n        vrDisplay.depthNear = camera.near;\n        vrDisplay.depthFar = camera.far;\n        vrDisplay.getFrameData(frameData);\n        cameraL.projectionMatrix.elements = frameData.leftProjectionMatrix;\n        cameraR.projectionMatrix.elements = frameData.rightProjectionMatrix;\n        getEyeMatrices(frameData);\n        cameraL.updateMatrix();\n        cameraL.matrix.multiply(eyeMatrixL);\n        cameraL.matrix.decompose(cameraL.position, cameraL.quaternion, cameraL.scale);\n        cameraR.updateMatrix();\n        cameraR.matrix.multiply(eyeMatrixR);\n        cameraR.matrix.decompose(cameraR.position, cameraR.quaternion, cameraR.scale);\n      } else {\n        var eyeParamsL = vrDisplay.getEyeParameters('left');\n        var eyeParamsR = vrDisplay.getEyeParameters('right');\n        cameraL.projectionMatrix = fovToProjection(eyeParamsL.fieldOfView, true, camera.near, camera.far);\n        cameraR.projectionMatrix = fovToProjection(eyeParamsR.fieldOfView, true, camera.near, camera.far);\n        eyeTranslationL.fromArray(eyeParamsL.offset);\n        eyeTranslationR.fromArray(eyeParamsR.offset);\n        cameraL.translateOnAxis(eyeTranslationL, cameraL.scale.x);\n        cameraR.translateOnAxis(eyeTranslationR, cameraR.scale.x);\n      } // render left eye\n\n\n      if (renderTarget) {\n        renderTarget.viewport.set(renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height);\n        renderTarget.scissor.set(renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height);\n      } else {\n        renderer.setViewport(renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height);\n        renderer.setScissor(renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height);\n      }\n\n      renderer.render(scene, cameraL, renderTarget, forceClear); // render right eye\n\n      if (renderTarget) {\n        renderTarget.viewport.set(renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height);\n        renderTarget.scissor.set(renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height);\n      } else {\n        renderer.setViewport(renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height);\n        renderer.setScissor(renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height);\n      }\n\n      renderer.render(scene, cameraR, renderTarget, forceClear);\n\n      if (renderTarget) {\n        renderTarget.viewport.set(0, 0, size.width, size.height);\n        renderTarget.scissor.set(0, 0, size.width, size.height);\n        renderTarget.scissorTest = false;\n        renderer.setRenderTarget(null);\n      } else {\n        renderer.setViewport(0, 0, size.width, size.height);\n        renderer.setScissorTest(false);\n      }\n\n      if (autoUpdate) {\n        scene.autoUpdate = true;\n      }\n\n      if (scope.autoSubmitFrame) {\n        scope.submitFrame();\n      }\n\n      return;\n    } // Regular render mode if not HMD\n\n\n    renderer.render(scene, camera, renderTarget, forceClear);\n  };\n\n  this.dispose = function () {\n    window.removeEventListener('vrdisplaypresentchange', onVRDisplayPresentChange, false);\n  }; //\n\n\n  var poseOrientation = new Quaternion();\n  var posePosition = new Vector3(); // Compute model matrices of the eyes with respect to the head.\n\n  function getEyeMatrices(frameData) {\n    // Compute the matrix for the position of the head based on the pose\n    if (frameData.pose.orientation) {\n      poseOrientation.fromArray(frameData.pose.orientation);\n      headMatrix.makeRotationFromQuaternion(poseOrientation);\n    } else {\n      headMatrix.identity();\n    }\n\n    if (frameData.pose.position) {\n      posePosition.fromArray(frameData.pose.position);\n      headMatrix.setPosition(posePosition);\n    } // The view matrix transforms vertices from sitting space to eye space. As such, the view matrix can be thought of as a product of two matrices:\n    // headToEyeMatrix * sittingToHeadMatrix\n    // The headMatrix that we've calculated above is the model matrix of the head in sitting space, which is the inverse of sittingToHeadMatrix.\n    // So when we multiply the view matrix with headMatrix, we're left with headToEyeMatrix:\n    // viewMatrix * headMatrix = headToEyeMatrix * sittingToHeadMatrix * headMatrix = headToEyeMatrix\n\n\n    eyeMatrixL.fromArray(frameData.leftViewMatrix);\n    eyeMatrixL.multiply(headMatrix);\n    eyeMatrixR.fromArray(frameData.rightViewMatrix);\n    eyeMatrixR.multiply(headMatrix); // The eye's model matrix in head space is the inverse of headToEyeMatrix we calculated above.\n\n    eyeMatrixL.getInverse(eyeMatrixL);\n    eyeMatrixR.getInverse(eyeMatrixR);\n  }\n\n  function fovToNDCScaleOffset(fov) {\n    var pxscale = 2.0 / (fov.leftTan + fov.rightTan);\n    var pxoffset = (fov.leftTan - fov.rightTan) * pxscale * 0.5;\n    var pyscale = 2.0 / (fov.upTan + fov.downTan);\n    var pyoffset = (fov.upTan - fov.downTan) * pyscale * 0.5;\n    return {\n      scale: [pxscale, pyscale],\n      offset: [pxoffset, pyoffset]\n    };\n  }\n\n  function fovPortToProjection(fov, rightHanded, zNear, zFar) {\n    rightHanded = rightHanded === undefined ? true : rightHanded;\n    zNear = zNear === undefined ? 0.01 : zNear;\n    zFar = zFar === undefined ? 10000.0 : zFar;\n    var handednessScale = rightHanded ? -1.0 : 1.0; // start with an identity matrix\n\n    var mobj = new Matrix4();\n    var m = mobj.elements; // and with scale/offset info for normalized device coords\n\n    var scaleAndOffset = fovToNDCScaleOffset(fov); // X result, map clip edges to [-w,+w]\n\n    m[0 * 4 + 0] = scaleAndOffset.scale[0];\n    m[0 * 4 + 1] = 0.0;\n    m[0 * 4 + 2] = scaleAndOffset.offset[0] * handednessScale;\n    m[0 * 4 + 3] = 0.0; // Y result, map clip edges to [-w,+w]\n    // Y offset is negated because this proj matrix transforms from world coords with Y=up,\n    // but the NDC scaling has Y=down (thanks D3D?)\n\n    m[1 * 4 + 0] = 0.0;\n    m[1 * 4 + 1] = scaleAndOffset.scale[1];\n    m[1 * 4 + 2] = -scaleAndOffset.offset[1] * handednessScale;\n    m[1 * 4 + 3] = 0.0; // Z result (up to the app)\n\n    m[2 * 4 + 0] = 0.0;\n    m[2 * 4 + 1] = 0.0;\n    m[2 * 4 + 2] = zFar / (zNear - zFar) * -handednessScale;\n    m[2 * 4 + 3] = zFar * zNear / (zNear - zFar); // W result (= Z in)\n\n    m[3 * 4 + 0] = 0.0;\n    m[3 * 4 + 1] = 0.0;\n    m[3 * 4 + 2] = handednessScale;\n    m[3 * 4 + 3] = 0.0;\n    mobj.transpose();\n    return mobj;\n  }\n\n  function fovToProjection(fov, rightHanded, zNear, zFar) {\n    var DEG2RAD = Math.PI / 180.0;\n    var fovPort = {\n      upTan: Math.tan(fov.upDegrees * DEG2RAD),\n      downTan: Math.tan(fov.downDegrees * DEG2RAD),\n      leftTan: Math.tan(fov.leftDegrees * DEG2RAD),\n      rightTan: Math.tan(fov.rightDegrees * DEG2RAD)\n    };\n    return fovPortToProjection(fovPort, rightHanded, zNear, zFar);\n  }\n};\n/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n */\n\n\nvar OrbitControls = function OrbitControls(object, domElement) {\n  this.object = object;\n  this.domElement = domElement !== undefined ? domElement : document; // Set to false to disable this control\n\n  this.enabled = true; // \"target\" sets the location of focus, where the object orbits around\n\n  this.target = new Vector3(); // How far you can dolly in and out ( PerspectiveCamera only )\n\n  this.minDistance = 0;\n  this.maxDistance = Infinity; // How far you can zoom in and out ( OrthographicCamera only )\n\n  this.minZoom = 0;\n  this.maxZoom = Infinity; // How far you can orbit vertically, upper and lower limits.\n  // Range is 0 to Math.PI radians.\n\n  this.minPolarAngle = 0; // radians\n\n  this.maxPolarAngle = Math.PI; // radians\n  // How far you can orbit horizontally, upper and lower limits.\n  // If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n\n  this.minAzimuthAngle = -Infinity; // radians\n\n  this.maxAzimuthAngle = Infinity; // radians\n  // Set to true to enable damping (inertia)\n  // If damping is enabled, you must call controls.update() in your animation loop\n\n  this.enableDamping = false;\n  this.dampingFactor = 0.25; // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n  // Set to false to disable zooming\n\n  this.enableZoom = true;\n  this.zoomSpeed = 1.0; // Set to false to disable rotating\n\n  this.enableRotate = true;\n  this.rotateSpeed = 1.0; // Set to false to disable panning\n\n  this.enablePan = true;\n  this.panSpeed = 1.0;\n  this.screenSpacePanning = false; // if true, pan in screen-space\n\n  this.keyPanSpeed = 7.0; // pixels moved per arrow key push\n  // Set to true to automatically rotate around the target\n  // If auto-rotate is enabled, you must call controls.update() in your animation loop\n\n  this.autoRotate = false;\n  this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n  // Set to false to disable use of the keys\n\n  this.enableKeys = true; // The four arrow keys\n\n  this.keys = {\n    LEFT: 37,\n    UP: 38,\n    RIGHT: 39,\n    BOTTOM: 40\n  }; // Mouse buttons\n\n  this.mouseButtons = {\n    ORBIT: MOUSE.LEFT,\n    ZOOM: MOUSE.MIDDLE,\n    PAN: MOUSE.RIGHT\n  }; // for reset\n\n  this.target0 = this.target.clone();\n  this.position0 = this.object.position.clone();\n  this.zoom0 = this.object.zoom; //\n  // public methods\n  //\n\n  this.getPolarAngle = function () {\n    return spherical.phi;\n  };\n\n  this.getAzimuthalAngle = function () {\n    return spherical.theta;\n  };\n\n  this.saveState = function () {\n    scope.target0.copy(scope.target);\n    scope.position0.copy(scope.object.position);\n    scope.zoom0 = scope.object.zoom;\n  };\n\n  this.reset = function () {\n    scope.target.copy(scope.target0);\n    scope.object.position.copy(scope.position0);\n    scope.object.zoom = scope.zoom0;\n    scope.object.updateProjectionMatrix();\n    scope.dispatchEvent(changeEvent);\n    scope.update();\n    state = STATE.NONE;\n  }; // this method is exposed, but perhaps it would be better if we can make it private...\n\n\n  this.update = function () {\n    var offset = new Vector3(); // so camera.up is the orbit axis\n\n    var quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0));\n    var quatInverse = quat.clone().inverse();\n    var lastPosition = new Vector3();\n    var lastQuaternion = new Quaternion();\n    return function update() {\n      var position = scope.object.position;\n      offset.copy(position).sub(scope.target); // rotate offset to \"y-axis-is-up\" space\n\n      offset.applyQuaternion(quat); // angle from z-axis around y-axis\n\n      spherical.setFromVector3(offset);\n\n      if (scope.autoRotate && state === STATE.NONE) {\n        scope.rotateLeft(getAutoRotationAngle());\n      }\n\n      spherical.theta += sphericalDelta.theta;\n      spherical.phi += sphericalDelta.phi; // restrict theta to be between desired limits\n\n      spherical.theta = Math.max(scope.minAzimuthAngle, Math.min(scope.maxAzimuthAngle, spherical.theta)); // restrict phi to be between desired limits\n\n      spherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\n      spherical.makeSafe();\n      spherical.radius *= scale; // restrict radius to be between desired limits\n\n      spherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius)); // move target to panned location\n\n      scope.target.add(panOffset);\n      offset.setFromSpherical(spherical); // rotate offset back to \"camera-up-vector-is-up\" space\n\n      offset.applyQuaternion(quatInverse);\n      position.copy(scope.target).add(offset);\n      scope.object.lookAt(scope.target);\n\n      if (scope.enableDamping === true) {\n        sphericalDelta.theta *= 1 - scope.dampingFactor;\n        sphericalDelta.phi *= 1 - scope.dampingFactor;\n        panOffset.multiplyScalar(1 - scope.dampingFactor);\n      } else {\n        sphericalDelta.set(0, 0, 0);\n        panOffset.set(0, 0, 0);\n      }\n\n      scale = 1; // update condition is:\n      // min(camera displacement, camera rotation in radians)^2 > EPS\n      // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n      if (zoomChanged || lastPosition.distanceToSquared(scope.object.position) > EPS || 8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS) {\n        scope.dispatchEvent(changeEvent);\n        lastPosition.copy(scope.object.position);\n        lastQuaternion.copy(scope.object.quaternion);\n        zoomChanged = false;\n        return true;\n      }\n\n      return false;\n    };\n  }();\n\n  this.dispose = function () {\n    scope.domElement.removeEventListener('contextmenu', onContextMenu, false);\n    scope.domElement.removeEventListener('mousedown', onMouseDown, false);\n    scope.domElement.removeEventListener('wheel', onMouseWheel, false);\n    scope.domElement.removeEventListener('touchstart', onTouchStart, false);\n    scope.domElement.removeEventListener('touchend', onTouchEnd, false);\n    scope.domElement.removeEventListener('touchmove', onTouchMove, false);\n    document.removeEventListener('mousemove', onMouseMove, false);\n    document.removeEventListener('mouseup', onMouseUp, false);\n    window.removeEventListener('keydown', onKeyDown, false); //scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n  }; //\n  // internals\n  //\n\n\n  var scope = this;\n  var changeEvent = {\n    type: 'change'\n  };\n  var startEvent = {\n    type: 'start'\n  };\n  var endEvent = {\n    type: 'end'\n  };\n  var STATE = {\n    NONE: -1,\n    ROTATE: 0,\n    DOLLY: 1,\n    PAN: 2,\n    TOUCH_ROTATE: 3,\n    TOUCH_DOLLY_PAN: 4\n  };\n  var state = STATE.NONE;\n  var EPS = 0.000001; // current position in spherical coordinates\n\n  var spherical = new Spherical();\n  var sphericalDelta = new Spherical();\n  var scale = 1;\n  var panOffset = new Vector3();\n  var zoomChanged = false;\n  var rotateStart = new Vector2();\n  var rotateEnd = new Vector2();\n  var rotateDelta = new Vector2();\n  var panStart = new Vector2();\n  var panEnd = new Vector2();\n  var panDelta = new Vector2();\n  var dollyStart = new Vector2();\n  var dollyEnd = new Vector2();\n  var dollyDelta = new Vector2();\n\n  function getAutoRotationAngle() {\n    return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n  }\n\n  function getZoomScale() {\n    return Math.pow(0.95, scope.zoomSpeed);\n  }\n\n  scope.rotateLeft = function (angle) {\n    sphericalDelta.theta -= angle;\n  };\n\n  scope.rotateUp = function (angle) {\n    sphericalDelta.phi -= angle;\n  };\n\n  var panLeft = function () {\n    var v = new Vector3();\n    return function panLeft(distance, objectMatrix) {\n      v.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\n\n      v.multiplyScalar(-distance);\n      panOffset.add(v);\n    };\n  }();\n\n  var panUp = function () {\n    var v = new Vector3();\n    return function panUp(distance, objectMatrix) {\n      if (scope.screenSpacePanning === true) {\n        v.setFromMatrixColumn(objectMatrix, 1);\n      } else {\n        v.setFromMatrixColumn(objectMatrix, 0);\n        v.crossVectors(scope.object.up, v);\n      }\n\n      v.multiplyScalar(distance);\n      panOffset.add(v);\n    };\n  }(); // deltaX and deltaY are in pixels; right and down are positive\n\n\n  var pan = function () {\n    var offset = new Vector3();\n    return function pan(deltaX, deltaY) {\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n      if (scope.object.isPerspectiveCamera) {\n        // perspective\n        var position = scope.object.position;\n        offset.copy(position).sub(scope.target);\n        var targetDistance = offset.length(); // half of the fov is center to top of screen\n\n        targetDistance *= Math.tan(scope.object.fov / 2 * Math.PI / 180.0); // we use only clientHeight here so aspect ratio does not distort speed\n\n        panLeft(2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix);\n        panUp(2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix);\n      } else if (scope.object.isOrthographicCamera) {\n        // orthographic\n        panLeft(deltaX * (scope.object.right - scope.object.left) / scope.object.zoom / element.clientWidth, scope.object.matrix);\n        panUp(deltaY * (scope.object.top - scope.object.bottom) / scope.object.zoom / element.clientHeight, scope.object.matrix);\n      } else {\n        // camera neither orthographic nor perspective\n        console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\n        scope.enablePan = false;\n      }\n    };\n  }();\n\n  function dollyIn(dollyScale) {\n    if (scope.object.isPerspectiveCamera) {\n      scale /= dollyScale;\n    } else if (scope.object.isOrthographicCamera) {\n      scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom * dollyScale));\n      scope.object.updateProjectionMatrix();\n      zoomChanged = true;\n    } else {\n      console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n      scope.enableZoom = false;\n    }\n  }\n\n  function dollyOut(dollyScale) {\n    if (scope.object.isPerspectiveCamera) {\n      scale *= dollyScale;\n    } else if (scope.object.isOrthographicCamera) {\n      scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / dollyScale));\n      scope.object.updateProjectionMatrix();\n      zoomChanged = true;\n    } else {\n      console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n      scope.enableZoom = false;\n    }\n  } //\n  // event callbacks - update the object state\n  //\n\n\n  function handleMouseDownRotate(event) {\n    //console.log( 'handleMouseDownRotate' );\n    rotateStart.set(event.clientX, event.clientY);\n  }\n\n  function handleMouseDownDolly(event) {\n    //console.log( 'handleMouseDownDolly' );\n    dollyStart.set(event.clientX, event.clientY);\n  }\n\n  function handleMouseDownPan(event) {\n    //console.log( 'handleMouseDownPan' );\n    panStart.set(event.clientX, event.clientY);\n  }\n\n  function handleMouseMoveRotate(event) {\n    //console.log( 'handleMouseMoveRotate' );\n    rotateEnd.set(event.clientX, event.clientY);\n    rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n    var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n    scope.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n    scope.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n    rotateStart.copy(rotateEnd);\n    scope.update();\n  }\n\n  function handleMouseMoveDolly(event) {\n    //console.log( 'handleMouseMoveDolly' );\n    dollyEnd.set(event.clientX, event.clientY);\n    dollyDelta.subVectors(dollyEnd, dollyStart);\n\n    if (dollyDelta.y > 0) {\n      dollyIn(getZoomScale());\n    } else if (dollyDelta.y < 0) {\n      dollyOut(getZoomScale());\n    }\n\n    dollyStart.copy(dollyEnd);\n    scope.update();\n  }\n\n  function handleMouseMovePan(event) {\n    //console.log( 'handleMouseMovePan' );\n    panEnd.set(event.clientX, event.clientY);\n    panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n    pan(panDelta.x, panDelta.y);\n    panStart.copy(panEnd);\n    scope.update();\n  }\n\n  function handleMouseWheel(event) {\n    // console.log( 'handleMouseWheel' );\n    if (event.deltaY < 0) {\n      dollyOut(getZoomScale());\n    } else if (event.deltaY > 0) {\n      dollyIn(getZoomScale());\n    }\n\n    scope.update();\n  }\n\n  function handleKeyDown(event) {\n    //console.log( 'handleKeyDown' );\n    switch (event.keyCode) {\n      case scope.keys.UP:\n        pan(0, scope.keyPanSpeed);\n        scope.update();\n        break;\n\n      case scope.keys.BOTTOM:\n        pan(0, -scope.keyPanSpeed);\n        scope.update();\n        break;\n\n      case scope.keys.LEFT:\n        pan(scope.keyPanSpeed, 0);\n        scope.update();\n        break;\n\n      case scope.keys.RIGHT:\n        pan(-scope.keyPanSpeed, 0);\n        scope.update();\n        break;\n    }\n  }\n\n  function handleTouchStartRotate(event) {\n    //console.log( 'handleTouchStartRotate' );\n    rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n  }\n\n  function handleTouchStartDollyPan(event) {\n    //console.log( 'handleTouchStartDollyPan' );\n    if (scope.enableZoom) {\n      var dx = event.touches[0].pageX - event.touches[1].pageX;\n      var dy = event.touches[0].pageY - event.touches[1].pageY;\n      var distance = Math.sqrt(dx * dx + dy * dy);\n      dollyStart.set(0, distance);\n    }\n\n    if (scope.enablePan) {\n      var x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n      var y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n      panStart.set(x, y);\n    }\n  }\n\n  function handleTouchMoveRotate(event) {\n    //console.log( 'handleTouchMoveRotate' );\n    rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n    rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n    var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n    scope.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n    scope.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n    rotateStart.copy(rotateEnd);\n    scope.update();\n  }\n\n  function handleTouchMoveDollyPan(event) {\n    //console.log( 'handleTouchMoveDollyPan' );\n    if (scope.enableZoom) {\n      var dx = event.touches[0].pageX - event.touches[1].pageX;\n      var dy = event.touches[0].pageY - event.touches[1].pageY;\n      var distance = Math.sqrt(dx * dx + dy * dy);\n      dollyEnd.set(0, distance);\n      dollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed));\n      dollyIn(dollyDelta.y);\n      dollyStart.copy(dollyEnd);\n    }\n\n    if (scope.enablePan) {\n      var x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n      var y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n      panEnd.set(x, y);\n      panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n      pan(panDelta.x, panDelta.y);\n      panStart.copy(panEnd);\n    }\n\n    scope.update();\n  } //\n  // event handlers - FSM: listen for events and reset state\n  //\n\n\n  function onMouseDown(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n\n    switch (event.button) {\n      case scope.mouseButtons.ORBIT:\n        if (scope.enableRotate === false) return;\n        handleMouseDownRotate(event);\n        state = STATE.ROTATE;\n        break;\n\n      case scope.mouseButtons.ZOOM:\n        if (scope.enableZoom === false) return;\n        handleMouseDownDolly(event);\n        state = STATE.DOLLY;\n        break;\n\n      case scope.mouseButtons.PAN:\n        if (scope.enablePan === false) return;\n        handleMouseDownPan(event);\n        state = STATE.PAN;\n        break;\n    }\n\n    if (state !== STATE.NONE) {\n      document.addEventListener('mousemove', onMouseMove, false);\n      document.addEventListener('mouseup', onMouseUp, false);\n      scope.dispatchEvent(startEvent);\n    }\n  }\n\n  function onMouseMove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n\n    switch (state) {\n      case STATE.ROTATE:\n        if (scope.enableRotate === false) return;\n        handleMouseMoveRotate(event);\n        break;\n\n      case STATE.DOLLY:\n        if (scope.enableZoom === false) return;\n        handleMouseMoveDolly(event);\n        break;\n\n      case STATE.PAN:\n        if (scope.enablePan === false) return;\n        handleMouseMovePan(event);\n        break;\n    }\n  }\n\n  function onMouseUp(event) {\n    if (scope.enabled === false) return;\n    document.removeEventListener('mousemove', onMouseMove, false);\n    document.removeEventListener('mouseup', onMouseUp, false);\n    scope.dispatchEvent(endEvent);\n    state = STATE.NONE;\n  }\n\n  function onMouseWheel(event) {\n    if (scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE && state !== STATE.ROTATE) return;\n    event.preventDefault();\n    event.stopPropagation();\n    scope.dispatchEvent(startEvent);\n    handleMouseWheel(event);\n    scope.dispatchEvent(endEvent);\n  }\n\n  function onKeyDown(event) {\n    if (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false) return;\n    handleKeyDown(event);\n  }\n\n  function onTouchStart(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n\n    switch (event.touches.length) {\n      case 1:\n        // one-fingered touch: rotate\n        if (scope.enableRotate === false) return;\n        handleTouchStartRotate(event);\n        state = STATE.TOUCH_ROTATE;\n        break;\n\n      case 2:\n        // two-fingered touch: dolly-pan\n        if (scope.enableZoom === false && scope.enablePan === false) return;\n        handleTouchStartDollyPan(event);\n        state = STATE.TOUCH_DOLLY_PAN;\n        break;\n\n      default:\n        state = STATE.NONE;\n    }\n\n    if (state !== STATE.NONE) {\n      scope.dispatchEvent(startEvent);\n    }\n  }\n\n  function onTouchMove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.touches.length) {\n      case 1:\n        // one-fingered touch: rotate\n        if (scope.enableRotate === false) return;\n        if (state !== STATE.TOUCH_ROTATE) return; // is this needed?\n\n        handleTouchMoveRotate(event);\n        break;\n\n      case 2:\n        // two-fingered touch: dolly-pan\n        if (scope.enableZoom === false && scope.enablePan === false) return;\n        if (state !== STATE.TOUCH_DOLLY_PAN) return; // is this needed?\n\n        handleTouchMoveDollyPan(event);\n        break;\n\n      default:\n        state = STATE.NONE;\n    }\n  }\n\n  function onTouchEnd(event) {\n    if (scope.enabled === false) return;\n    scope.dispatchEvent(endEvent);\n    state = STATE.NONE;\n  }\n\n  function onContextMenu(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n  } //\n  //scope.domElement.addEventListener\\( 'contextmenu', onContextMenu, false );\n\n\n  scope.domElement.addEventListener('mousedown', onMouseDown, false);\n  scope.domElement.addEventListener('wheel', onMouseWheel, false);\n  scope.domElement.addEventListener('touchstart', onTouchStart, false);\n  scope.domElement.addEventListener('touchend', onTouchEnd, false);\n  scope.domElement.addEventListener('touchmove', onTouchMove, false);\n  window.addEventListener('keydown', onKeyDown, false); // force an update at start\n\n  this.update();\n};\n\nOrbitControls.prototype = Object.create(EventDispatcher.prototype);\nOrbitControls.prototype.constructor = OrbitControls;\nObject.defineProperties(OrbitControls.prototype, {\n  center: {\n    get: function get() {\n      console.warn('OrbitControls: .center has been renamed to .target');\n      return this.target;\n    }\n  },\n  // backward compatibility\n  noZoom: {\n    get: function get() {\n      console.warn('OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');\n      return !this.enableZoom;\n    },\n    set: function set(value) {\n      console.warn('OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');\n      this.enableZoom = !value;\n    }\n  },\n  noRotate: {\n    get: function get() {\n      console.warn('OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');\n      return !this.enableRotate;\n    },\n    set: function set(value) {\n      console.warn('OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');\n      this.enableRotate = !value;\n    }\n  },\n  noPan: {\n    get: function get() {\n      console.warn('OrbitControls: .noPan has been deprecated. Use .enablePan instead.');\n      return !this.enablePan;\n    },\n    set: function set(value) {\n      console.warn('OrbitControls: .noPan has been deprecated. Use .enablePan instead.');\n      this.enablePan = !value;\n    }\n  },\n  noKeys: {\n    get: function get() {\n      console.warn('OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');\n      return !this.enableKeys;\n    },\n    set: function set(value) {\n      console.warn('OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');\n      this.enableKeys = !value;\n    }\n  },\n  staticMoving: {\n    get: function get() {\n      console.warn('OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');\n      return !this.enableDamping;\n    },\n    set: function set(value) {\n      console.warn('OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');\n      this.enableDamping = !value;\n    }\n  },\n  dynamicDampingFactor: {\n    get: function get() {\n      console.warn('OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');\n      return this.dampingFactor;\n    },\n    set: function set(value) {\n      console.warn('OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');\n      this.dampingFactor = value;\n    }\n  }\n});\n/**\n * @author richt / http://richt.me\n * @author WestLangley / http://github.com/WestLangley\n *\n * W3C Device Orientation control (http://w3c.github.io/deviceorientation/spec-source-orientation.html)\n */\n\nvar DeviceOrientationControls = function DeviceOrientationControls(object) {\n  var scope = this;\n  this.object = object;\n  this.object.rotation.reorder('YXZ');\n  this.enabled = true;\n  this.deviceOrientation = {};\n  this.screenOrientation = 0;\n  this.alphaOffset = 0; // radians\n\n  var onDeviceOrientationChangeEvent = function onDeviceOrientationChangeEvent(event) {\n    scope.deviceOrientation = event;\n  };\n\n  var onScreenOrientationChangeEvent = function onScreenOrientationChangeEvent() {\n    scope.screenOrientation = window.orientation || 0;\n  }; // The angles alpha, beta and gamma form a set of intrinsic Tait-Bryan angles of type Z-X'-Y''\n\n\n  var setObjectQuaternion = function () {\n    var zee = new Vector3(0, 0, 1);\n    var euler = new Euler();\n    var q0 = new Quaternion();\n    var q1 = new Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\n\n    return function (quaternion, alpha, beta, gamma, orient) {\n      euler.set(beta, alpha, -gamma, 'YXZ'); // 'ZXY' for the device, but 'YXZ' for us\n\n      quaternion.setFromEuler(euler); // orient the device\n\n      quaternion.multiply(q1); // camera looks out the back of the device, not the top\n\n      quaternion.multiply(q0.setFromAxisAngle(zee, -orient)); // adjust for screen orientation\n    };\n  }();\n\n  this.connect = function () {\n    onScreenOrientationChangeEvent(); // run once on load\n\n    window.addEventListener('orientationchange', onScreenOrientationChangeEvent, false);\n    window.addEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);\n    scope.enabled = true;\n  };\n\n  this.disconnect = function () {\n    window.removeEventListener('orientationchange', onScreenOrientationChangeEvent, false);\n    window.removeEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);\n    scope.enabled = false;\n  };\n\n  this.update = function () {\n    if (scope.enabled === false) return;\n    var device = scope.deviceOrientation;\n\n    if (device) {\n      var alpha = device.alpha ? Math$1.degToRad(device.alpha) + scope.alphaOffset : 0; // Z\n\n      var beta = device.beta ? Math$1.degToRad(device.beta) : 0; // X'\n\n      var gamma = device.gamma ? Math$1.degToRad(device.gamma) : 0; // Y''\n\n      var orient = scope.screenOrientation ? Math$1.degToRad(scope.screenOrientation) : 0; // O\n\n      setObjectQuaternion(scope.object.quaternion, alpha, beta, gamma, orient);\n    }\n  };\n\n  this.dispose = function () {\n    scope.disconnect();\n  };\n\n  this.connect();\n};\n/**\n * Convert a quaternion to an angle\n *\n * Taken from https://stackoverflow.com/a/35448946\n * Thanks P. Ellul\n */\n\n\nfunction Quat2Angle(x, y, z, w) {\n  var test = x * y + z * w; // singularity at north pole\n\n  if (test > 0.499) {\n    var _yaw = 2 * Math.atan2(x, w);\n\n    var _pitch = Math.PI / 2;\n\n    var _roll = 0;\n    return new Vector3(_pitch, _roll, _yaw);\n  } // singularity at south pole\n\n\n  if (test < -0.499) {\n    var _yaw2 = -2 * Math.atan2(x, w);\n\n    var _pitch2 = -Math.PI / 2;\n\n    var _roll2 = 0;\n    return new Vector3(_pitch2, _roll2, _yaw2);\n  }\n\n  var sqx = x * x;\n  var sqy = y * y;\n  var sqz = z * z;\n  var yaw = Math.atan2(2 * y * w - 2 * x * z, 1 - 2 * sqy - 2 * sqz);\n  var pitch = Math.asin(2 * test);\n  var roll = Math.atan2(2 * x * w - 2 * y * z, 1 - 2 * sqx - 2 * sqz);\n  return new Vector3(pitch, roll, yaw);\n}\n\nvar OrbitOrientationControls = /*#__PURE__*/function () {\n  function OrbitOrientationControls(options) {\n    this.object = options.camera;\n    this.domElement = options.canvas;\n    this.orbit = new OrbitControls(this.object, this.domElement);\n    this.speed = 0.5;\n    this.orbit.target.set(0, 0, -1);\n    this.orbit.enableZoom = false;\n    this.orbit.enablePan = false;\n    this.orbit.rotateSpeed = -this.speed; // if orientation is supported\n\n    if (options.orientation) {\n      this.orientation = new DeviceOrientationControls(this.object);\n    } // if projection is not full view\n    // limit the rotation angle in order to not display back half view\n\n\n    if (options.halfView) {\n      this.orbit.minAzimuthAngle = -Math.PI / 4;\n      this.orbit.maxAzimuthAngle = Math.PI / 4;\n    }\n  }\n\n  var _proto = OrbitOrientationControls.prototype;\n\n  _proto.update = function update() {\n    // orientation updates the camera using quaternions and\n    // orbit updates the camera using angles. They are incompatible\n    // and one update overrides the other. So before\n    // orbit overrides orientation we convert our quaternion changes to\n    // an angle change. Then save the angle into orbit so that\n    // it will take those into account when it updates the camera and overrides\n    // our changes\n    if (this.orientation) {\n      this.orientation.update();\n      var quat = this.orientation.object.quaternion;\n      var currentAngle = Quat2Angle(quat.x, quat.y, quat.z, quat.w); // we also have to store the last angle since quaternions are b\n\n      if (typeof this.lastAngle_ === 'undefined') {\n        this.lastAngle_ = currentAngle;\n      }\n\n      this.orbit.rotateLeft((this.lastAngle_.z - currentAngle.z) * (1 + this.speed));\n      this.orbit.rotateUp((this.lastAngle_.y - currentAngle.y) * (1 + this.speed));\n      this.lastAngle_ = currentAngle;\n    }\n\n    this.orbit.update();\n  };\n\n  _proto.dispose = function dispose() {\n    this.orbit.dispose();\n\n    if (this.orientation) {\n      this.orientation.dispose();\n    }\n  };\n\n  return OrbitOrientationControls;\n}();\n\nvar corsSupport = function () {\n  var video = document$1.createElement('video');\n  video.crossOrigin = 'anonymous';\n  return video.hasAttribute('crossorigin');\n}();\n\nvar validProjections = ['360', '360_LR', '360_TB', '360_CUBE', 'EAC', 'EAC_LR', 'NONE', 'AUTO', 'Sphere', 'Cube', 'equirectangular', '180', '180_LR', '180_MONO'];\n\nvar getInternalProjectionName = function getInternalProjectionName(projection) {\n  if (!projection) {\n    return;\n  }\n\n  projection = projection.toString().trim();\n\n  if (/sphere/i.test(projection)) {\n    return '360';\n  }\n\n  if (/cube/i.test(projection)) {\n    return '360_CUBE';\n  }\n\n  if (/equirectangular/i.test(projection)) {\n    return '360';\n  }\n\n  for (var i = 0; i < validProjections.length; i++) {\n    if (new RegExp('^' + validProjections[i] + '$', 'i').test(projection)) {\n      return validProjections[i];\n    }\n  }\n};\n/**\n * This class reacts to interactions with the canvas and\n * triggers appropriate functionality on the player. Right now\n * it does two things:\n *\n * 1. A `mousedown`/`touchstart` followed by `touchend`/`mouseup` without any\n *    `touchmove` or `mousemove` toggles play/pause on the player\n * 2. Only moving on/clicking the control bar or toggling play/pause should\n *    show the control bar. Moving around the scene in the canvas should not.\n */\n\n\nvar CanvasPlayerControls = /*#__PURE__*/function (_videojs$EventTarget) {\n  _inheritsLoose(CanvasPlayerControls, _videojs$EventTarget);\n\n  function CanvasPlayerControls(player, canvas, options) {\n    var _this;\n\n    _this = _videojs$EventTarget.call(this) || this;\n    _this.player = player;\n    _this.canvas = canvas;\n    _this.options = options;\n    _this.onMoveEnd = videojs.bind(_assertThisInitialized(_this), _this.onMoveEnd);\n    _this.onMoveStart = videojs.bind(_assertThisInitialized(_this), _this.onMoveStart);\n    _this.onMove = videojs.bind(_assertThisInitialized(_this), _this.onMove);\n    _this.onControlBarMove = videojs.bind(_assertThisInitialized(_this), _this.onControlBarMove);\n\n    _this.player.controlBar.on(['mousedown', 'mousemove', 'mouseup', 'touchstart', 'touchmove', 'touchend'], _this.onControlBarMove); // we have to override these here because\n    // video.js listens for user activity on the video element\n    // and makes the user active when the mouse moves.\n    // We don't want that for 3d videos\n\n\n    _this.oldReportUserActivity = _this.player.reportUserActivity;\n\n    _this.player.reportUserActivity = function () {}; // canvas movements\n\n\n    _this.canvas.addEventListener('mousedown', _this.onMoveStart);\n\n    _this.canvas.addEventListener('touchstart', _this.onMoveStart);\n\n    _this.canvas.addEventListener('mousemove', _this.onMove);\n\n    _this.canvas.addEventListener('touchmove', _this.onMove);\n\n    _this.canvas.addEventListener('mouseup', _this.onMoveEnd);\n\n    _this.canvas.addEventListener('touchend', _this.onMoveEnd);\n\n    _this.shouldTogglePlay = false;\n    return _this;\n  }\n\n  var _proto = CanvasPlayerControls.prototype;\n\n  _proto.togglePlay = function togglePlay() {\n    if (this.player.paused()) {\n      this.player.play();\n    } else {\n      this.player.pause();\n    }\n  };\n\n  _proto.onMoveStart = function onMoveStart(e) {\n    // if the player does not have a controlbar or\n    // the move was a mouse click but not left click do not\n    // toggle play.\n    if (this.options.disableTogglePlay || !this.player.controls() || e.type === 'mousedown' && !videojs.dom.isSingleLeftClick(e)) {\n      this.shouldTogglePlay = false;\n      return;\n    }\n\n    this.shouldTogglePlay = true;\n    this.touchMoveCount_ = 0;\n  };\n\n  _proto.onMoveEnd = function onMoveEnd(e) {\n    // We want to have the same behavior in VR360 Player and standard player.\n    // in touchend we want to know if was a touch click, for a click we show the bar,\n    // otherwise continue with the mouse logic.\n    //\n    // Maximum movement allowed during a touch event to still be considered a tap\n    // Other popular libs use anywhere from 2 (hammer.js) to 15,\n    // so 10 seems like a nice, round number.\n    if (e.type === 'touchend' && this.touchMoveCount_ < 10) {\n      if (this.player.userActive() === false) {\n        this.player.userActive(true);\n        return;\n      }\n\n      this.player.userActive(false);\n      return;\n    }\n\n    if (!this.shouldTogglePlay) {\n      return;\n    } // We want the same behavior in Desktop for VR360  and standard player\n\n\n    if (e.type == 'mouseup') {\n      this.togglePlay();\n    }\n  };\n\n  _proto.onMove = function onMove(e) {\n    // Increase touchMoveCount_ since Android detects 1 - 6 touches when user click normally\n    this.touchMoveCount_++;\n    this.shouldTogglePlay = false;\n  };\n\n  _proto.onControlBarMove = function onControlBarMove(e) {\n    this.player.userActive(true);\n  };\n\n  _proto.dispose = function dispose() {\n    this.canvas.removeEventListener('mousedown', this.onMoveStart);\n    this.canvas.removeEventListener('touchstart', this.onMoveStart);\n    this.canvas.removeEventListener('mousemove', this.onMove);\n    this.canvas.removeEventListener('touchmove', this.onMove);\n    this.canvas.removeEventListener('mouseup', this.onMoveEnd);\n    this.canvas.removeEventListener('touchend', this.onMoveEnd);\n    this.player.controlBar.off(['mousedown', 'mousemove', 'mouseup', 'touchstart', 'touchmove', 'touchend'], this.onControlBarMove);\n    this.player.reportUserActivity = this.oldReportUserActivity;\n  };\n\n  return CanvasPlayerControls;\n}(videojs.EventTarget);\n/**\n * This class manages ambisonic decoding and binaural rendering via Omnitone library.\n */\n\n\nvar OmnitoneController = /*#__PURE__*/function (_videojs$EventTarget) {\n  _inheritsLoose(OmnitoneController, _videojs$EventTarget);\n  /**\n   * Omnitone controller class.\n   *\n   * @class\n   * @param {AudioContext} audioContext - associated AudioContext.\n   * @param {Omnitone library} omnitone - Omnitone library element.\n   * @param {HTMLVideoElement} video - vidoe tag element.\n   * @param {Object} options - omnitone options.\n   */\n\n\n  function OmnitoneController(audioContext, omnitone, video, options) {\n    var _this;\n\n    _this = _videojs$EventTarget.call(this) || this;\n    var settings = videojs.mergeOptions({\n      // Safari uses the different AAC decoder than FFMPEG. The channel order is\n      // The default 4ch AAC channel layout for FFMPEG AAC channel ordering.\n      channelMap: videojs.browser.IS_SAFARI ? [2, 0, 1, 3] : [0, 1, 2, 3],\n      ambisonicOrder: 1\n    }, options);\n    _this.videoElementSource = audioContext.createMediaElementSource(video);\n    _this.foaRenderer = omnitone.createFOARenderer(audioContext, settings);\n\n    _this.foaRenderer.initialize().then(function () {\n      if (audioContext.state === 'suspended') {\n        _this.trigger({\n          type: 'audiocontext-suspended'\n        });\n      }\n\n      _this.videoElementSource.connect(_this.foaRenderer.input);\n\n      _this.foaRenderer.output.connect(audioContext.destination);\n\n      _this.initialized = true;\n\n      _this.trigger({\n        type: 'omnitone-ready'\n      });\n    }, function (error) {\n      videojs.log.warn(\"videojs-vr: Omnitone initializes failed with the following error: \" + error + \")\");\n    });\n\n    return _this;\n  }\n  /**\n   * Updates the rotation of the Omnitone decoder based on three.js camera matrix.\n   *\n   * @param {Camera} camera Three.js camera object\n   */\n\n\n  var _proto = OmnitoneController.prototype;\n\n  _proto.update = function update(camera) {\n    if (!this.initialized) {\n      return;\n    }\n\n    this.foaRenderer.setRotationMatrixFromCamera(camera.matrix);\n  }\n  /**\n   * Destroys the controller and does any necessary cleanup.\n   */\n  ;\n\n  _proto.dispose = function dispose() {\n    this.initialized = false;\n    this.foaRenderer.setRenderingMode('bypass');\n    this.foaRenderer = null;\n  };\n\n  return OmnitoneController;\n}(videojs.EventTarget);\n\nvar Button = videojs.getComponent('Button');\n\nvar CardboardButton = /*#__PURE__*/function (_Button) {\n  _inheritsLoose(CardboardButton, _Button);\n\n  function CardboardButton(player, options) {\n    var _this;\n\n    _this = _Button.call(this, player, options) || this;\n    _this.handleVrDisplayActivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayActivate_);\n    _this.handleVrDisplayDeactivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayDeactivate_);\n    _this.handleVrDisplayPresentChange_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayPresentChange_);\n    _this.handleOrientationChange_ = videojs.bind(_assertThisInitialized(_this), _this.handleOrientationChange_);\n    window$1.addEventListener('orientationchange', _this.handleOrientationChange_);\n    window$1.addEventListener('vrdisplayactivate', _this.handleVrDisplayActivate_);\n    window$1.addEventListener('vrdisplaydeactivate', _this.handleVrDisplayDeactivate_); // vrdisplaypresentchange does not fire activate or deactivate\n    // and happens when hitting the back button during cardboard mode\n    // so we need to make sure we stay in the correct state by\n    // listening to it and checking if we are presenting it or not\n\n    window$1.addEventListener('vrdisplaypresentchange', _this.handleVrDisplayPresentChange_); // we cannot show the cardboard button in fullscreen on\n    // android as it breaks the controls, and makes it impossible\n    // to exit cardboard mode\n\n    if (videojs.browser.IS_ANDROID) {\n      _this.on(player, 'fullscreenchange', function () {\n        if (player.isFullscreen()) {\n          _this.hide();\n        } else {\n          _this.show();\n        }\n      });\n    }\n\n    return _this;\n  }\n\n  var _proto = CardboardButton.prototype;\n\n  _proto.buildCSSClass = function buildCSSClass() {\n    return \"vjs-button-vr \" + _Button.prototype.buildCSSClass.call(this);\n  };\n\n  _proto.handleVrDisplayPresentChange_ = function handleVrDisplayPresentChange_() {\n    if (!this.player_.vr().vrDisplay.isPresenting && this.active_) {\n      this.handleVrDisplayDeactivate_();\n    }\n\n    if (this.player_.vr().vrDisplay.isPresenting && !this.active_) {\n      this.handleVrDisplayActivate_();\n    }\n  };\n\n  _proto.handleOrientationChange_ = function handleOrientationChange_() {\n    if (this.active_ && videojs.browser.IS_IOS) {\n      this.changeSize_();\n    }\n  };\n\n  _proto.changeSize_ = function changeSize_() {\n    this.player_.width(window$1.innerWidth);\n    this.player_.height(window$1.innerHeight);\n    window$1.dispatchEvent(new window$1.Event('resize'));\n  };\n\n  _proto.handleVrDisplayActivate_ = function handleVrDisplayActivate_() {\n    // we mimic fullscreen on IOS\n    if (videojs.browser.IS_IOS) {\n      this.oldWidth_ = this.player_.currentWidth();\n      this.oldHeight_ = this.player_.currentHeight();\n      this.player_.enterFullWindow();\n      this.changeSize_();\n    }\n\n    this.active_ = true;\n  };\n\n  _proto.handleVrDisplayDeactivate_ = function handleVrDisplayDeactivate_() {\n    // un-mimic fullscreen on iOS\n    if (videojs.browser.IS_IOS) {\n      if (this.oldWidth_) {\n        this.player_.width(this.oldWidth_);\n      }\n\n      if (this.oldHeight_) {\n        this.player_.height(this.oldHeight_);\n      }\n\n      this.player_.exitFullWindow();\n    }\n\n    this.active_ = false;\n  };\n\n  _proto.handleClick = function handleClick(event) {\n    // if cardboard mode display is not active, activate it\n    // otherwise deactivate it\n    if (!this.active_) {\n      // This starts playback mode when the cardboard button\n      // is clicked on Android. We need to do this as the controls\n      // disappear\n      if (!this.player_.hasStarted() && videojs.browser.IS_ANDROID) {\n        this.player_.play();\n      }\n\n      window$1.dispatchEvent(new window$1.Event('vrdisplayactivate'));\n    } else {\n      window$1.dispatchEvent(new window$1.Event('vrdisplaydeactivate'));\n    }\n  };\n\n  _proto.dispose = function dispose() {\n    _Button.prototype.dispose.call(this);\n\n    window$1.removeEventListener('vrdisplayactivate', this.handleVrDisplayActivate_);\n    window$1.removeEventListener('vrdisplaydeactivate', this.handleVrDisplayDeactivate_);\n    window$1.removeEventListener('vrdisplaypresentchange', this.handleVrDisplayPresentChange_);\n  };\n\n  return CardboardButton;\n}(Button);\n\nvideojs.registerComponent('CardboardButton', CardboardButton);\nvar BigPlayButton = videojs.getComponent('BigPlayButton');\n\nvar BigVrPlayButton = /*#__PURE__*/function (_BigPlayButton) {\n  _inheritsLoose(BigVrPlayButton, _BigPlayButton);\n\n  function BigVrPlayButton() {\n    return _BigPlayButton.apply(this, arguments) || this;\n  }\n\n  var _proto = BigVrPlayButton.prototype;\n\n  _proto.buildCSSClass = function buildCSSClass() {\n    return \"vjs-big-vr-play-button \" + _BigPlayButton.prototype.buildCSSClass.call(this);\n  };\n\n  return BigVrPlayButton;\n}(BigPlayButton);\n\nvideojs.registerComponent('BigVrPlayButton', BigVrPlayButton);\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nvar defaults = {\n  debug: false,\n  omnitone: false,\n  forceCardboard: false,\n  omnitoneOptions: {},\n  projection: 'AUTO',\n  sphereDetail: 32,\n  disableTogglePlay: false\n};\nvar errors = {\n  'web-vr-out-of-date': {\n    headline: '360 is out of date',\n    type: '360_OUT_OF_DATE',\n    message: \"Your browser supports 360 but not the latest version. See <a href='http://webvr.info'>http://webvr.info</a> for more info.\"\n  },\n  'web-vr-not-supported': {\n    headline: '360 not supported on this device',\n    type: '360_NOT_SUPPORTED',\n    message: \"Your browser does not support 360. See <a href='http://webvr.info'>http://webvr.info</a> for assistance.\"\n  },\n  'web-vr-hls-cors-not-supported': {\n    headline: '360 HLS video not supported on this device',\n    type: '360_NOT_SUPPORTED',\n    message: \"Your browser/device does not support HLS 360 video. See <a href='http://webvr.info'>http://webvr.info</a> for assistance.\"\n  }\n};\nvar Plugin = videojs.getPlugin('plugin');\nvar Component = videojs.getComponent('Component');\n\nvar VR = /*#__PURE__*/function (_Plugin) {\n  _inheritsLoose(VR, _Plugin);\n\n  function VR(player, options) {\n    var _this;\n\n    var settings = videojs.mergeOptions(defaults, options);\n    _this = _Plugin.call(this, player, settings) || this;\n    _this.options_ = settings;\n    _this.player_ = player;\n    _this.bigPlayButtonIndex_ = player.children().indexOf(player.getChild('BigPlayButton')) || 0; // custom videojs-errors integration boolean\n\n    _this.videojsErrorsSupport_ = !!videojs.errors;\n\n    if (_this.videojsErrorsSupport_) {\n      player.errors({\n        errors: errors\n      });\n    } // IE 11 does not support enough webgl to be supported\n    // older safari does not support cors, so it wont work\n\n\n    if (videojs.browser.IE_VERSION || !corsSupport) {\n      // if a player triggers error before 'loadstart' is fired\n      // video.js will reset the error overlay\n      _this.player_.on('loadstart', function () {\n        _this.triggerError_({\n          code: 'web-vr-not-supported',\n          dismiss: false\n        });\n      });\n\n      return _assertThisInitialized(_this);\n    }\n\n    _this.polyfill_ = new WebVRPolyfill({\n      // do not show rotate instructions\n      ROTATE_INSTRUCTIONS_DISABLED: true\n    });\n    _this.polyfill_ = new WebVRPolyfill();\n    _this.handleVrDisplayActivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayActivate_);\n    _this.handleVrDisplayDeactivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayDeactivate_);\n    _this.handleResize_ = videojs.bind(_assertThisInitialized(_this), _this.handleResize_);\n    _this.animate_ = videojs.bind(_assertThisInitialized(_this), _this.animate_);\n\n    _this.setProjection(_this.options_.projection); // any time the video element is recycled for ads\n    // we have to reset the vr state and re-init after ad\n\n\n    _this.on(player, 'adstart', function () {\n      return player.setTimeout(function () {\n        // if the video element was recycled for this ad\n        if (!player.ads || !player.ads.videoElementRecycled()) {\n          _this.log('video element not recycled for this ad, no need to reset');\n\n          return;\n        }\n\n        _this.log('video element recycled for this ad, reseting');\n\n        _this.reset();\n\n        _this.one(player, 'playing', _this.init);\n      });\n    }, 1);\n\n    _this.on(player, 'loadedmetadata', _this.init);\n\n    return _this;\n  }\n\n  var _proto = VR.prototype;\n\n  _proto.changeProjection_ = function changeProjection_(projection) {\n    var _this2 = this;\n\n    projection = getInternalProjectionName(projection); // don't change to an invalid projection\n\n    if (!projection) {\n      projection = 'NONE';\n    }\n\n    var position = {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n\n    if (this.scene) {\n      this.scene.remove(this.movieScreen);\n    }\n\n    if (projection === 'AUTO') {\n      // mediainfo cannot be set to auto or we would infinite loop here\n      // each source should know whatever they are 360 or not, if using AUTO\n      if (this.player_.mediainfo && this.player_.mediainfo.projection && this.player_.mediainfo.projection !== 'AUTO') {\n        var autoProjection = getInternalProjectionName(this.player_.mediainfo.projection);\n        return this.changeProjection_(autoProjection);\n      }\n\n      return this.changeProjection_('NONE');\n    } else if (projection === '360') {\n      this.movieGeometry = new SphereBufferGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.position.set(position.x, position.y, position.z);\n      this.movieScreen.scale.x = -1;\n      this.movieScreen.quaternion.setFromAxisAngle({\n        x: 0,\n        y: 1,\n        z: 0\n      }, -Math.PI / 2);\n      this.scene.add(this.movieScreen);\n    } else if (projection === '360_LR' || projection === '360_TB') {\n      // Left eye view\n      var geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail);\n      var uvs = geometry.faceVertexUvs[0];\n\n      for (var i = 0; i < uvs.length; i++) {\n        for (var j = 0; j < 3; j++) {\n          if (projection === '360_LR') {\n            uvs[i][j].x *= 0.5;\n          } else {\n            uvs[i][j].y *= 0.5;\n            uvs[i][j].y += 0.5;\n          }\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.scale.x = -1;\n      this.movieScreen.quaternion.setFromAxisAngle({\n        x: 0,\n        y: 1,\n        z: 0\n      }, -Math.PI / 2); // display in left eye only\n\n      this.movieScreen.layers.set(1);\n      this.scene.add(this.movieScreen); // Right eye view\n\n      geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail);\n      uvs = geometry.faceVertexUvs[0];\n\n      for (var _i = 0; _i < uvs.length; _i++) {\n        for (var _j = 0; _j < 3; _j++) {\n          if (projection === '360_LR') {\n            uvs[_i][_j].x *= 0.5;\n            uvs[_i][_j].x += 0.5;\n          } else {\n            uvs[_i][_j].y *= 0.5;\n          }\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.scale.x = -1;\n      this.movieScreen.quaternion.setFromAxisAngle({\n        x: 0,\n        y: 1,\n        z: 0\n      }, -Math.PI / 2); // display in right eye only\n\n      this.movieScreen.layers.set(2);\n      this.scene.add(this.movieScreen);\n    } else if (projection === '360_CUBE') {\n      this.movieGeometry = new BoxGeometry(256, 256, 256);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      var left = [new Vector2(0, 0.5), new Vector2(0.333, 0.5), new Vector2(0.333, 1), new Vector2(0, 1)];\n      var right = [new Vector2(0.333, 0.5), new Vector2(0.666, 0.5), new Vector2(0.666, 1), new Vector2(0.333, 1)];\n      var top = [new Vector2(0.666, 0.5), new Vector2(1, 0.5), new Vector2(1, 1), new Vector2(0.666, 1)];\n      var bottom = [new Vector2(0, 0), new Vector2(0.333, 0), new Vector2(0.333, 0.5), new Vector2(0, 0.5)];\n      var front = [new Vector2(0.333, 0), new Vector2(0.666, 0), new Vector2(0.666, 0.5), new Vector2(0.333, 0.5)];\n      var back = [new Vector2(0.666, 0), new Vector2(1, 0), new Vector2(1, 0.5), new Vector2(0.666, 0.5)];\n      this.movieGeometry.faceVertexUvs[0] = [];\n      this.movieGeometry.faceVertexUvs[0][0] = [right[2], right[1], right[3]];\n      this.movieGeometry.faceVertexUvs[0][1] = [right[1], right[0], right[3]];\n      this.movieGeometry.faceVertexUvs[0][2] = [left[2], left[1], left[3]];\n      this.movieGeometry.faceVertexUvs[0][3] = [left[1], left[0], left[3]];\n      this.movieGeometry.faceVertexUvs[0][4] = [top[2], top[1], top[3]];\n      this.movieGeometry.faceVertexUvs[0][5] = [top[1], top[0], top[3]];\n      this.movieGeometry.faceVertexUvs[0][6] = [bottom[2], bottom[1], bottom[3]];\n      this.movieGeometry.faceVertexUvs[0][7] = [bottom[1], bottom[0], bottom[3]];\n      this.movieGeometry.faceVertexUvs[0][8] = [front[2], front[1], front[3]];\n      this.movieGeometry.faceVertexUvs[0][9] = [front[1], front[0], front[3]];\n      this.movieGeometry.faceVertexUvs[0][10] = [back[2], back[1], back[3]];\n      this.movieGeometry.faceVertexUvs[0][11] = [back[1], back[0], back[3]];\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.position.set(position.x, position.y, position.z);\n      this.movieScreen.rotation.y = -Math.PI;\n      this.scene.add(this.movieScreen);\n    } else if (projection === '180' || projection === '180_LR' || projection === '180_MONO') {\n      var _geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail, Math.PI, Math.PI); // Left eye view\n\n\n      _geometry.scale(-1, 1, 1);\n\n      var _uvs = _geometry.faceVertexUvs[0];\n\n      if (projection !== '180_MONO') {\n        for (var _i2 = 0; _i2 < _uvs.length; _i2++) {\n          for (var _j2 = 0; _j2 < 3; _j2++) {\n            _uvs[_i2][_j2].x *= 0.5;\n          }\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(_geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial); // display in left eye only\n\n      this.movieScreen.layers.set(1);\n      this.scene.add(this.movieScreen); // Right eye view\n\n      _geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail, Math.PI, Math.PI);\n\n      _geometry.scale(-1, 1, 1);\n\n      _uvs = _geometry.faceVertexUvs[0];\n\n      for (var _i3 = 0; _i3 < _uvs.length; _i3++) {\n        for (var _j3 = 0; _j3 < 3; _j3++) {\n          _uvs[_i3][_j3].x *= 0.5;\n          _uvs[_i3][_j3].x += 0.5;\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(_geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial); // display in right eye only\n\n      this.movieScreen.layers.set(2);\n      this.scene.add(this.movieScreen);\n    } else if (projection === 'EAC' || projection === 'EAC_LR') {\n      var makeScreen = function makeScreen(mapMatrix, scaleMatrix) {\n        // \"Continuity correction?\": because of discontinuous faces and aliasing,\n        // we truncate the 2-pixel-wide strips on all discontinuous edges,\n        var contCorrect = 2;\n        _this2.movieGeometry = new BoxGeometry(256, 256, 256);\n        _this2.movieMaterial = new ShaderMaterial({\n          overdraw: true,\n          side: BackSide,\n          uniforms: {\n            mapped: {\n              value: _this2.videoTexture\n            },\n            mapMatrix: {\n              value: mapMatrix\n            },\n            contCorrect: {\n              value: contCorrect\n            },\n            faceWH: {\n              value: new Vector2(1 / 3, 1 / 2).applyMatrix3(scaleMatrix)\n            },\n            vidWH: {\n              value: new Vector2(_this2.videoTexture.image.videoWidth, _this2.videoTexture.image.videoHeight).applyMatrix3(scaleMatrix)\n            }\n          },\n          vertexShader: \"\\nvarying vec2 vUv;\\nuniform mat3 mapMatrix;\\n\\nvoid main() {\\n  vUv = (mapMatrix * vec3(uv, 1.)).xy;\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);\\n}\",\n          fragmentShader: \"\\nvarying vec2 vUv;\\nuniform sampler2D mapped;\\nuniform vec2 faceWH;\\nuniform vec2 vidWH;\\nuniform float contCorrect;\\n\\nconst float PI = 3.1415926535897932384626433832795;\\n\\nvoid main() {\\n  vec2 corner = vUv - mod(vUv, faceWH) + vec2(0, contCorrect / vidWH.y);\\n\\n  vec2 faceWHadj = faceWH - vec2(0, contCorrect * 2. / vidWH.y);\\n\\n  vec2 p = (vUv - corner) / faceWHadj - .5;\\n  vec2 q = 2. / PI * atan(2. * p) + .5;\\n\\n  vec2 eUv = corner + q * faceWHadj;\\n\\n  gl_FragColor = texture2D(mapped, eUv);\\n}\"\n        });\n        var right = [new Vector2(0, 1 / 2), new Vector2(1 / 3, 1 / 2), new Vector2(1 / 3, 1), new Vector2(0, 1)];\n        var front = [new Vector2(1 / 3, 1 / 2), new Vector2(2 / 3, 1 / 2), new Vector2(2 / 3, 1), new Vector2(1 / 3, 1)];\n        var left = [new Vector2(2 / 3, 1 / 2), new Vector2(1, 1 / 2), new Vector2(1, 1), new Vector2(2 / 3, 1)];\n        var bottom = [new Vector2(1 / 3, 0), new Vector2(1 / 3, 1 / 2), new Vector2(0, 1 / 2), new Vector2(0, 0)];\n        var back = [new Vector2(1 / 3, 1 / 2), new Vector2(1 / 3, 0), new Vector2(2 / 3, 0), new Vector2(2 / 3, 1 / 2)];\n        var top = [new Vector2(1, 0), new Vector2(1, 1 / 2), new Vector2(2 / 3, 1 / 2), new Vector2(2 / 3, 0)];\n\n        for (var _i4 = 0, _arr = [right, front, left, bottom, back, top]; _i4 < _arr.length; _i4++) {\n          var face = _arr[_i4];\n          var height = _this2.videoTexture.image.videoHeight;\n          var lowY = 1;\n          var highY = 0;\n\n          for (var _iterator = _createForOfIteratorHelperLoose(face), _step; !(_step = _iterator()).done;) {\n            var vector = _step.value;\n\n            if (vector.y < lowY) {\n              lowY = vector.y;\n            }\n\n            if (vector.y > highY) {\n              highY = vector.y;\n            }\n          }\n\n          for (var _iterator2 = _createForOfIteratorHelperLoose(face), _step2; !(_step2 = _iterator2()).done;) {\n            var _vector = _step2.value;\n\n            if (Math.abs(_vector.y - lowY) < Number.EPSILON) {\n              _vector.y += contCorrect / height;\n            }\n\n            if (Math.abs(_vector.y - highY) < Number.EPSILON) {\n              _vector.y -= contCorrect / height;\n            }\n\n            _vector.x = _vector.x / height * (height - contCorrect * 2) + contCorrect / height;\n          }\n        }\n\n        _this2.movieGeometry.faceVertexUvs[0] = [];\n        _this2.movieGeometry.faceVertexUvs[0][0] = [right[2], right[1], right[3]];\n        _this2.movieGeometry.faceVertexUvs[0][1] = [right[1], right[0], right[3]];\n        _this2.movieGeometry.faceVertexUvs[0][2] = [left[2], left[1], left[3]];\n        _this2.movieGeometry.faceVertexUvs[0][3] = [left[1], left[0], left[3]];\n        _this2.movieGeometry.faceVertexUvs[0][4] = [top[2], top[1], top[3]];\n        _this2.movieGeometry.faceVertexUvs[0][5] = [top[1], top[0], top[3]];\n        _this2.movieGeometry.faceVertexUvs[0][6] = [bottom[2], bottom[1], bottom[3]];\n        _this2.movieGeometry.faceVertexUvs[0][7] = [bottom[1], bottom[0], bottom[3]];\n        _this2.movieGeometry.faceVertexUvs[0][8] = [front[2], front[1], front[3]];\n        _this2.movieGeometry.faceVertexUvs[0][9] = [front[1], front[0], front[3]];\n        _this2.movieGeometry.faceVertexUvs[0][10] = [back[2], back[1], back[3]];\n        _this2.movieGeometry.faceVertexUvs[0][11] = [back[1], back[0], back[3]];\n        _this2.movieScreen = new Mesh(_this2.movieGeometry, _this2.movieMaterial);\n\n        _this2.movieScreen.position.set(position.x, position.y, position.z);\n\n        _this2.movieScreen.rotation.y = -Math.PI;\n        return _this2.movieScreen;\n      };\n\n      if (projection === 'EAC') {\n        this.scene.add(makeScreen(new Matrix3(), new Matrix3()));\n      } else {\n        var scaleMatrix = new Matrix3().set(0, 0.5, 0, 1, 0, 0, 0, 0, 1);\n        makeScreen(new Matrix3().set(0, -0.5, 0.5, 1, 0, 0, 0, 0, 1), scaleMatrix); // display in left eye only\n\n        this.movieScreen.layers.set(1);\n        this.scene.add(this.movieScreen);\n        makeScreen(new Matrix3().set(0, -0.5, 1, 1, 0, 0, 0, 0, 1), scaleMatrix); // display in right eye only\n\n        this.movieScreen.layers.set(2);\n        this.scene.add(this.movieScreen);\n      }\n    }\n\n    this.currentProjection_ = projection;\n  };\n\n  _proto.triggerError_ = function triggerError_(errorObj) {\n    // if we have videojs-errors use it\n    if (this.videojsErrorsSupport_) {\n      this.player_.error(errorObj); // if we don't have videojs-errors just use a normal player error\n    } else {\n      // strip any html content from the error message\n      // as it is not supported outside of videojs-errors\n      var div = document$1.createElement('div');\n      div.innerHTML = errors[errorObj.code].message;\n      var message = div.textContent || div.innerText || '';\n      this.player_.error({\n        code: errorObj.code,\n        message: message\n      });\n    }\n  };\n\n  _proto.log = function log() {\n    if (!this.options_.debug) {\n      return;\n    }\n\n    for (var _len = arguments.length, msgs = new Array(_len), _key = 0; _key < _len; _key++) {\n      msgs[_key] = arguments[_key];\n    }\n\n    msgs.forEach(function (msg) {\n      videojs.log('VR: ', msg);\n    });\n  };\n\n  _proto.handleVrDisplayActivate_ = function handleVrDisplayActivate_() {\n    var _this3 = this;\n\n    if (!this.vrDisplay) {\n      return;\n    }\n\n    this.vrDisplay.requestPresent([{\n      source: this.renderedCanvas\n    }]).then(function () {\n      if (!_this3.vrDisplay.cardboardUI_ || !videojs.browser.IS_IOS) {\n        return;\n      } // webvr-polyfill/cardboard ui only watches for click events\n      // to tell that the back arrow button is pressed during cardboard vr.\n      // but somewhere along the line these events are silenced with preventDefault\n      // but only on iOS, so we translate them ourselves here\n\n\n      var touches = [];\n\n      var iosCardboardTouchStart_ = function iosCardboardTouchStart_(e) {\n        for (var i = 0; i < e.touches.length; i++) {\n          touches.push(e.touches[i]);\n        }\n      };\n\n      var iosCardboardTouchEnd_ = function iosCardboardTouchEnd_(e) {\n        if (!touches.length) {\n          return;\n        }\n\n        touches.forEach(function (t) {\n          var simulatedClick = new window$1.MouseEvent('click', {\n            screenX: t.screenX,\n            screenY: t.screenY,\n            clientX: t.clientX,\n            clientY: t.clientY\n          });\n\n          _this3.renderedCanvas.dispatchEvent(simulatedClick);\n        });\n        touches = [];\n      };\n\n      _this3.renderedCanvas.addEventListener('touchstart', iosCardboardTouchStart_);\n\n      _this3.renderedCanvas.addEventListener('touchend', iosCardboardTouchEnd_);\n\n      _this3.iosRevertTouchToClick_ = function () {\n        _this3.renderedCanvas.removeEventListener('touchstart', iosCardboardTouchStart_);\n\n        _this3.renderedCanvas.removeEventListener('touchend', iosCardboardTouchEnd_);\n\n        _this3.iosRevertTouchToClick_ = null;\n      };\n    });\n  };\n\n  _proto.handleVrDisplayDeactivate_ = function handleVrDisplayDeactivate_() {\n    if (!this.vrDisplay || !this.vrDisplay.isPresenting) {\n      return;\n    }\n\n    if (this.iosRevertTouchToClick_) {\n      this.iosRevertTouchToClick_();\n    }\n\n    this.vrDisplay.exitPresent();\n  };\n\n  _proto.requestAnimationFrame = function requestAnimationFrame(fn) {\n    if (this.vrDisplay) {\n      return this.vrDisplay.requestAnimationFrame(fn);\n    }\n\n    return this.player_.requestAnimationFrame(fn);\n  };\n\n  _proto.cancelAnimationFrame = function cancelAnimationFrame(id) {\n    if (this.vrDisplay) {\n      return this.vrDisplay.cancelAnimationFrame(id);\n    }\n\n    return this.player_.cancelAnimationFrame(id);\n  };\n\n  _proto.togglePlay_ = function togglePlay_() {\n    if (this.player_.paused()) {\n      this.player_.play();\n    } else {\n      this.player_.pause();\n    }\n  };\n\n  _proto.animate_ = function animate_() {\n    if (!this.initialized_) {\n      return;\n    }\n\n    if (this.getVideoEl_().readyState === this.getVideoEl_().HAVE_ENOUGH_DATA) {\n      if (this.videoTexture) {\n        this.videoTexture.needsUpdate = true;\n      }\n    }\n\n    this.controls3d.update();\n\n    if (this.omniController) {\n      this.omniController.update(this.camera);\n    }\n\n    this.effect.render(this.scene, this.camera);\n\n    if (window$1.navigator.getGamepads) {\n      // Grab all gamepads\n      var gamepads = window$1.navigator.getGamepads();\n\n      for (var i = 0; i < gamepads.length; ++i) {\n        var gamepad = gamepads[i]; // Make sure gamepad is defined\n        // Only take input if state has changed since we checked last\n\n        if (!gamepad || !gamepad.timestamp || gamepad.timestamp === this.prevTimestamps_[i]) {\n          continue;\n        }\n\n        for (var j = 0; j < gamepad.buttons.length; ++j) {\n          if (gamepad.buttons[j].pressed) {\n            this.togglePlay_();\n            this.prevTimestamps_[i] = gamepad.timestamp;\n            break;\n          }\n        }\n      }\n    }\n\n    this.camera.getWorldDirection(this.cameraVector);\n    this.animationFrameId_ = this.requestAnimationFrame(this.animate_);\n  };\n\n  _proto.handleResize_ = function handleResize_() {\n    var width = this.player_.currentWidth();\n    var height = this.player_.currentHeight();\n    this.effect.setSize(width, height, false);\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n  };\n\n  _proto.setProjection = function setProjection(projection) {\n    if (!getInternalProjectionName(projection)) {\n      videojs.log.error('videojs-vr: please pass a valid projection ' + validProjections.join(', '));\n      return;\n    }\n\n    this.currentProjection_ = projection;\n    this.defaultProjection_ = projection;\n  };\n\n  _proto.init = function init() {\n    var _this4 = this;\n\n    this.reset();\n    this.camera = new PerspectiveCamera(75, this.player_.currentWidth() / this.player_.currentHeight(), 1, 1000); // Store vector representing the direction in which the camera is looking, in world space.\n\n    this.cameraVector = new Vector3();\n\n    if (this.currentProjection_ === '360_LR' || this.currentProjection_ === '360_TB' || this.currentProjection_ === '180' || this.currentProjection_ === '180_LR' || this.currentProjection_ === '180_MONO' || this.currentProjection_ === 'EAC_LR') {\n      // Render left eye when not in VR mode\n      this.camera.layers.enable(1);\n    }\n\n    this.scene = new Scene();\n    this.videoTexture = new VideoTexture(this.getVideoEl_()); // shared regardless of wether VideoTexture is used or\n    // an image canvas is used\n\n    this.videoTexture.generateMipmaps = false;\n    this.videoTexture.minFilter = LinearFilter;\n    this.videoTexture.magFilter = LinearFilter;\n    this.videoTexture.format = RGBFormat;\n    this.changeProjection_(this.currentProjection_);\n\n    if (this.currentProjection_ === 'NONE') {\n      this.log('Projection is NONE, dont init');\n      this.reset();\n      return;\n    }\n\n    this.player_.removeChild('BigPlayButton');\n    this.player_.addChild('BigVrPlayButton', {}, this.bigPlayButtonIndex_);\n    this.player_.bigPlayButton = this.player_.getChild('BigVrPlayButton'); // mobile devices, or cardboard forced to on\n\n    if (this.options_.forceCardboard || videojs.browser.IS_ANDROID || videojs.browser.IS_IOS) {\n      this.addCardboardButton_();\n    } // if ios remove full screen toggle\n\n\n    if (videojs.browser.IS_IOS && this.player_.controlBar && this.player_.controlBar.fullscreenToggle) {\n      this.player_.controlBar.fullscreenToggle.hide();\n    }\n\n    this.camera.position.set(0, 0, 0);\n    this.renderer = new WebGLRenderer({\n      devicePixelRatio: window$1.devicePixelRatio,\n      alpha: false,\n      clearColor: 0xffffff,\n      antialias: true\n    });\n    var webglContext = this.renderer.getContext('webgl');\n    var oldTexImage2D = webglContext.texImage2D;\n    /* this is a workaround since threejs uses try catch */\n\n    webglContext.texImage2D = function () {\n      try {\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          args[_key2] = arguments[_key2];\n        }\n\n        return oldTexImage2D.apply(webglContext, args);\n      } catch (e) {\n        _this4.reset();\n\n        _this4.player_.pause();\n\n        _this4.triggerError_({\n          code: 'web-vr-hls-cors-not-supported',\n          dismiss: false\n        });\n\n        throw new Error(e);\n      }\n    };\n\n    this.renderer.setSize(this.player_.currentWidth(), this.player_.currentHeight(), false);\n    this.effect = new VREffect(this.renderer);\n    this.effect.setSize(this.player_.currentWidth(), this.player_.currentHeight(), false);\n    this.vrDisplay = null; // Previous timestamps for gamepad updates\n\n    this.prevTimestamps_ = [];\n    this.renderedCanvas = this.renderer.domElement;\n    this.renderedCanvas.setAttribute('style', 'width: 100%; height: 100%; position: absolute; top:0;');\n    var videoElStyle = this.getVideoEl_().style;\n    this.player_.el().insertBefore(this.renderedCanvas, this.player_.el().firstChild);\n    videoElStyle.zIndex = '-1';\n    videoElStyle.opacity = '0';\n\n    if (window$1.navigator.getVRDisplays) {\n      this.log('is supported, getting vr displays');\n      window$1.navigator.getVRDisplays().then(function (displays) {\n        if (displays.length > 0) {\n          _this4.log('Displays found', displays);\n\n          _this4.vrDisplay = displays[0]; // Native WebVR Head Mounted Displays (HMDs) like the HTC Vive\n          // also need the cardboard button to enter fully immersive mode\n          // so, we want to add the button if we're not polyfilled.\n\n          if (!_this4.vrDisplay.isPolyfilled) {\n            _this4.log('Real HMD found using VRControls', _this4.vrDisplay);\n\n            _this4.addCardboardButton_(); // We use VRControls here since we are working with an HMD\n            // and we only want orientation controls.\n\n\n            _this4.controls3d = new VRControls(_this4.camera);\n          }\n        }\n\n        if (!_this4.controls3d) {\n          _this4.log('no HMD found Using Orbit & Orientation Controls');\n\n          var options = {\n            camera: _this4.camera,\n            canvas: _this4.renderedCanvas,\n            // check if its a half sphere view projection\n            halfView: _this4.currentProjection_.indexOf('180') === 0,\n            orientation: videojs.browser.IS_IOS || videojs.browser.IS_ANDROID || false\n          };\n\n          if (_this4.options_.motionControls === false) {\n            options.orientation = false;\n          }\n\n          _this4.controls3d = new OrbitOrientationControls(options);\n          _this4.canvasPlayerControls = new CanvasPlayerControls(_this4.player_, _this4.renderedCanvas, _this4.options_);\n        }\n\n        _this4.animationFrameId_ = _this4.requestAnimationFrame(_this4.animate_);\n      });\n    } else if (window$1.navigator.getVRDevices) {\n      this.triggerError_({\n        code: 'web-vr-out-of-date',\n        dismiss: false\n      });\n    } else {\n      this.triggerError_({\n        code: 'web-vr-not-supported',\n        dismiss: false\n      });\n    }\n\n    if (this.options_.omnitone) {\n      var audiocontext = AudioContext.getContext();\n      this.omniController = new OmnitoneController(audiocontext, this.options_.omnitone, this.getVideoEl_(), this.options_.omnitoneOptions);\n      this.omniController.one('audiocontext-suspended', function () {\n        _this4.player.pause();\n\n        _this4.player.one('playing', function () {\n          audiocontext.resume();\n        });\n      });\n    }\n\n    this.on(this.player_, 'fullscreenchange', this.handleResize_);\n    window$1.addEventListener('vrdisplaypresentchange', this.handleResize_, true);\n    window$1.addEventListener('resize', this.handleResize_, true);\n    window$1.addEventListener('vrdisplayactivate', this.handleVrDisplayActivate_, true);\n    window$1.addEventListener('vrdisplaydeactivate', this.handleVrDisplayDeactivate_, true);\n    this.initialized_ = true;\n    this.trigger('initialized');\n  };\n\n  _proto.addCardboardButton_ = function addCardboardButton_() {\n    if (!this.player_.controlBar.getChild('CardboardButton')) {\n      this.player_.controlBar.addChild('CardboardButton', {});\n    }\n  };\n\n  _proto.getVideoEl_ = function getVideoEl_() {\n    return this.player_.el().getElementsByTagName('video')[0];\n  };\n\n  _proto.reset = function reset() {\n    if (!this.initialized_) {\n      return;\n    }\n\n    if (this.omniController) {\n      this.omniController.off('audiocontext-suspended');\n      this.omniController.dispose();\n      this.omniController = undefined;\n    }\n\n    if (this.controls3d) {\n      this.controls3d.dispose();\n      this.controls3d = null;\n    }\n\n    if (this.canvasPlayerControls) {\n      this.canvasPlayerControls.dispose();\n      this.canvasPlayerControls = null;\n    }\n\n    if (this.effect) {\n      this.effect.dispose();\n      this.effect = null;\n    }\n\n    window$1.removeEventListener('resize', this.handleResize_, true);\n    window$1.removeEventListener('vrdisplaypresentchange', this.handleResize_, true);\n    window$1.removeEventListener('vrdisplayactivate', this.handleVrDisplayActivate_, true);\n    window$1.removeEventListener('vrdisplaydeactivate', this.handleVrDisplayDeactivate_, true); // re-add the big play button to player\n\n    if (!this.player_.getChild('BigPlayButton')) {\n      this.player_.addChild('BigPlayButton', {}, this.bigPlayButtonIndex_);\n    }\n\n    if (this.player_.getChild('BigVrPlayButton')) {\n      this.player_.removeChild('BigVrPlayButton');\n    } // remove the cardboard button\n\n\n    if (this.player_.getChild('CardboardButton')) {\n      this.player_.controlBar.removeChild('CardboardButton');\n    } // show the fullscreen again\n\n\n    if (videojs.browser.IS_IOS && this.player_.controlBar && this.player_.controlBar.fullscreenToggle) {\n      this.player_.controlBar.fullscreenToggle.show();\n    } // reset the video element style so that it will be displayed\n\n\n    var videoElStyle = this.getVideoEl_().style;\n    videoElStyle.zIndex = '';\n    videoElStyle.opacity = ''; // set the current projection to the default\n\n    this.currentProjection_ = this.defaultProjection_; // reset the ios touch to click workaround\n\n    if (this.iosRevertTouchToClick_) {\n      this.iosRevertTouchToClick_();\n    } // remove the old canvas\n\n\n    if (this.renderedCanvas) {\n      this.renderedCanvas.parentNode.removeChild(this.renderedCanvas);\n    }\n\n    if (this.animationFrameId_) {\n      this.cancelAnimationFrame(this.animationFrameId_);\n    }\n\n    this.initialized_ = false;\n  };\n\n  _proto.dispose = function dispose() {\n    _Plugin.prototype.dispose.call(this);\n\n    this.reset();\n  };\n\n  _proto.polyfillVersion = function polyfillVersion() {\n    return WebVRPolyfill.version;\n  };\n\n  return VR;\n}(Plugin);\n\nVR.prototype.setTimeout = Component.prototype.setTimeout;\nVR.prototype.clearTimeout = Component.prototype.clearTimeout;\nVR.VERSION = version;\nvideojs.registerPlugin('vr', VR);\nexport default VR;","map":{"version":3,"sources":["/Users/kian/HAKEE/annotator_app/frontend/node_modules/videojs-vr/dist/videojs-vr.es.js"],"names":["_assertThisInitialized","_inheritsLoose","window$1","document$1","WebVRPolyfill","videojs","Matrix4","Vector3","PerspectiveCamera","Quaternion","EventDispatcher","MOUSE","Spherical","Vector2","Euler","Math","Math$1","SphereBufferGeometry","MeshBasicMaterial","BackSide","Mesh","SphereGeometry","BufferGeometry","BoxGeometry","Matrix3","Scene","VideoTexture","LinearFilter","RGBFormat","WebGLRenderer","AudioContext","ShaderMaterial","version","VRControls","object","onError","scope","vrDisplay","vrDisplays","standingMatrix","frameData","window","VRFrameData","gotVRDisplays","displays","length","navigator","getVRDisplays","then","catch","console","warn","scale","standing","userHeight","getVRDisplay","setVRDisplay","value","getStandingMatrix","update","pose","getFrameData","getPose","orientation","quaternion","fromArray","position","set","stageParameters","updateMatrix","sittingToStandingTransform","applyMatrix","setY","y","multiplyScalar","dispose","VREffect","renderer","eyeTranslationL","eyeTranslationR","renderRectL","renderRectR","headMatrix","eyeMatrixL","eyeMatrixR","isPresenting","rendererSize","getSize","rendererUpdateStyle","rendererPixelRatio","getPixelRatio","setSize","width","height","updateStyle","eyeParamsL","getEyeParameters","setPixelRatio","renderWidth","renderHeight","canvas","domElement","defaultLeftBounds","defaultRightBounds","onVRDisplayPresentChange","wasPresenting","undefined","eyeWidth","eyeHeight","addEventListener","setFullScreen","boolean","Promise","resolve","reject","Error","requestPresent","source","exitPresent","requestAnimationFrame","f","cancelAnimationFrame","h","submitFrame","autoSubmitFrame","cameraL","layers","enable","cameraR","render","scene","camera","renderTarget","forceClear","autoUpdate","updateMatrixWorld","Array","isArray","size","getLayers","leftBounds","rightBounds","layer","x","round","setRenderTarget","scissorTest","setScissorTest","autoClear","clear","parent","matrixWorld","decompose","copy","depthNear","near","depthFar","far","projectionMatrix","elements","leftProjectionMatrix","rightProjectionMatrix","getEyeMatrices","matrix","multiply","eyeParamsR","fovToProjection","fieldOfView","offset","translateOnAxis","viewport","scissor","setViewport","setScissor","removeEventListener","poseOrientation","posePosition","makeRotationFromQuaternion","identity","setPosition","leftViewMatrix","rightViewMatrix","getInverse","fovToNDCScaleOffset","fov","pxscale","leftTan","rightTan","pxoffset","pyscale","upTan","downTan","pyoffset","fovPortToProjection","rightHanded","zNear","zFar","handednessScale","mobj","m","scaleAndOffset","transpose","DEG2RAD","PI","fovPort","tan","upDegrees","downDegrees","leftDegrees","rightDegrees","OrbitControls","document","enabled","target","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","ORBIT","ZOOM","MIDDLE","PAN","target0","clone","position0","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","reset","updateProjectionMatrix","dispatchEvent","changeEvent","state","STATE","NONE","quat","setFromUnitVectors","up","quatInverse","inverse","lastPosition","lastQuaternion","sub","applyQuaternion","setFromVector3","rotateLeft","getAutoRotationAngle","sphericalDelta","max","min","makeSafe","radius","add","panOffset","setFromSpherical","lookAt","zoomChanged","distanceToSquared","EPS","dot","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","onKeyDown","type","startEvent","endEvent","ROTATE","DOLLY","TOUCH_ROTATE","TOUCH_DOLLY_PAN","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","body","isPerspectiveCamera","targetDistance","clientHeight","isOrthographicCamera","right","left","clientWidth","top","bottom","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","event","clientX","clientY","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","subVectors","handleMouseMoveDolly","handleMouseMovePan","handleMouseWheel","handleKeyDown","keyCode","handleTouchStartRotate","touches","pageX","pageY","handleTouchStartDollyPan","dx","dy","sqrt","handleTouchMoveRotate","handleTouchMoveDollyPan","preventDefault","button","stopPropagation","prototype","Object","create","constructor","defineProperties","center","get","noZoom","noRotate","noPan","noKeys","staticMoving","dynamicDampingFactor","DeviceOrientationControls","rotation","reorder","deviceOrientation","screenOrientation","alphaOffset","onDeviceOrientationChangeEvent","onScreenOrientationChangeEvent","setObjectQuaternion","zee","euler","q0","q1","alpha","beta","gamma","orient","setFromEuler","setFromAxisAngle","connect","disconnect","device","degToRad","Quat2Angle","z","w","test","_yaw","atan2","_pitch","_roll","_yaw2","_pitch2","_roll2","sqx","sqy","sqz","yaw","pitch","asin","roll","OrbitOrientationControls","options","orbit","speed","halfView","_proto","currentAngle","lastAngle_","corsSupport","video","createElement","crossOrigin","hasAttribute","validProjections","getInternalProjectionName","projection","toString","trim","i","RegExp","CanvasPlayerControls","_videojs$EventTarget","player","_this","call","onMoveEnd","bind","onMoveStart","onMove","onControlBarMove","controlBar","on","oldReportUserActivity","reportUserActivity","shouldTogglePlay","togglePlay","paused","play","pause","e","disableTogglePlay","controls","dom","isSingleLeftClick","touchMoveCount_","userActive","off","EventTarget","OmnitoneController","audioContext","omnitone","settings","mergeOptions","channelMap","browser","IS_SAFARI","ambisonicOrder","videoElementSource","createMediaElementSource","foaRenderer","createFOARenderer","initialize","trigger","input","output","destination","initialized","error","log","setRotationMatrixFromCamera","setRenderingMode","Button","getComponent","CardboardButton","_Button","handleVrDisplayActivate_","handleVrDisplayDeactivate_","handleVrDisplayPresentChange_","handleOrientationChange_","IS_ANDROID","isFullscreen","hide","show","buildCSSClass","player_","vr","active_","IS_IOS","changeSize_","innerWidth","innerHeight","Event","oldWidth_","currentWidth","oldHeight_","currentHeight","enterFullWindow","exitFullWindow","handleClick","hasStarted","registerComponent","BigPlayButton","BigVrPlayButton","_BigPlayButton","apply","arguments","_createForOfIteratorHelperLoose","o","allowArrayLike","it","Symbol","iterator","next","_unsupportedIterableToArray","done","TypeError","minLen","_arrayLikeToArray","n","slice","name","from","arr","len","arr2","defaults","debug","forceCardboard","omnitoneOptions","sphereDetail","errors","headline","message","Plugin","getPlugin","Component","VR","_Plugin","options_","bigPlayButtonIndex_","children","indexOf","getChild","videojsErrorsSupport_","IE_VERSION","triggerError_","code","dismiss","polyfill_","ROTATE_INSTRUCTIONS_DISABLED","handleResize_","animate_","setProjection","setTimeout","ads","videoElementRecycled","one","init","changeProjection_","_this2","remove","movieScreen","mediainfo","autoProjection","movieGeometry","movieMaterial","map","videoTexture","overdraw","side","geometry","uvs","faceVertexUvs","j","fromGeometry","_i","_j","front","back","_geometry","_uvs","_i2","_j2","_i3","_j3","makeScreen","mapMatrix","scaleMatrix","contCorrect","uniforms","mapped","faceWH","applyMatrix3","vidWH","image","videoWidth","videoHeight","vertexShader","fragmentShader","_i4","_arr","face","lowY","highY","_iterator","_step","vector","_iterator2","_step2","_vector","abs","Number","EPSILON","currentProjection_","errorObj","div","innerHTML","textContent","innerText","_len","msgs","_key","forEach","msg","_this3","renderedCanvas","cardboardUI_","iosCardboardTouchStart_","push","iosCardboardTouchEnd_","t","simulatedClick","MouseEvent","screenX","screenY","iosRevertTouchToClick_","fn","id","togglePlay_","initialized_","getVideoEl_","readyState","HAVE_ENOUGH_DATA","needsUpdate","controls3d","omniController","effect","getGamepads","gamepads","gamepad","timestamp","prevTimestamps_","buttons","pressed","getWorldDirection","cameraVector","animationFrameId_","aspect","join","defaultProjection_","_this4","generateMipmaps","minFilter","magFilter","format","removeChild","addChild","bigPlayButton","addCardboardButton_","fullscreenToggle","devicePixelRatio","clearColor","antialias","webglContext","getContext","oldTexImage2D","texImage2D","_len2","args","_key2","setAttribute","videoElStyle","style","el","insertBefore","firstChild","zIndex","opacity","isPolyfilled","motionControls","canvasPlayerControls","getVRDevices","audiocontext","resume","getElementsByTagName","parentNode","polyfillVersion","clearTimeout","VERSION","registerPlugin"],"mappings":"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","sourcesContent":["/*! @name videojs-vr @version 1.8.0 @license Apache-2.0 */\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inheritsLoose from '@babel/runtime/helpers/inheritsLoose';\nimport window$1 from 'global/window';\nimport document$1 from 'global/document';\nimport WebVRPolyfill from 'webvr-polyfill';\nimport videojs from 'video.js';\nimport { Matrix4, Vector3, PerspectiveCamera, Quaternion, EventDispatcher, MOUSE, Spherical, Vector2, Euler, Math as Math$1, SphereBufferGeometry, MeshBasicMaterial, BackSide, Mesh, SphereGeometry, BufferGeometry, BoxGeometry, Matrix3, Scene, VideoTexture, LinearFilter, RGBFormat, WebGLRenderer, AudioContext, ShaderMaterial } from 'three';\n\nvar version = \"1.8.0\";\n\n/**\n * @author dmarcos / https://github.com/dmarcos\n * @author mrdoob / http://mrdoob.com\n */\nvar VRControls = function ( object, onError ) {\n\n\tvar scope = this;\n\n\tvar vrDisplay, vrDisplays;\n\n\tvar standingMatrix = new Matrix4();\n\n\tvar frameData = null;\n\n\tif ( 'VRFrameData' in window ) {\n\n\t\tframeData = new VRFrameData();\n\n\t}\n\n\tfunction gotVRDisplays( displays ) {\n\n\t\tvrDisplays = displays;\n\n\t\tif ( displays.length > 0 ) {\n\n\t\t\tvrDisplay = displays[ 0 ];\n\n\t\t} else {\n\n\t\t\tif ( onError ) onError( 'VR input not available.' );\n\n\t\t}\n\n\t}\n\n\tif ( navigator.getVRDisplays ) {\n\n\t\tnavigator.getVRDisplays().then( gotVRDisplays ).catch( function () {\n\n\t\t\tconsole.warn( 'VRControls: Unable to get VR Displays' );\n\n\t\t} );\n\n\t}\n\n\t// the Rift SDK returns the position in meters\n\t// this scale factor allows the user to define how meters\n\t// are converted to scene units.\n\n\tthis.scale = 1;\n\n\t// If true will use \"standing space\" coordinate system where y=0 is the\n\t// floor and x=0, z=0 is the center of the room.\n\tthis.standing = false;\n\n\t// Distance from the users eyes to the floor in meters. Used when\n\t// standing=true but the VRDisplay doesn't provide stageParameters.\n\tthis.userHeight = 1.6;\n\n\tthis.getVRDisplay = function () {\n\n\t\treturn vrDisplay;\n\n\t};\n\n\tthis.setVRDisplay = function ( value ) {\n\n\t\tvrDisplay = value;\n\n\t};\n\n\tthis.getVRDisplays = function () {\n\n\t\tconsole.warn( 'VRControls: getVRDisplays() is being deprecated.' );\n\t\treturn vrDisplays;\n\n\t};\n\n\tthis.getStandingMatrix = function () {\n\n\t\treturn standingMatrix;\n\n\t};\n\n\tthis.update = function () {\n\n\t\tif ( vrDisplay ) {\n\n\t\t\tvar pose;\n\n\t\t\tif ( vrDisplay.getFrameData ) {\n\n\t\t\t\tvrDisplay.getFrameData( frameData );\n\t\t\t\tpose = frameData.pose;\n\n\t\t\t} else if ( vrDisplay.getPose ) {\n\n\t\t\t\tpose = vrDisplay.getPose();\n\n\t\t\t}\n\n\t\t\tif ( pose.orientation !== null ) {\n\n\t\t\t\tobject.quaternion.fromArray( pose.orientation );\n\n\t\t\t}\n\n\t\t\tif ( pose.position !== null ) {\n\n\t\t\t\tobject.position.fromArray( pose.position );\n\n\t\t\t} else {\n\n\t\t\t\tobject.position.set( 0, 0, 0 );\n\n\t\t\t}\n\n\t\t\tif ( this.standing ) {\n\n\t\t\t\tif ( vrDisplay.stageParameters ) {\n\n\t\t\t\t\tobject.updateMatrix();\n\n\t\t\t\t\tstandingMatrix.fromArray( vrDisplay.stageParameters.sittingToStandingTransform );\n\t\t\t\t\tobject.applyMatrix( standingMatrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tobject.position.setY( object.position.y + this.userHeight );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tobject.position.multiplyScalar( scope.scale );\n\n\t\t}\n\n\t};\n\n\tthis.dispose = function () {\n\n\t\tvrDisplay = null;\n\n\t};\n\n};\n\n/**\n * @author dmarcos / https://github.com/dmarcos\n * @author mrdoob / http://mrdoob.com\n *\n * WebVR Spec: http://mozvr.github.io/webvr-spec/webvr.html\n *\n * Firefox: http://mozvr.com/downloads/\n * Chromium: https://webvr.info/get-chrome\n */\nvar VREffect = function ( renderer, onError ) {\n\n\tvar vrDisplay, vrDisplays;\n\tvar eyeTranslationL = new Vector3();\n\tvar eyeTranslationR = new Vector3();\n\tvar renderRectL, renderRectR;\n\tvar headMatrix = new Matrix4();\n\tvar eyeMatrixL = new Matrix4();\n\tvar eyeMatrixR = new Matrix4();\n\n\tvar frameData = null;\n\n\tif ( 'VRFrameData' in window ) {\n\n\t\tframeData = new window.VRFrameData();\n\n\t}\n\n\tfunction gotVRDisplays( displays ) {\n\n\t\tvrDisplays = displays;\n\n\t\tif ( displays.length > 0 ) {\n\n\t\t\tvrDisplay = displays[ 0 ];\n\n\t\t} else {\n\n\t\t\tif ( onError ) onError( 'HMD not available' );\n\n\t\t}\n\n\t}\n\n\tif ( navigator.getVRDisplays ) {\n\n\t\tnavigator.getVRDisplays().then( gotVRDisplays ).catch( function () {\n\n\t\t\tconsole.warn( 'VREffect: Unable to get VR Displays' );\n\n\t\t} );\n\n\t}\n\n\t//\n\n\tthis.isPresenting = false;\n\n\tvar scope = this;\n\n\tvar rendererSize = renderer.getSize();\n\tvar rendererUpdateStyle = false;\n\tvar rendererPixelRatio = renderer.getPixelRatio();\n\n\tthis.getVRDisplay = function () {\n\n\t\treturn vrDisplay;\n\n\t};\n\n\tthis.setVRDisplay = function ( value ) {\n\n\t\tvrDisplay = value;\n\n\t};\n\n\tthis.getVRDisplays = function () {\n\n\t\tconsole.warn( 'VREffect: getVRDisplays() is being deprecated.' );\n\t\treturn vrDisplays;\n\n\t};\n\n\tthis.setSize = function ( width, height, updateStyle ) {\n\n\t\trendererSize = { width: width, height: height };\n\t\trendererUpdateStyle = updateStyle;\n\n\t\tif ( scope.isPresenting ) {\n\n\t\t\tvar eyeParamsL = vrDisplay.getEyeParameters( 'left' );\n\t\t\trenderer.setPixelRatio( 1 );\n\t\t\trenderer.setSize( eyeParamsL.renderWidth * 2, eyeParamsL.renderHeight, false );\n\n\t\t} else {\n\n\t\t\trenderer.setPixelRatio( rendererPixelRatio );\n\t\t\trenderer.setSize( width, height, updateStyle );\n\n\t\t}\n\n\t};\n\n\t// VR presentation\n\n\tvar canvas = renderer.domElement;\n\tvar defaultLeftBounds = [ 0.0, 0.0, 0.5, 1.0 ];\n\tvar defaultRightBounds = [ 0.5, 0.0, 0.5, 1.0 ];\n\n\tfunction onVRDisplayPresentChange() {\n\n\t\tvar wasPresenting = scope.isPresenting;\n\t\tscope.isPresenting = vrDisplay !== undefined && vrDisplay.isPresenting;\n\n\t\tif ( scope.isPresenting ) {\n\n\t\t\tvar eyeParamsL = vrDisplay.getEyeParameters( 'left' );\n\t\t\tvar eyeWidth = eyeParamsL.renderWidth;\n\t\t\tvar eyeHeight = eyeParamsL.renderHeight;\n\n\t\t\tif ( ! wasPresenting ) {\n\n\t\t\t\trendererPixelRatio = renderer.getPixelRatio();\n\t\t\t\trendererSize = renderer.getSize();\n\n\t\t\t\trenderer.setPixelRatio( 1 );\n\t\t\t\trenderer.setSize( eyeWidth * 2, eyeHeight, false );\n\n\t\t\t}\n\n\t\t} else if ( wasPresenting ) {\n\n\t\t\trenderer.setPixelRatio( rendererPixelRatio );\n\t\t\trenderer.setSize( rendererSize.width, rendererSize.height, rendererUpdateStyle );\n\n\t\t}\n\n\t}\n\n\twindow.addEventListener( 'vrdisplaypresentchange', onVRDisplayPresentChange, false );\n\n\tthis.setFullScreen = function ( boolean ) {\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tif ( vrDisplay === undefined ) {\n\n\t\t\t\treject( new Error( 'No VR hardware found.' ) );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( scope.isPresenting === boolean ) {\n\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( boolean ) {\n\n\t\t\t\tresolve( vrDisplay.requestPresent( [ { source: canvas } ] ) );\n\n\t\t\t} else {\n\n\t\t\t\tresolve( vrDisplay.exitPresent() );\n\n\t\t\t}\n\n\t\t} );\n\n\t};\n\n\tthis.requestPresent = function () {\n\n\t\treturn this.setFullScreen( true );\n\n\t};\n\n\tthis.exitPresent = function () {\n\n\t\treturn this.setFullScreen( false );\n\n\t};\n\n\tthis.requestAnimationFrame = function ( f ) {\n\n\t\tif ( vrDisplay !== undefined ) {\n\n\t\t\treturn vrDisplay.requestAnimationFrame( f );\n\n\t\t} else {\n\n\t\t\treturn window.requestAnimationFrame( f );\n\n\t\t}\n\n\t};\n\n\tthis.cancelAnimationFrame = function ( h ) {\n\n\t\tif ( vrDisplay !== undefined ) {\n\n\t\t\tvrDisplay.cancelAnimationFrame( h );\n\n\t\t} else {\n\n\t\t\twindow.cancelAnimationFrame( h );\n\n\t\t}\n\n\t};\n\n\tthis.submitFrame = function () {\n\n\t\tif ( vrDisplay !== undefined && scope.isPresenting ) {\n\n\t\t\tvrDisplay.submitFrame();\n\n\t\t}\n\n\t};\n\n\tthis.autoSubmitFrame = true;\n\n\t// render\n\n\tvar cameraL = new PerspectiveCamera();\n\tcameraL.layers.enable( 1 );\n\n\tvar cameraR = new PerspectiveCamera();\n\tcameraR.layers.enable( 2 );\n\n\tthis.render = function ( scene, camera, renderTarget, forceClear ) {\n\n\t\tif ( vrDisplay && scope.isPresenting ) {\n\n\t\t\tvar autoUpdate = scene.autoUpdate;\n\n\t\t\tif ( autoUpdate ) {\n\n\t\t\t\tscene.updateMatrixWorld();\n\t\t\t\tscene.autoUpdate = false;\n\n\t\t\t}\n\n\t\t\tif ( Array.isArray( scene ) ) {\n\n\t\t\t\tconsole.warn( 'VREffect.render() no longer supports arrays. Use object.layers instead.' );\n\t\t\t\tscene = scene[ 0 ];\n\n\t\t\t}\n\n\t\t\t// When rendering we don't care what the recommended size is, only what the actual size\n\t\t\t// of the backbuffer is.\n\t\t\tvar size = renderer.getSize();\n\t\t\tvar layers = vrDisplay.getLayers();\n\t\t\tvar leftBounds;\n\t\t\tvar rightBounds;\n\n\t\t\tif ( layers.length ) {\n\n\t\t\t\tvar layer = layers[ 0 ];\n\n\t\t\t\tleftBounds = layer.leftBounds !== null && layer.leftBounds.length === 4 ? layer.leftBounds : defaultLeftBounds;\n\t\t\t\trightBounds = layer.rightBounds !== null && layer.rightBounds.length === 4 ? layer.rightBounds : defaultRightBounds;\n\n\t\t\t} else {\n\n\t\t\t\tleftBounds = defaultLeftBounds;\n\t\t\t\trightBounds = defaultRightBounds;\n\n\t\t\t}\n\n\t\t\trenderRectL = {\n\t\t\t\tx: Math.round( size.width * leftBounds[ 0 ] ),\n\t\t\t\ty: Math.round( size.height * leftBounds[ 1 ] ),\n\t\t\t\twidth: Math.round( size.width * leftBounds[ 2 ] ),\n\t\t\t\theight: Math.round( size.height * leftBounds[ 3 ] )\n\t\t\t};\n\t\t\trenderRectR = {\n\t\t\t\tx: Math.round( size.width * rightBounds[ 0 ] ),\n\t\t\t\ty: Math.round( size.height * rightBounds[ 1 ] ),\n\t\t\t\twidth: Math.round( size.width * rightBounds[ 2 ] ),\n\t\t\t\theight: Math.round( size.height * rightBounds[ 3 ] )\n\t\t\t};\n\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderer.setRenderTarget( renderTarget );\n\t\t\t\trenderTarget.scissorTest = true;\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setRenderTarget( null );\n\t\t\t\trenderer.setScissorTest( true );\n\n\t\t\t}\n\n\t\t\tif ( renderer.autoClear || forceClear ) renderer.clear();\n\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t\tcamera.matrixWorld.decompose( cameraL.position, cameraL.quaternion, cameraL.scale );\n\n\t\t\tcameraR.position.copy( cameraL.position );\n\t\t\tcameraR.quaternion.copy( cameraL.quaternion );\n\t\t\tcameraR.scale.copy( cameraL.scale );\n\n\t\t\tif ( vrDisplay.getFrameData ) {\n\n\t\t\t\tvrDisplay.depthNear = camera.near;\n\t\t\t\tvrDisplay.depthFar = camera.far;\n\n\t\t\t\tvrDisplay.getFrameData( frameData );\n\n\t\t\t\tcameraL.projectionMatrix.elements = frameData.leftProjectionMatrix;\n\t\t\t\tcameraR.projectionMatrix.elements = frameData.rightProjectionMatrix;\n\n\t\t\t\tgetEyeMatrices( frameData );\n\n\t\t\t\tcameraL.updateMatrix();\n\t\t\t\tcameraL.matrix.multiply( eyeMatrixL );\n\t\t\t\tcameraL.matrix.decompose( cameraL.position, cameraL.quaternion, cameraL.scale );\n\n\t\t\t\tcameraR.updateMatrix();\n\t\t\t\tcameraR.matrix.multiply( eyeMatrixR );\n\t\t\t\tcameraR.matrix.decompose( cameraR.position, cameraR.quaternion, cameraR.scale );\n\n\t\t\t} else {\n\n\t\t\t\tvar eyeParamsL = vrDisplay.getEyeParameters( 'left' );\n\t\t\t\tvar eyeParamsR = vrDisplay.getEyeParameters( 'right' );\n\n\t\t\t\tcameraL.projectionMatrix = fovToProjection( eyeParamsL.fieldOfView, true, camera.near, camera.far );\n\t\t\t\tcameraR.projectionMatrix = fovToProjection( eyeParamsR.fieldOfView, true, camera.near, camera.far );\n\n\t\t\t\teyeTranslationL.fromArray( eyeParamsL.offset );\n\t\t\t\teyeTranslationR.fromArray( eyeParamsR.offset );\n\n\t\t\t\tcameraL.translateOnAxis( eyeTranslationL, cameraL.scale.x );\n\t\t\t\tcameraR.translateOnAxis( eyeTranslationR, cameraR.scale.x );\n\n\t\t\t}\n\n\t\t\t// render left eye\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderTarget.viewport.set( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\t\t\t\trenderTarget.scissor.set( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setViewport( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\t\t\t\trenderer.setScissor( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\n\t\t\t}\n\t\t\trenderer.render( scene, cameraL, renderTarget, forceClear );\n\n\t\t\t// render right eye\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderTarget.viewport.set( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\t\t\t\trenderTarget.scissor.set( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setViewport( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\t\t\t\trenderer.setScissor( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\n\t\t\t}\n\t\t\trenderer.render( scene, cameraR, renderTarget, forceClear );\n\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderTarget.viewport.set( 0, 0, size.width, size.height );\n\t\t\t\trenderTarget.scissor.set( 0, 0, size.width, size.height );\n\t\t\t\trenderTarget.scissorTest = false;\n\t\t\t\trenderer.setRenderTarget( null );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setViewport( 0, 0, size.width, size.height );\n\t\t\t\trenderer.setScissorTest( false );\n\n\t\t\t}\n\n\t\t\tif ( autoUpdate ) {\n\n\t\t\t\tscene.autoUpdate = true;\n\n\t\t\t}\n\n\t\t\tif ( scope.autoSubmitFrame ) {\n\n\t\t\t\tscope.submitFrame();\n\n\t\t\t}\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t// Regular render mode if not HMD\n\n\t\trenderer.render( scene, camera, renderTarget, forceClear );\n\n\t};\n\n\tthis.dispose = function () {\n\n\t\twindow.removeEventListener( 'vrdisplaypresentchange', onVRDisplayPresentChange, false );\n\n\t};\n\n\t//\n\n\tvar poseOrientation = new Quaternion();\n\tvar posePosition = new Vector3();\n\n\t// Compute model matrices of the eyes with respect to the head.\n\tfunction getEyeMatrices( frameData ) {\n\n\t\t// Compute the matrix for the position of the head based on the pose\n\t\tif ( frameData.pose.orientation ) {\n\n\t\t\tposeOrientation.fromArray( frameData.pose.orientation );\n\t\t\theadMatrix.makeRotationFromQuaternion( poseOrientation );\n\n\t\t}\telse {\n\n\t\t\theadMatrix.identity();\n\n\t\t}\n\n\t\tif ( frameData.pose.position ) {\n\n\t\t\tposePosition.fromArray( frameData.pose.position );\n\t\t\theadMatrix.setPosition( posePosition );\n\n\t\t}\n\n\t\t// The view matrix transforms vertices from sitting space to eye space. As such, the view matrix can be thought of as a product of two matrices:\n\t\t// headToEyeMatrix * sittingToHeadMatrix\n\n\t\t// The headMatrix that we've calculated above is the model matrix of the head in sitting space, which is the inverse of sittingToHeadMatrix.\n\t\t// So when we multiply the view matrix with headMatrix, we're left with headToEyeMatrix:\n\t\t// viewMatrix * headMatrix = headToEyeMatrix * sittingToHeadMatrix * headMatrix = headToEyeMatrix\n\n\t\teyeMatrixL.fromArray( frameData.leftViewMatrix );\n\t\teyeMatrixL.multiply( headMatrix );\n\t\teyeMatrixR.fromArray( frameData.rightViewMatrix );\n\t\teyeMatrixR.multiply( headMatrix );\n\n\t\t// The eye's model matrix in head space is the inverse of headToEyeMatrix we calculated above.\n\n\t\teyeMatrixL.getInverse( eyeMatrixL );\n\t\teyeMatrixR.getInverse( eyeMatrixR );\n\n\t}\n\n\tfunction fovToNDCScaleOffset( fov ) {\n\n\t\tvar pxscale = 2.0 / ( fov.leftTan + fov.rightTan );\n\t\tvar pxoffset = ( fov.leftTan - fov.rightTan ) * pxscale * 0.5;\n\t\tvar pyscale = 2.0 / ( fov.upTan + fov.downTan );\n\t\tvar pyoffset = ( fov.upTan - fov.downTan ) * pyscale * 0.5;\n\t\treturn { scale: [ pxscale, pyscale ], offset: [ pxoffset, pyoffset ] };\n\n\t}\n\n\tfunction fovPortToProjection( fov, rightHanded, zNear, zFar ) {\n\n\t\trightHanded = rightHanded === undefined ? true : rightHanded;\n\t\tzNear = zNear === undefined ? 0.01 : zNear;\n\t\tzFar = zFar === undefined ? 10000.0 : zFar;\n\n\t\tvar handednessScale = rightHanded ? - 1.0 : 1.0;\n\n\t\t// start with an identity matrix\n\t\tvar mobj = new Matrix4();\n\t\tvar m = mobj.elements;\n\n\t\t// and with scale/offset info for normalized device coords\n\t\tvar scaleAndOffset = fovToNDCScaleOffset( fov );\n\n\t\t// X result, map clip edges to [-w,+w]\n\t\tm[ 0 * 4 + 0 ] = scaleAndOffset.scale[ 0 ];\n\t\tm[ 0 * 4 + 1 ] = 0.0;\n\t\tm[ 0 * 4 + 2 ] = scaleAndOffset.offset[ 0 ] * handednessScale;\n\t\tm[ 0 * 4 + 3 ] = 0.0;\n\n\t\t// Y result, map clip edges to [-w,+w]\n\t\t// Y offset is negated because this proj matrix transforms from world coords with Y=up,\n\t\t// but the NDC scaling has Y=down (thanks D3D?)\n\t\tm[ 1 * 4 + 0 ] = 0.0;\n\t\tm[ 1 * 4 + 1 ] = scaleAndOffset.scale[ 1 ];\n\t\tm[ 1 * 4 + 2 ] = - scaleAndOffset.offset[ 1 ] * handednessScale;\n\t\tm[ 1 * 4 + 3 ] = 0.0;\n\n\t\t// Z result (up to the app)\n\t\tm[ 2 * 4 + 0 ] = 0.0;\n\t\tm[ 2 * 4 + 1 ] = 0.0;\n\t\tm[ 2 * 4 + 2 ] = zFar / ( zNear - zFar ) * - handednessScale;\n\t\tm[ 2 * 4 + 3 ] = ( zFar * zNear ) / ( zNear - zFar );\n\n\t\t// W result (= Z in)\n\t\tm[ 3 * 4 + 0 ] = 0.0;\n\t\tm[ 3 * 4 + 1 ] = 0.0;\n\t\tm[ 3 * 4 + 2 ] = handednessScale;\n\t\tm[ 3 * 4 + 3 ] = 0.0;\n\n\t\tmobj.transpose();\n\t\treturn mobj;\n\n\t}\n\n\tfunction fovToProjection( fov, rightHanded, zNear, zFar ) {\n\n\t\tvar DEG2RAD = Math.PI / 180.0;\n\n\t\tvar fovPort = {\n\t\t\tupTan: Math.tan( fov.upDegrees * DEG2RAD ),\n\t\t\tdownTan: Math.tan( fov.downDegrees * DEG2RAD ),\n\t\t\tleftTan: Math.tan( fov.leftDegrees * DEG2RAD ),\n\t\t\trightTan: Math.tan( fov.rightDegrees * DEG2RAD )\n\t\t};\n\n\t\treturn fovPortToProjection( fovPort, rightHanded, zNear, zFar );\n\n\t}\n\n};\n\n/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n */\nvar OrbitControls = function ( object, domElement ) {\n\n\tthis.object = object;\n\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\n\n\t// Set to false to disable this control\n\tthis.enabled = true;\n\n\t// \"target\" sets the location of focus, where the object orbits around\n\tthis.target = new Vector3();\n\n\t// How far you can dolly in and out ( PerspectiveCamera only )\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\t// How far you can zoom in and out ( OrthographicCamera only )\n\tthis.minZoom = 0;\n\tthis.maxZoom = Infinity;\n\n\t// How far you can orbit vertically, upper and lower limits.\n\t// Range is 0 to Math.PI radians.\n\tthis.minPolarAngle = 0; // radians\n\tthis.maxPolarAngle = Math.PI; // radians\n\n\t// How far you can orbit horizontally, upper and lower limits.\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n\tthis.minAzimuthAngle = - Infinity; // radians\n\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t// Set to true to enable damping (inertia)\n\t// If damping is enabled, you must call controls.update() in your animation loop\n\tthis.enableDamping = false;\n\tthis.dampingFactor = 0.25;\n\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t// Set to false to disable zooming\n\tthis.enableZoom = true;\n\tthis.zoomSpeed = 1.0;\n\n\t// Set to false to disable rotating\n\tthis.enableRotate = true;\n\tthis.rotateSpeed = 1.0;\n\n\t// Set to false to disable panning\n\tthis.enablePan = true;\n\tthis.panSpeed = 1.0;\n\tthis.screenSpacePanning = false; // if true, pan in screen-space\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t// Set to true to automatically rotate around the target\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\tthis.autoRotate = false;\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n\t// Set to false to disable use of the keys\n\tthis.enableKeys = true;\n\n\t// The four arrow keys\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n\t// Mouse buttons\n\tthis.mouseButtons = { ORBIT: MOUSE.LEFT, ZOOM: MOUSE.MIDDLE, PAN: MOUSE.RIGHT };\n\n\t// for reset\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t//\n\t// public methods\n\t//\n\n\tthis.getPolarAngle = function () {\n\n\t\treturn spherical.phi;\n\n\t};\n\n\tthis.getAzimuthalAngle = function () {\n\n\t\treturn spherical.theta;\n\n\t};\n\n\tthis.saveState = function () {\n\n\t\tscope.target0.copy( scope.target );\n\t\tscope.position0.copy( scope.object.position );\n\t\tscope.zoom0 = scope.object.zoom;\n\n\t};\n\n\tthis.reset = function () {\n\n\t\tscope.target.copy( scope.target0 );\n\t\tscope.object.position.copy( scope.position0 );\n\t\tscope.object.zoom = scope.zoom0;\n\n\t\tscope.object.updateProjectionMatrix();\n\t\tscope.dispatchEvent( changeEvent );\n\n\t\tscope.update();\n\n\t\tstate = STATE.NONE;\n\n\t};\n\n\t// this method is exposed, but perhaps it would be better if we can make it private...\n\tthis.update = function () {\n\n\t\tvar offset = new Vector3();\n\n\t\t// so camera.up is the orbit axis\n\t\tvar quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\tvar quatInverse = quat.clone().inverse();\n\n\t\tvar lastPosition = new Vector3();\n\t\tvar lastQuaternion = new Quaternion();\n\n\t\treturn function update() {\n\n\t\t\tvar position = scope.object.position;\n\n\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t// angle from z-axis around y-axis\n\t\t\tspherical.setFromVector3( offset );\n\n\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\tscope.rotateLeft( getAutoRotationAngle() );\n\n\t\t\t}\n\n\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t// restrict theta to be between desired limits\n\t\t\tspherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\n\n\t\t\t// restrict phi to be between desired limits\n\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\tspherical.makeSafe();\n\n\n\t\t\tspherical.radius *= scale;\n\n\t\t\t// restrict radius to be between desired limits\n\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t// move target to panned location\n\t\t\tscope.target.add( panOffset );\n\n\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t} else {\n\n\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t}\n\n\t\t\tscale = 1;\n\n\t\t\t// update condition is:\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\tif ( zoomChanged ||\n\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\tscope.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\tzoomChanged = false;\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t};\n\n\t}();\n\n\tthis.dispose = function () {\n\n\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\n\t\tscope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\n\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\n\n\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\n\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\n\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\n\t\twindow.removeEventListener( 'keydown', onKeyDown, false );\n\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t};\n\n\t//\n\t// internals\n\t//\n\n\tvar scope = this;\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\tvar STATE = { NONE: - 1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY_PAN: 4 };\n\n\tvar state = STATE.NONE;\n\n\tvar EPS = 0.000001;\n\n\t// current position in spherical coordinates\n\tvar spherical = new Spherical();\n\tvar sphericalDelta = new Spherical();\n\n\tvar scale = 1;\n\tvar panOffset = new Vector3();\n\tvar zoomChanged = false;\n\n\tvar rotateStart = new Vector2();\n\tvar rotateEnd = new Vector2();\n\tvar rotateDelta = new Vector2();\n\n\tvar panStart = new Vector2();\n\tvar panEnd = new Vector2();\n\tvar panDelta = new Vector2();\n\n\tvar dollyStart = new Vector2();\n\tvar dollyEnd = new Vector2();\n\tvar dollyDelta = new Vector2();\n\n\tfunction getAutoRotationAngle() {\n\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t}\n\n\tfunction getZoomScale() {\n\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t}\n\n\tscope.rotateLeft = function( angle ) {\n\n\t\tsphericalDelta.theta -= angle;\n\n\t};\n\n\tscope.rotateUp = function( angle ) {\n\n\t\tsphericalDelta.phi -= angle;\n\n\t};\n\n\tvar panLeft = function () {\n\n\t\tvar v = new Vector3();\n\n\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\tv.multiplyScalar( - distance );\n\n\t\t\tpanOffset.add( v );\n\n\t\t};\n\n\t}();\n\n\tvar panUp = function () {\n\n\t\tvar v = new Vector3();\n\n\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t} else {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t}\n\n\t\t\tv.multiplyScalar( distance );\n\n\t\t\tpanOffset.add( v );\n\n\t\t};\n\n\t}();\n\n\t// deltaX and deltaY are in pixels; right and down are positive\n\tvar pan = function () {\n\n\t\tvar offset = new Vector3();\n\n\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t// perspective\n\t\t\t\tvar position = scope.object.position;\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\tvar targetDistance = offset.length();\n\n\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t// orthographic\n\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t} else {\n\n\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\tscope.enablePan = false;\n\n\t\t\t}\n\n\t\t};\n\n\t}();\n\n\tfunction dollyIn( dollyScale ) {\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscale /= dollyScale;\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\tfunction dollyOut( dollyScale ) {\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscale *= dollyScale;\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t//\n\t// event callbacks - update the object state\n\t//\n\n\tfunction handleMouseDownRotate( event ) {\n\n\t\t//console.log( 'handleMouseDownRotate' );\n\n\t\trotateStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseDownDolly( event ) {\n\n\t\t//console.log( 'handleMouseDownDolly' );\n\n\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseDownPan( event ) {\n\n\t\t//console.log( 'handleMouseDownPan' );\n\n\t\tpanStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseMoveRotate( event ) {\n\n\t\t//console.log( 'handleMouseMoveRotate' );\n\n\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tscope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\tscope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\trotateStart.copy( rotateEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMoveDolly( event ) {\n\n\t\t//console.log( 'handleMouseMoveDolly' );\n\n\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\tdollyIn( getZoomScale() );\n\n\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\tdollyOut( getZoomScale() );\n\n\t\t}\n\n\t\tdollyStart.copy( dollyEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMovePan( event ) {\n\n\t\t//console.log( 'handleMouseMovePan' );\n\n\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\tpan( panDelta.x, panDelta.y );\n\n\t\tpanStart.copy( panEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseWheel( event ) {\n\n\t\t// console.log( 'handleMouseWheel' );\n\n\t\tif ( event.deltaY < 0 ) {\n\n\t\t\tdollyOut( getZoomScale() );\n\n\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\tdollyIn( getZoomScale() );\n\n\t\t}\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleKeyDown( event ) {\n\n\t\t//console.log( 'handleKeyDown' );\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase scope.keys.UP:\n\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.LEFT:\n\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.RIGHT:\n\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartRotate( event ) {\n\n\t\t//console.log( 'handleTouchStartRotate' );\n\n\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t}\n\n\tfunction handleTouchStartDollyPan( event ) {\n\n\t\t//console.log( 'handleTouchStartDollyPan' );\n\n\t\tif ( scope.enableZoom ) {\n\n\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tif ( scope.enablePan ) {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\tpanStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchMoveRotate( event ) {\n\n\t\t//console.log( 'handleTouchMoveRotate' );\n\n\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tscope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\tscope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\trotateStart.copy( rotateEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t//console.log( 'handleTouchMoveDollyPan' );\n\n\t\tif ( scope.enableZoom ) {\n\n\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyIn( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tif ( scope.enablePan ) {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\tpanEnd.set( x, y );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tscope.update();\n\n\t}\n\n\t//\n\t// event handlers - FSM: listen for events and reset state\n\t//\n\n\tfunction onMouseDown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.button ) {\n\n\t\t\tcase scope.mouseButtons.ORBIT:\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\tbreak;\n\n\t\t\tcase scope.mouseButtons.ZOOM:\n\n\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\tbreak;\n\n\t\t\tcase scope.mouseButtons.PAN:\n\n\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( state !== STATE.NONE ) {\n\n\t\t\tdocument.addEventListener( 'mousemove', onMouseMove, false );\n\t\t\tdocument.addEventListener( 'mouseup', onMouseUp, false );\n\n\t\t\tscope.dispatchEvent( startEvent );\n\n\t\t}\n\n\t}\n\n\tfunction onMouseMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( state ) {\n\n\t\t\tcase STATE.ROTATE:\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.DOLLY:\n\n\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.PAN:\n\n\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction onMouseUp( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onMouseWheel( event ) {\n\n\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tscope.dispatchEvent( startEvent );\n\n\t\thandleMouseWheel( event );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction onKeyDown( event ) {\n\n\t\tif ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\n\n\t\thandleKeyDown( event );\n\n\t}\n\n\tfunction onTouchStart( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\t// one-fingered touch: rotate\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleTouchStartRotate( event );\n\n\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\t// two-fingered touch: dolly-pan\n\n\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\thandleTouchStartDollyPan( event );\n\n\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tif ( state !== STATE.NONE ) {\n\n\t\t\tscope.dispatchEvent( startEvent );\n\n\t\t}\n\n\t}\n\n\tfunction onTouchMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1: // one-fingered touch: rotate\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\t\t\t\tif ( state !== STATE.TOUCH_ROTATE ) return; // is this needed?\n\n\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2: // two-fingered touch: dolly-pan\n\n\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\t\t\t\tif ( state !== STATE.TOUCH_DOLLY_PAN ) return; // is this needed?\n\n\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t}\n\n\tfunction onTouchEnd( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onContextMenu( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\t//\n\n\t//scope.domElement.addEventListener\\( 'contextmenu', onContextMenu, false );\n\n\tscope.domElement.addEventListener( 'mousedown', onMouseDown, false );\n\tscope.domElement.addEventListener( 'wheel', onMouseWheel, false );\n\n\tscope.domElement.addEventListener( 'touchstart', onTouchStart, false );\n\tscope.domElement.addEventListener( 'touchend', onTouchEnd, false );\n\tscope.domElement.addEventListener( 'touchmove', onTouchMove, false );\n\n\twindow.addEventListener( 'keydown', onKeyDown, false );\n\n\t// force an update at start\n\n\tthis.update();\n\n};\n\nOrbitControls.prototype = Object.create( EventDispatcher.prototype );\nOrbitControls.prototype.constructor = OrbitControls;\n\nObject.defineProperties( OrbitControls.prototype, {\n\n\tcenter: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .center has been renamed to .target' );\n\t\t\treturn this.target;\n\n\t\t}\n\n\t},\n\n\t// backward compatibility\n\n\tnoZoom: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\n\t\t\treturn ! this.enableZoom;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tconsole.warn( 'OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\n\t\t\tthis.enableZoom = ! value;\n\n\t\t}\n\n\t},\n\n\tnoRotate: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\n\t\t\treturn ! this.enableRotate;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tconsole.warn( 'OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\n\t\t\tthis.enableRotate = ! value;\n\n\t\t}\n\n\t},\n\n\tnoPan: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\n\t\t\treturn ! this.enablePan;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tconsole.warn( 'OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\n\t\t\tthis.enablePan = ! value;\n\n\t\t}\n\n\t},\n\n\tnoKeys: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\n\t\t\treturn ! this.enableKeys;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tconsole.warn( 'OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\n\t\t\tthis.enableKeys = ! value;\n\n\t\t}\n\n\t},\n\n\tstaticMoving: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\n\t\t\treturn ! this.enableDamping;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tconsole.warn( 'OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\n\t\t\tthis.enableDamping = ! value;\n\n\t\t}\n\n\t},\n\n\tdynamicDampingFactor: {\n\n\t\tget: function () {\n\n\t\t\tconsole.warn( 'OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\n\t\t\treturn this.dampingFactor;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tconsole.warn( 'OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\n\t\t\tthis.dampingFactor = value;\n\n\t\t}\n\n\t}\n\n} );\n\n/**\n * @author richt / http://richt.me\n * @author WestLangley / http://github.com/WestLangley\n *\n * W3C Device Orientation control (http://w3c.github.io/deviceorientation/spec-source-orientation.html)\n */\nvar DeviceOrientationControls = function ( object ) {\n\n\tvar scope = this;\n\n\tthis.object = object;\n\tthis.object.rotation.reorder( 'YXZ' );\n\n\tthis.enabled = true;\n\n\tthis.deviceOrientation = {};\n\tthis.screenOrientation = 0;\n\n\tthis.alphaOffset = 0; // radians\n\n\tvar onDeviceOrientationChangeEvent = function ( event ) {\n\n\t\tscope.deviceOrientation = event;\n\n\t};\n\n\tvar onScreenOrientationChangeEvent = function () {\n\n\t\tscope.screenOrientation = window.orientation || 0;\n\n\t};\n\n\t// The angles alpha, beta and gamma form a set of intrinsic Tait-Bryan angles of type Z-X'-Y''\n\n\tvar setObjectQuaternion = function () {\n\n\t\tvar zee = new Vector3( 0, 0, 1 );\n\n\t\tvar euler = new Euler();\n\n\t\tvar q0 = new Quaternion();\n\n\t\tvar q1 = new Quaternion( - Math.sqrt( 0.5 ), 0, 0, Math.sqrt( 0.5 ) ); // - PI/2 around the x-axis\n\n\t\treturn function ( quaternion, alpha, beta, gamma, orient ) {\n\n\t\t\teuler.set( beta, alpha, - gamma, 'YXZ' ); // 'ZXY' for the device, but 'YXZ' for us\n\n\t\t\tquaternion.setFromEuler( euler ); // orient the device\n\n\t\t\tquaternion.multiply( q1 ); // camera looks out the back of the device, not the top\n\n\t\t\tquaternion.multiply( q0.setFromAxisAngle( zee, - orient ) ); // adjust for screen orientation\n\n\t\t};\n\n\t}();\n\n\tthis.connect = function () {\n\n\t\tonScreenOrientationChangeEvent(); // run once on load\n\n\t\twindow.addEventListener( 'orientationchange', onScreenOrientationChangeEvent, false );\n\t\twindow.addEventListener( 'deviceorientation', onDeviceOrientationChangeEvent, false );\n\n\t\tscope.enabled = true;\n\n\t};\n\n\tthis.disconnect = function () {\n\n\t\twindow.removeEventListener( 'orientationchange', onScreenOrientationChangeEvent, false );\n\t\twindow.removeEventListener( 'deviceorientation', onDeviceOrientationChangeEvent, false );\n\n\t\tscope.enabled = false;\n\n\t};\n\n\tthis.update = function () {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tvar device = scope.deviceOrientation;\n\n\t\tif ( device ) {\n\n\t\t\tvar alpha = device.alpha ? Math$1.degToRad( device.alpha ) + scope.alphaOffset : 0; // Z\n\n\t\t\tvar beta = device.beta ? Math$1.degToRad( device.beta ) : 0; // X'\n\n\t\t\tvar gamma = device.gamma ? Math$1.degToRad( device.gamma ) : 0; // Y''\n\n\t\t\tvar orient = scope.screenOrientation ? Math$1.degToRad( scope.screenOrientation ) : 0; // O\n\n\t\t\tsetObjectQuaternion( scope.object.quaternion, alpha, beta, gamma, orient );\n\n\t\t}\n\n\n\t};\n\n\tthis.dispose = function () {\n\n\t\tscope.disconnect();\n\n\t};\n\n\tthis.connect();\n\n};\n\n/**\n * Convert a quaternion to an angle\n *\n * Taken from https://stackoverflow.com/a/35448946\n * Thanks P. Ellul\n */\n\nfunction Quat2Angle(x, y, z, w) {\n  var test = x * y + z * w; // singularity at north pole\n\n  if (test > 0.499) {\n    var _yaw = 2 * Math.atan2(x, w);\n\n    var _pitch = Math.PI / 2;\n\n    var _roll = 0;\n    return new Vector3(_pitch, _roll, _yaw);\n  } // singularity at south pole\n\n\n  if (test < -0.499) {\n    var _yaw2 = -2 * Math.atan2(x, w);\n\n    var _pitch2 = -Math.PI / 2;\n\n    var _roll2 = 0;\n    return new Vector3(_pitch2, _roll2, _yaw2);\n  }\n\n  var sqx = x * x;\n  var sqy = y * y;\n  var sqz = z * z;\n  var yaw = Math.atan2(2 * y * w - 2 * x * z, 1 - 2 * sqy - 2 * sqz);\n  var pitch = Math.asin(2 * test);\n  var roll = Math.atan2(2 * x * w - 2 * y * z, 1 - 2 * sqx - 2 * sqz);\n  return new Vector3(pitch, roll, yaw);\n}\n\nvar OrbitOrientationControls = /*#__PURE__*/function () {\n  function OrbitOrientationControls(options) {\n    this.object = options.camera;\n    this.domElement = options.canvas;\n    this.orbit = new OrbitControls(this.object, this.domElement);\n    this.speed = 0.5;\n    this.orbit.target.set(0, 0, -1);\n    this.orbit.enableZoom = false;\n    this.orbit.enablePan = false;\n    this.orbit.rotateSpeed = -this.speed; // if orientation is supported\n\n    if (options.orientation) {\n      this.orientation = new DeviceOrientationControls(this.object);\n    } // if projection is not full view\n    // limit the rotation angle in order to not display back half view\n\n\n    if (options.halfView) {\n      this.orbit.minAzimuthAngle = -Math.PI / 4;\n      this.orbit.maxAzimuthAngle = Math.PI / 4;\n    }\n  }\n\n  var _proto = OrbitOrientationControls.prototype;\n\n  _proto.update = function update() {\n    // orientation updates the camera using quaternions and\n    // orbit updates the camera using angles. They are incompatible\n    // and one update overrides the other. So before\n    // orbit overrides orientation we convert our quaternion changes to\n    // an angle change. Then save the angle into orbit so that\n    // it will take those into account when it updates the camera and overrides\n    // our changes\n    if (this.orientation) {\n      this.orientation.update();\n      var quat = this.orientation.object.quaternion;\n      var currentAngle = Quat2Angle(quat.x, quat.y, quat.z, quat.w); // we also have to store the last angle since quaternions are b\n\n      if (typeof this.lastAngle_ === 'undefined') {\n        this.lastAngle_ = currentAngle;\n      }\n\n      this.orbit.rotateLeft((this.lastAngle_.z - currentAngle.z) * (1 + this.speed));\n      this.orbit.rotateUp((this.lastAngle_.y - currentAngle.y) * (1 + this.speed));\n      this.lastAngle_ = currentAngle;\n    }\n\n    this.orbit.update();\n  };\n\n  _proto.dispose = function dispose() {\n    this.orbit.dispose();\n\n    if (this.orientation) {\n      this.orientation.dispose();\n    }\n  };\n\n  return OrbitOrientationControls;\n}();\n\nvar corsSupport = function () {\n  var video = document$1.createElement('video');\n  video.crossOrigin = 'anonymous';\n  return video.hasAttribute('crossorigin');\n}();\nvar validProjections = ['360', '360_LR', '360_TB', '360_CUBE', 'EAC', 'EAC_LR', 'NONE', 'AUTO', 'Sphere', 'Cube', 'equirectangular', '180', '180_LR', '180_MONO'];\nvar getInternalProjectionName = function getInternalProjectionName(projection) {\n  if (!projection) {\n    return;\n  }\n\n  projection = projection.toString().trim();\n\n  if (/sphere/i.test(projection)) {\n    return '360';\n  }\n\n  if (/cube/i.test(projection)) {\n    return '360_CUBE';\n  }\n\n  if (/equirectangular/i.test(projection)) {\n    return '360';\n  }\n\n  for (var i = 0; i < validProjections.length; i++) {\n    if (new RegExp('^' + validProjections[i] + '$', 'i').test(projection)) {\n      return validProjections[i];\n    }\n  }\n};\n\n/**\n * This class reacts to interactions with the canvas and\n * triggers appropriate functionality on the player. Right now\n * it does two things:\n *\n * 1. A `mousedown`/`touchstart` followed by `touchend`/`mouseup` without any\n *    `touchmove` or `mousemove` toggles play/pause on the player\n * 2. Only moving on/clicking the control bar or toggling play/pause should\n *    show the control bar. Moving around the scene in the canvas should not.\n */\n\nvar CanvasPlayerControls = /*#__PURE__*/function (_videojs$EventTarget) {\n  _inheritsLoose(CanvasPlayerControls, _videojs$EventTarget);\n\n  function CanvasPlayerControls(player, canvas, options) {\n    var _this;\n\n    _this = _videojs$EventTarget.call(this) || this;\n    _this.player = player;\n    _this.canvas = canvas;\n    _this.options = options;\n    _this.onMoveEnd = videojs.bind(_assertThisInitialized(_this), _this.onMoveEnd);\n    _this.onMoveStart = videojs.bind(_assertThisInitialized(_this), _this.onMoveStart);\n    _this.onMove = videojs.bind(_assertThisInitialized(_this), _this.onMove);\n    _this.onControlBarMove = videojs.bind(_assertThisInitialized(_this), _this.onControlBarMove);\n\n    _this.player.controlBar.on(['mousedown', 'mousemove', 'mouseup', 'touchstart', 'touchmove', 'touchend'], _this.onControlBarMove); // we have to override these here because\n    // video.js listens for user activity on the video element\n    // and makes the user active when the mouse moves.\n    // We don't want that for 3d videos\n\n\n    _this.oldReportUserActivity = _this.player.reportUserActivity;\n\n    _this.player.reportUserActivity = function () {}; // canvas movements\n\n\n    _this.canvas.addEventListener('mousedown', _this.onMoveStart);\n\n    _this.canvas.addEventListener('touchstart', _this.onMoveStart);\n\n    _this.canvas.addEventListener('mousemove', _this.onMove);\n\n    _this.canvas.addEventListener('touchmove', _this.onMove);\n\n    _this.canvas.addEventListener('mouseup', _this.onMoveEnd);\n\n    _this.canvas.addEventListener('touchend', _this.onMoveEnd);\n\n    _this.shouldTogglePlay = false;\n    return _this;\n  }\n\n  var _proto = CanvasPlayerControls.prototype;\n\n  _proto.togglePlay = function togglePlay() {\n    if (this.player.paused()) {\n      this.player.play();\n    } else {\n      this.player.pause();\n    }\n  };\n\n  _proto.onMoveStart = function onMoveStart(e) {\n    // if the player does not have a controlbar or\n    // the move was a mouse click but not left click do not\n    // toggle play.\n    if (this.options.disableTogglePlay || !this.player.controls() || e.type === 'mousedown' && !videojs.dom.isSingleLeftClick(e)) {\n      this.shouldTogglePlay = false;\n      return;\n    }\n\n    this.shouldTogglePlay = true;\n    this.touchMoveCount_ = 0;\n  };\n\n  _proto.onMoveEnd = function onMoveEnd(e) {\n    // We want to have the same behavior in VR360 Player and standard player.\n    // in touchend we want to know if was a touch click, for a click we show the bar,\n    // otherwise continue with the mouse logic.\n    //\n    // Maximum movement allowed during a touch event to still be considered a tap\n    // Other popular libs use anywhere from 2 (hammer.js) to 15,\n    // so 10 seems like a nice, round number.\n    if (e.type === 'touchend' && this.touchMoveCount_ < 10) {\n      if (this.player.userActive() === false) {\n        this.player.userActive(true);\n        return;\n      }\n\n      this.player.userActive(false);\n      return;\n    }\n\n    if (!this.shouldTogglePlay) {\n      return;\n    } // We want the same behavior in Desktop for VR360  and standard player\n\n\n    if (e.type == 'mouseup') {\n      this.togglePlay();\n    }\n  };\n\n  _proto.onMove = function onMove(e) {\n    // Increase touchMoveCount_ since Android detects 1 - 6 touches when user click normally\n    this.touchMoveCount_++;\n    this.shouldTogglePlay = false;\n  };\n\n  _proto.onControlBarMove = function onControlBarMove(e) {\n    this.player.userActive(true);\n  };\n\n  _proto.dispose = function dispose() {\n    this.canvas.removeEventListener('mousedown', this.onMoveStart);\n    this.canvas.removeEventListener('touchstart', this.onMoveStart);\n    this.canvas.removeEventListener('mousemove', this.onMove);\n    this.canvas.removeEventListener('touchmove', this.onMove);\n    this.canvas.removeEventListener('mouseup', this.onMoveEnd);\n    this.canvas.removeEventListener('touchend', this.onMoveEnd);\n    this.player.controlBar.off(['mousedown', 'mousemove', 'mouseup', 'touchstart', 'touchmove', 'touchend'], this.onControlBarMove);\n    this.player.reportUserActivity = this.oldReportUserActivity;\n  };\n\n  return CanvasPlayerControls;\n}(videojs.EventTarget);\n\n/**\n * This class manages ambisonic decoding and binaural rendering via Omnitone library.\n */\n\nvar OmnitoneController = /*#__PURE__*/function (_videojs$EventTarget) {\n  _inheritsLoose(OmnitoneController, _videojs$EventTarget);\n\n  /**\n   * Omnitone controller class.\n   *\n   * @class\n   * @param {AudioContext} audioContext - associated AudioContext.\n   * @param {Omnitone library} omnitone - Omnitone library element.\n   * @param {HTMLVideoElement} video - vidoe tag element.\n   * @param {Object} options - omnitone options.\n   */\n  function OmnitoneController(audioContext, omnitone, video, options) {\n    var _this;\n\n    _this = _videojs$EventTarget.call(this) || this;\n    var settings = videojs.mergeOptions({\n      // Safari uses the different AAC decoder than FFMPEG. The channel order is\n      // The default 4ch AAC channel layout for FFMPEG AAC channel ordering.\n      channelMap: videojs.browser.IS_SAFARI ? [2, 0, 1, 3] : [0, 1, 2, 3],\n      ambisonicOrder: 1\n    }, options);\n    _this.videoElementSource = audioContext.createMediaElementSource(video);\n    _this.foaRenderer = omnitone.createFOARenderer(audioContext, settings);\n\n    _this.foaRenderer.initialize().then(function () {\n      if (audioContext.state === 'suspended') {\n        _this.trigger({\n          type: 'audiocontext-suspended'\n        });\n      }\n\n      _this.videoElementSource.connect(_this.foaRenderer.input);\n\n      _this.foaRenderer.output.connect(audioContext.destination);\n\n      _this.initialized = true;\n\n      _this.trigger({\n        type: 'omnitone-ready'\n      });\n    }, function (error) {\n      videojs.log.warn(\"videojs-vr: Omnitone initializes failed with the following error: \" + error + \")\");\n    });\n\n    return _this;\n  }\n  /**\n   * Updates the rotation of the Omnitone decoder based on three.js camera matrix.\n   *\n   * @param {Camera} camera Three.js camera object\n   */\n\n\n  var _proto = OmnitoneController.prototype;\n\n  _proto.update = function update(camera) {\n    if (!this.initialized) {\n      return;\n    }\n\n    this.foaRenderer.setRotationMatrixFromCamera(camera.matrix);\n  }\n  /**\n   * Destroys the controller and does any necessary cleanup.\n   */\n  ;\n\n  _proto.dispose = function dispose() {\n    this.initialized = false;\n    this.foaRenderer.setRenderingMode('bypass');\n    this.foaRenderer = null;\n  };\n\n  return OmnitoneController;\n}(videojs.EventTarget);\n\nvar Button = videojs.getComponent('Button');\n\nvar CardboardButton = /*#__PURE__*/function (_Button) {\n  _inheritsLoose(CardboardButton, _Button);\n\n  function CardboardButton(player, options) {\n    var _this;\n\n    _this = _Button.call(this, player, options) || this;\n    _this.handleVrDisplayActivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayActivate_);\n    _this.handleVrDisplayDeactivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayDeactivate_);\n    _this.handleVrDisplayPresentChange_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayPresentChange_);\n    _this.handleOrientationChange_ = videojs.bind(_assertThisInitialized(_this), _this.handleOrientationChange_);\n    window$1.addEventListener('orientationchange', _this.handleOrientationChange_);\n    window$1.addEventListener('vrdisplayactivate', _this.handleVrDisplayActivate_);\n    window$1.addEventListener('vrdisplaydeactivate', _this.handleVrDisplayDeactivate_); // vrdisplaypresentchange does not fire activate or deactivate\n    // and happens when hitting the back button during cardboard mode\n    // so we need to make sure we stay in the correct state by\n    // listening to it and checking if we are presenting it or not\n\n    window$1.addEventListener('vrdisplaypresentchange', _this.handleVrDisplayPresentChange_); // we cannot show the cardboard button in fullscreen on\n    // android as it breaks the controls, and makes it impossible\n    // to exit cardboard mode\n\n    if (videojs.browser.IS_ANDROID) {\n      _this.on(player, 'fullscreenchange', function () {\n        if (player.isFullscreen()) {\n          _this.hide();\n        } else {\n          _this.show();\n        }\n      });\n    }\n\n    return _this;\n  }\n\n  var _proto = CardboardButton.prototype;\n\n  _proto.buildCSSClass = function buildCSSClass() {\n    return \"vjs-button-vr \" + _Button.prototype.buildCSSClass.call(this);\n  };\n\n  _proto.handleVrDisplayPresentChange_ = function handleVrDisplayPresentChange_() {\n    if (!this.player_.vr().vrDisplay.isPresenting && this.active_) {\n      this.handleVrDisplayDeactivate_();\n    }\n\n    if (this.player_.vr().vrDisplay.isPresenting && !this.active_) {\n      this.handleVrDisplayActivate_();\n    }\n  };\n\n  _proto.handleOrientationChange_ = function handleOrientationChange_() {\n    if (this.active_ && videojs.browser.IS_IOS) {\n      this.changeSize_();\n    }\n  };\n\n  _proto.changeSize_ = function changeSize_() {\n    this.player_.width(window$1.innerWidth);\n    this.player_.height(window$1.innerHeight);\n    window$1.dispatchEvent(new window$1.Event('resize'));\n  };\n\n  _proto.handleVrDisplayActivate_ = function handleVrDisplayActivate_() {\n    // we mimic fullscreen on IOS\n    if (videojs.browser.IS_IOS) {\n      this.oldWidth_ = this.player_.currentWidth();\n      this.oldHeight_ = this.player_.currentHeight();\n      this.player_.enterFullWindow();\n      this.changeSize_();\n    }\n\n    this.active_ = true;\n  };\n\n  _proto.handleVrDisplayDeactivate_ = function handleVrDisplayDeactivate_() {\n    // un-mimic fullscreen on iOS\n    if (videojs.browser.IS_IOS) {\n      if (this.oldWidth_) {\n        this.player_.width(this.oldWidth_);\n      }\n\n      if (this.oldHeight_) {\n        this.player_.height(this.oldHeight_);\n      }\n\n      this.player_.exitFullWindow();\n    }\n\n    this.active_ = false;\n  };\n\n  _proto.handleClick = function handleClick(event) {\n    // if cardboard mode display is not active, activate it\n    // otherwise deactivate it\n    if (!this.active_) {\n      // This starts playback mode when the cardboard button\n      // is clicked on Android. We need to do this as the controls\n      // disappear\n      if (!this.player_.hasStarted() && videojs.browser.IS_ANDROID) {\n        this.player_.play();\n      }\n\n      window$1.dispatchEvent(new window$1.Event('vrdisplayactivate'));\n    } else {\n      window$1.dispatchEvent(new window$1.Event('vrdisplaydeactivate'));\n    }\n  };\n\n  _proto.dispose = function dispose() {\n    _Button.prototype.dispose.call(this);\n\n    window$1.removeEventListener('vrdisplayactivate', this.handleVrDisplayActivate_);\n    window$1.removeEventListener('vrdisplaydeactivate', this.handleVrDisplayDeactivate_);\n    window$1.removeEventListener('vrdisplaypresentchange', this.handleVrDisplayPresentChange_);\n  };\n\n  return CardboardButton;\n}(Button);\n\nvideojs.registerComponent('CardboardButton', CardboardButton);\n\nvar BigPlayButton = videojs.getComponent('BigPlayButton');\n\nvar BigVrPlayButton = /*#__PURE__*/function (_BigPlayButton) {\n  _inheritsLoose(BigVrPlayButton, _BigPlayButton);\n\n  function BigVrPlayButton() {\n    return _BigPlayButton.apply(this, arguments) || this;\n  }\n\n  var _proto = BigVrPlayButton.prototype;\n\n  _proto.buildCSSClass = function buildCSSClass() {\n    return \"vjs-big-vr-play-button \" + _BigPlayButton.prototype.buildCSSClass.call(this);\n  };\n\n  return BigVrPlayButton;\n}(BigPlayButton);\n\nvideojs.registerComponent('BigVrPlayButton', BigVrPlayButton);\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar defaults = {\n  debug: false,\n  omnitone: false,\n  forceCardboard: false,\n  omnitoneOptions: {},\n  projection: 'AUTO',\n  sphereDetail: 32,\n  disableTogglePlay: false\n};\nvar errors = {\n  'web-vr-out-of-date': {\n    headline: '360 is out of date',\n    type: '360_OUT_OF_DATE',\n    message: \"Your browser supports 360 but not the latest version. See <a href='http://webvr.info'>http://webvr.info</a> for more info.\"\n  },\n  'web-vr-not-supported': {\n    headline: '360 not supported on this device',\n    type: '360_NOT_SUPPORTED',\n    message: \"Your browser does not support 360. See <a href='http://webvr.info'>http://webvr.info</a> for assistance.\"\n  },\n  'web-vr-hls-cors-not-supported': {\n    headline: '360 HLS video not supported on this device',\n    type: '360_NOT_SUPPORTED',\n    message: \"Your browser/device does not support HLS 360 video. See <a href='http://webvr.info'>http://webvr.info</a> for assistance.\"\n  }\n};\nvar Plugin = videojs.getPlugin('plugin');\nvar Component = videojs.getComponent('Component');\n\nvar VR = /*#__PURE__*/function (_Plugin) {\n  _inheritsLoose(VR, _Plugin);\n\n  function VR(player, options) {\n    var _this;\n\n    var settings = videojs.mergeOptions(defaults, options);\n    _this = _Plugin.call(this, player, settings) || this;\n    _this.options_ = settings;\n    _this.player_ = player;\n    _this.bigPlayButtonIndex_ = player.children().indexOf(player.getChild('BigPlayButton')) || 0; // custom videojs-errors integration boolean\n\n    _this.videojsErrorsSupport_ = !!videojs.errors;\n\n    if (_this.videojsErrorsSupport_) {\n      player.errors({\n        errors: errors\n      });\n    } // IE 11 does not support enough webgl to be supported\n    // older safari does not support cors, so it wont work\n\n\n    if (videojs.browser.IE_VERSION || !corsSupport) {\n      // if a player triggers error before 'loadstart' is fired\n      // video.js will reset the error overlay\n      _this.player_.on('loadstart', function () {\n        _this.triggerError_({\n          code: 'web-vr-not-supported',\n          dismiss: false\n        });\n      });\n\n      return _assertThisInitialized(_this);\n    }\n\n    _this.polyfill_ = new WebVRPolyfill({\n      // do not show rotate instructions\n      ROTATE_INSTRUCTIONS_DISABLED: true\n    });\n    _this.polyfill_ = new WebVRPolyfill();\n    _this.handleVrDisplayActivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayActivate_);\n    _this.handleVrDisplayDeactivate_ = videojs.bind(_assertThisInitialized(_this), _this.handleVrDisplayDeactivate_);\n    _this.handleResize_ = videojs.bind(_assertThisInitialized(_this), _this.handleResize_);\n    _this.animate_ = videojs.bind(_assertThisInitialized(_this), _this.animate_);\n\n    _this.setProjection(_this.options_.projection); // any time the video element is recycled for ads\n    // we have to reset the vr state and re-init after ad\n\n\n    _this.on(player, 'adstart', function () {\n      return player.setTimeout(function () {\n        // if the video element was recycled for this ad\n        if (!player.ads || !player.ads.videoElementRecycled()) {\n          _this.log('video element not recycled for this ad, no need to reset');\n\n          return;\n        }\n\n        _this.log('video element recycled for this ad, reseting');\n\n        _this.reset();\n\n        _this.one(player, 'playing', _this.init);\n      });\n    }, 1);\n\n    _this.on(player, 'loadedmetadata', _this.init);\n\n    return _this;\n  }\n\n  var _proto = VR.prototype;\n\n  _proto.changeProjection_ = function changeProjection_(projection) {\n    var _this2 = this;\n\n    projection = getInternalProjectionName(projection); // don't change to an invalid projection\n\n    if (!projection) {\n      projection = 'NONE';\n    }\n\n    var position = {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n\n    if (this.scene) {\n      this.scene.remove(this.movieScreen);\n    }\n\n    if (projection === 'AUTO') {\n      // mediainfo cannot be set to auto or we would infinite loop here\n      // each source should know whatever they are 360 or not, if using AUTO\n      if (this.player_.mediainfo && this.player_.mediainfo.projection && this.player_.mediainfo.projection !== 'AUTO') {\n        var autoProjection = getInternalProjectionName(this.player_.mediainfo.projection);\n        return this.changeProjection_(autoProjection);\n      }\n\n      return this.changeProjection_('NONE');\n    } else if (projection === '360') {\n      this.movieGeometry = new SphereBufferGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.position.set(position.x, position.y, position.z);\n      this.movieScreen.scale.x = -1;\n      this.movieScreen.quaternion.setFromAxisAngle({\n        x: 0,\n        y: 1,\n        z: 0\n      }, -Math.PI / 2);\n      this.scene.add(this.movieScreen);\n    } else if (projection === '360_LR' || projection === '360_TB') {\n      // Left eye view\n      var geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail);\n      var uvs = geometry.faceVertexUvs[0];\n\n      for (var i = 0; i < uvs.length; i++) {\n        for (var j = 0; j < 3; j++) {\n          if (projection === '360_LR') {\n            uvs[i][j].x *= 0.5;\n          } else {\n            uvs[i][j].y *= 0.5;\n            uvs[i][j].y += 0.5;\n          }\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.scale.x = -1;\n      this.movieScreen.quaternion.setFromAxisAngle({\n        x: 0,\n        y: 1,\n        z: 0\n      }, -Math.PI / 2); // display in left eye only\n\n      this.movieScreen.layers.set(1);\n      this.scene.add(this.movieScreen); // Right eye view\n\n      geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail);\n      uvs = geometry.faceVertexUvs[0];\n\n      for (var _i = 0; _i < uvs.length; _i++) {\n        for (var _j = 0; _j < 3; _j++) {\n          if (projection === '360_LR') {\n            uvs[_i][_j].x *= 0.5;\n            uvs[_i][_j].x += 0.5;\n          } else {\n            uvs[_i][_j].y *= 0.5;\n          }\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.scale.x = -1;\n      this.movieScreen.quaternion.setFromAxisAngle({\n        x: 0,\n        y: 1,\n        z: 0\n      }, -Math.PI / 2); // display in right eye only\n\n      this.movieScreen.layers.set(2);\n      this.scene.add(this.movieScreen);\n    } else if (projection === '360_CUBE') {\n      this.movieGeometry = new BoxGeometry(256, 256, 256);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true,\n        side: BackSide\n      });\n      var left = [new Vector2(0, 0.5), new Vector2(0.333, 0.5), new Vector2(0.333, 1), new Vector2(0, 1)];\n      var right = [new Vector2(0.333, 0.5), new Vector2(0.666, 0.5), new Vector2(0.666, 1), new Vector2(0.333, 1)];\n      var top = [new Vector2(0.666, 0.5), new Vector2(1, 0.5), new Vector2(1, 1), new Vector2(0.666, 1)];\n      var bottom = [new Vector2(0, 0), new Vector2(0.333, 0), new Vector2(0.333, 0.5), new Vector2(0, 0.5)];\n      var front = [new Vector2(0.333, 0), new Vector2(0.666, 0), new Vector2(0.666, 0.5), new Vector2(0.333, 0.5)];\n      var back = [new Vector2(0.666, 0), new Vector2(1, 0), new Vector2(1, 0.5), new Vector2(0.666, 0.5)];\n      this.movieGeometry.faceVertexUvs[0] = [];\n      this.movieGeometry.faceVertexUvs[0][0] = [right[2], right[1], right[3]];\n      this.movieGeometry.faceVertexUvs[0][1] = [right[1], right[0], right[3]];\n      this.movieGeometry.faceVertexUvs[0][2] = [left[2], left[1], left[3]];\n      this.movieGeometry.faceVertexUvs[0][3] = [left[1], left[0], left[3]];\n      this.movieGeometry.faceVertexUvs[0][4] = [top[2], top[1], top[3]];\n      this.movieGeometry.faceVertexUvs[0][5] = [top[1], top[0], top[3]];\n      this.movieGeometry.faceVertexUvs[0][6] = [bottom[2], bottom[1], bottom[3]];\n      this.movieGeometry.faceVertexUvs[0][7] = [bottom[1], bottom[0], bottom[3]];\n      this.movieGeometry.faceVertexUvs[0][8] = [front[2], front[1], front[3]];\n      this.movieGeometry.faceVertexUvs[0][9] = [front[1], front[0], front[3]];\n      this.movieGeometry.faceVertexUvs[0][10] = [back[2], back[1], back[3]];\n      this.movieGeometry.faceVertexUvs[0][11] = [back[1], back[0], back[3]];\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial);\n      this.movieScreen.position.set(position.x, position.y, position.z);\n      this.movieScreen.rotation.y = -Math.PI;\n      this.scene.add(this.movieScreen);\n    } else if (projection === '180' || projection === '180_LR' || projection === '180_MONO') {\n      var _geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail, Math.PI, Math.PI); // Left eye view\n\n\n      _geometry.scale(-1, 1, 1);\n\n      var _uvs = _geometry.faceVertexUvs[0];\n\n      if (projection !== '180_MONO') {\n        for (var _i2 = 0; _i2 < _uvs.length; _i2++) {\n          for (var _j2 = 0; _j2 < 3; _j2++) {\n            _uvs[_i2][_j2].x *= 0.5;\n          }\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(_geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial); // display in left eye only\n\n      this.movieScreen.layers.set(1);\n      this.scene.add(this.movieScreen); // Right eye view\n\n      _geometry = new SphereGeometry(256, this.options_.sphereDetail, this.options_.sphereDetail, Math.PI, Math.PI);\n\n      _geometry.scale(-1, 1, 1);\n\n      _uvs = _geometry.faceVertexUvs[0];\n\n      for (var _i3 = 0; _i3 < _uvs.length; _i3++) {\n        for (var _j3 = 0; _j3 < 3; _j3++) {\n          _uvs[_i3][_j3].x *= 0.5;\n          _uvs[_i3][_j3].x += 0.5;\n        }\n      }\n\n      this.movieGeometry = new BufferGeometry().fromGeometry(_geometry);\n      this.movieMaterial = new MeshBasicMaterial({\n        map: this.videoTexture,\n        overdraw: true\n      });\n      this.movieScreen = new Mesh(this.movieGeometry, this.movieMaterial); // display in right eye only\n\n      this.movieScreen.layers.set(2);\n      this.scene.add(this.movieScreen);\n    } else if (projection === 'EAC' || projection === 'EAC_LR') {\n      var makeScreen = function makeScreen(mapMatrix, scaleMatrix) {\n        // \"Continuity correction?\": because of discontinuous faces and aliasing,\n        // we truncate the 2-pixel-wide strips on all discontinuous edges,\n        var contCorrect = 2;\n        _this2.movieGeometry = new BoxGeometry(256, 256, 256);\n        _this2.movieMaterial = new ShaderMaterial({\n          overdraw: true,\n          side: BackSide,\n          uniforms: {\n            mapped: {\n              value: _this2.videoTexture\n            },\n            mapMatrix: {\n              value: mapMatrix\n            },\n            contCorrect: {\n              value: contCorrect\n            },\n            faceWH: {\n              value: new Vector2(1 / 3, 1 / 2).applyMatrix3(scaleMatrix)\n            },\n            vidWH: {\n              value: new Vector2(_this2.videoTexture.image.videoWidth, _this2.videoTexture.image.videoHeight).applyMatrix3(scaleMatrix)\n            }\n          },\n          vertexShader: \"\\nvarying vec2 vUv;\\nuniform mat3 mapMatrix;\\n\\nvoid main() {\\n  vUv = (mapMatrix * vec3(uv, 1.)).xy;\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);\\n}\",\n          fragmentShader: \"\\nvarying vec2 vUv;\\nuniform sampler2D mapped;\\nuniform vec2 faceWH;\\nuniform vec2 vidWH;\\nuniform float contCorrect;\\n\\nconst float PI = 3.1415926535897932384626433832795;\\n\\nvoid main() {\\n  vec2 corner = vUv - mod(vUv, faceWH) + vec2(0, contCorrect / vidWH.y);\\n\\n  vec2 faceWHadj = faceWH - vec2(0, contCorrect * 2. / vidWH.y);\\n\\n  vec2 p = (vUv - corner) / faceWHadj - .5;\\n  vec2 q = 2. / PI * atan(2. * p) + .5;\\n\\n  vec2 eUv = corner + q * faceWHadj;\\n\\n  gl_FragColor = texture2D(mapped, eUv);\\n}\"\n        });\n        var right = [new Vector2(0, 1 / 2), new Vector2(1 / 3, 1 / 2), new Vector2(1 / 3, 1), new Vector2(0, 1)];\n        var front = [new Vector2(1 / 3, 1 / 2), new Vector2(2 / 3, 1 / 2), new Vector2(2 / 3, 1), new Vector2(1 / 3, 1)];\n        var left = [new Vector2(2 / 3, 1 / 2), new Vector2(1, 1 / 2), new Vector2(1, 1), new Vector2(2 / 3, 1)];\n        var bottom = [new Vector2(1 / 3, 0), new Vector2(1 / 3, 1 / 2), new Vector2(0, 1 / 2), new Vector2(0, 0)];\n        var back = [new Vector2(1 / 3, 1 / 2), new Vector2(1 / 3, 0), new Vector2(2 / 3, 0), new Vector2(2 / 3, 1 / 2)];\n        var top = [new Vector2(1, 0), new Vector2(1, 1 / 2), new Vector2(2 / 3, 1 / 2), new Vector2(2 / 3, 0)];\n\n        for (var _i4 = 0, _arr = [right, front, left, bottom, back, top]; _i4 < _arr.length; _i4++) {\n          var face = _arr[_i4];\n          var height = _this2.videoTexture.image.videoHeight;\n          var lowY = 1;\n          var highY = 0;\n\n          for (var _iterator = _createForOfIteratorHelperLoose(face), _step; !(_step = _iterator()).done;) {\n            var vector = _step.value;\n\n            if (vector.y < lowY) {\n              lowY = vector.y;\n            }\n\n            if (vector.y > highY) {\n              highY = vector.y;\n            }\n          }\n\n          for (var _iterator2 = _createForOfIteratorHelperLoose(face), _step2; !(_step2 = _iterator2()).done;) {\n            var _vector = _step2.value;\n\n            if (Math.abs(_vector.y - lowY) < Number.EPSILON) {\n              _vector.y += contCorrect / height;\n            }\n\n            if (Math.abs(_vector.y - highY) < Number.EPSILON) {\n              _vector.y -= contCorrect / height;\n            }\n\n            _vector.x = _vector.x / height * (height - contCorrect * 2) + contCorrect / height;\n          }\n        }\n\n        _this2.movieGeometry.faceVertexUvs[0] = [];\n        _this2.movieGeometry.faceVertexUvs[0][0] = [right[2], right[1], right[3]];\n        _this2.movieGeometry.faceVertexUvs[0][1] = [right[1], right[0], right[3]];\n        _this2.movieGeometry.faceVertexUvs[0][2] = [left[2], left[1], left[3]];\n        _this2.movieGeometry.faceVertexUvs[0][3] = [left[1], left[0], left[3]];\n        _this2.movieGeometry.faceVertexUvs[0][4] = [top[2], top[1], top[3]];\n        _this2.movieGeometry.faceVertexUvs[0][5] = [top[1], top[0], top[3]];\n        _this2.movieGeometry.faceVertexUvs[0][6] = [bottom[2], bottom[1], bottom[3]];\n        _this2.movieGeometry.faceVertexUvs[0][7] = [bottom[1], bottom[0], bottom[3]];\n        _this2.movieGeometry.faceVertexUvs[0][8] = [front[2], front[1], front[3]];\n        _this2.movieGeometry.faceVertexUvs[0][9] = [front[1], front[0], front[3]];\n        _this2.movieGeometry.faceVertexUvs[0][10] = [back[2], back[1], back[3]];\n        _this2.movieGeometry.faceVertexUvs[0][11] = [back[1], back[0], back[3]];\n        _this2.movieScreen = new Mesh(_this2.movieGeometry, _this2.movieMaterial);\n\n        _this2.movieScreen.position.set(position.x, position.y, position.z);\n\n        _this2.movieScreen.rotation.y = -Math.PI;\n        return _this2.movieScreen;\n      };\n\n      if (projection === 'EAC') {\n        this.scene.add(makeScreen(new Matrix3(), new Matrix3()));\n      } else {\n        var scaleMatrix = new Matrix3().set(0, 0.5, 0, 1, 0, 0, 0, 0, 1);\n        makeScreen(new Matrix3().set(0, -0.5, 0.5, 1, 0, 0, 0, 0, 1), scaleMatrix); // display in left eye only\n\n        this.movieScreen.layers.set(1);\n        this.scene.add(this.movieScreen);\n        makeScreen(new Matrix3().set(0, -0.5, 1, 1, 0, 0, 0, 0, 1), scaleMatrix); // display in right eye only\n\n        this.movieScreen.layers.set(2);\n        this.scene.add(this.movieScreen);\n      }\n    }\n\n    this.currentProjection_ = projection;\n  };\n\n  _proto.triggerError_ = function triggerError_(errorObj) {\n    // if we have videojs-errors use it\n    if (this.videojsErrorsSupport_) {\n      this.player_.error(errorObj); // if we don't have videojs-errors just use a normal player error\n    } else {\n      // strip any html content from the error message\n      // as it is not supported outside of videojs-errors\n      var div = document$1.createElement('div');\n      div.innerHTML = errors[errorObj.code].message;\n      var message = div.textContent || div.innerText || '';\n      this.player_.error({\n        code: errorObj.code,\n        message: message\n      });\n    }\n  };\n\n  _proto.log = function log() {\n    if (!this.options_.debug) {\n      return;\n    }\n\n    for (var _len = arguments.length, msgs = new Array(_len), _key = 0; _key < _len; _key++) {\n      msgs[_key] = arguments[_key];\n    }\n\n    msgs.forEach(function (msg) {\n      videojs.log('VR: ', msg);\n    });\n  };\n\n  _proto.handleVrDisplayActivate_ = function handleVrDisplayActivate_() {\n    var _this3 = this;\n\n    if (!this.vrDisplay) {\n      return;\n    }\n\n    this.vrDisplay.requestPresent([{\n      source: this.renderedCanvas\n    }]).then(function () {\n      if (!_this3.vrDisplay.cardboardUI_ || !videojs.browser.IS_IOS) {\n        return;\n      } // webvr-polyfill/cardboard ui only watches for click events\n      // to tell that the back arrow button is pressed during cardboard vr.\n      // but somewhere along the line these events are silenced with preventDefault\n      // but only on iOS, so we translate them ourselves here\n\n\n      var touches = [];\n\n      var iosCardboardTouchStart_ = function iosCardboardTouchStart_(e) {\n        for (var i = 0; i < e.touches.length; i++) {\n          touches.push(e.touches[i]);\n        }\n      };\n\n      var iosCardboardTouchEnd_ = function iosCardboardTouchEnd_(e) {\n        if (!touches.length) {\n          return;\n        }\n\n        touches.forEach(function (t) {\n          var simulatedClick = new window$1.MouseEvent('click', {\n            screenX: t.screenX,\n            screenY: t.screenY,\n            clientX: t.clientX,\n            clientY: t.clientY\n          });\n\n          _this3.renderedCanvas.dispatchEvent(simulatedClick);\n        });\n        touches = [];\n      };\n\n      _this3.renderedCanvas.addEventListener('touchstart', iosCardboardTouchStart_);\n\n      _this3.renderedCanvas.addEventListener('touchend', iosCardboardTouchEnd_);\n\n      _this3.iosRevertTouchToClick_ = function () {\n        _this3.renderedCanvas.removeEventListener('touchstart', iosCardboardTouchStart_);\n\n        _this3.renderedCanvas.removeEventListener('touchend', iosCardboardTouchEnd_);\n\n        _this3.iosRevertTouchToClick_ = null;\n      };\n    });\n  };\n\n  _proto.handleVrDisplayDeactivate_ = function handleVrDisplayDeactivate_() {\n    if (!this.vrDisplay || !this.vrDisplay.isPresenting) {\n      return;\n    }\n\n    if (this.iosRevertTouchToClick_) {\n      this.iosRevertTouchToClick_();\n    }\n\n    this.vrDisplay.exitPresent();\n  };\n\n  _proto.requestAnimationFrame = function requestAnimationFrame(fn) {\n    if (this.vrDisplay) {\n      return this.vrDisplay.requestAnimationFrame(fn);\n    }\n\n    return this.player_.requestAnimationFrame(fn);\n  };\n\n  _proto.cancelAnimationFrame = function cancelAnimationFrame(id) {\n    if (this.vrDisplay) {\n      return this.vrDisplay.cancelAnimationFrame(id);\n    }\n\n    return this.player_.cancelAnimationFrame(id);\n  };\n\n  _proto.togglePlay_ = function togglePlay_() {\n    if (this.player_.paused()) {\n      this.player_.play();\n    } else {\n      this.player_.pause();\n    }\n  };\n\n  _proto.animate_ = function animate_() {\n    if (!this.initialized_) {\n      return;\n    }\n\n    if (this.getVideoEl_().readyState === this.getVideoEl_().HAVE_ENOUGH_DATA) {\n      if (this.videoTexture) {\n        this.videoTexture.needsUpdate = true;\n      }\n    }\n\n    this.controls3d.update();\n\n    if (this.omniController) {\n      this.omniController.update(this.camera);\n    }\n\n    this.effect.render(this.scene, this.camera);\n\n    if (window$1.navigator.getGamepads) {\n      // Grab all gamepads\n      var gamepads = window$1.navigator.getGamepads();\n\n      for (var i = 0; i < gamepads.length; ++i) {\n        var gamepad = gamepads[i]; // Make sure gamepad is defined\n        // Only take input if state has changed since we checked last\n\n        if (!gamepad || !gamepad.timestamp || gamepad.timestamp === this.prevTimestamps_[i]) {\n          continue;\n        }\n\n        for (var j = 0; j < gamepad.buttons.length; ++j) {\n          if (gamepad.buttons[j].pressed) {\n            this.togglePlay_();\n            this.prevTimestamps_[i] = gamepad.timestamp;\n            break;\n          }\n        }\n      }\n    }\n\n    this.camera.getWorldDirection(this.cameraVector);\n    this.animationFrameId_ = this.requestAnimationFrame(this.animate_);\n  };\n\n  _proto.handleResize_ = function handleResize_() {\n    var width = this.player_.currentWidth();\n    var height = this.player_.currentHeight();\n    this.effect.setSize(width, height, false);\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n  };\n\n  _proto.setProjection = function setProjection(projection) {\n    if (!getInternalProjectionName(projection)) {\n      videojs.log.error('videojs-vr: please pass a valid projection ' + validProjections.join(', '));\n      return;\n    }\n\n    this.currentProjection_ = projection;\n    this.defaultProjection_ = projection;\n  };\n\n  _proto.init = function init() {\n    var _this4 = this;\n\n    this.reset();\n    this.camera = new PerspectiveCamera(75, this.player_.currentWidth() / this.player_.currentHeight(), 1, 1000); // Store vector representing the direction in which the camera is looking, in world space.\n\n    this.cameraVector = new Vector3();\n\n    if (this.currentProjection_ === '360_LR' || this.currentProjection_ === '360_TB' || this.currentProjection_ === '180' || this.currentProjection_ === '180_LR' || this.currentProjection_ === '180_MONO' || this.currentProjection_ === 'EAC_LR') {\n      // Render left eye when not in VR mode\n      this.camera.layers.enable(1);\n    }\n\n    this.scene = new Scene();\n    this.videoTexture = new VideoTexture(this.getVideoEl_()); // shared regardless of wether VideoTexture is used or\n    // an image canvas is used\n\n    this.videoTexture.generateMipmaps = false;\n    this.videoTexture.minFilter = LinearFilter;\n    this.videoTexture.magFilter = LinearFilter;\n    this.videoTexture.format = RGBFormat;\n    this.changeProjection_(this.currentProjection_);\n\n    if (this.currentProjection_ === 'NONE') {\n      this.log('Projection is NONE, dont init');\n      this.reset();\n      return;\n    }\n\n    this.player_.removeChild('BigPlayButton');\n    this.player_.addChild('BigVrPlayButton', {}, this.bigPlayButtonIndex_);\n    this.player_.bigPlayButton = this.player_.getChild('BigVrPlayButton'); // mobile devices, or cardboard forced to on\n\n    if (this.options_.forceCardboard || videojs.browser.IS_ANDROID || videojs.browser.IS_IOS) {\n      this.addCardboardButton_();\n    } // if ios remove full screen toggle\n\n\n    if (videojs.browser.IS_IOS && this.player_.controlBar && this.player_.controlBar.fullscreenToggle) {\n      this.player_.controlBar.fullscreenToggle.hide();\n    }\n\n    this.camera.position.set(0, 0, 0);\n    this.renderer = new WebGLRenderer({\n      devicePixelRatio: window$1.devicePixelRatio,\n      alpha: false,\n      clearColor: 0xffffff,\n      antialias: true\n    });\n    var webglContext = this.renderer.getContext('webgl');\n    var oldTexImage2D = webglContext.texImage2D;\n    /* this is a workaround since threejs uses try catch */\n\n    webglContext.texImage2D = function () {\n      try {\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          args[_key2] = arguments[_key2];\n        }\n\n        return oldTexImage2D.apply(webglContext, args);\n      } catch (e) {\n        _this4.reset();\n\n        _this4.player_.pause();\n\n        _this4.triggerError_({\n          code: 'web-vr-hls-cors-not-supported',\n          dismiss: false\n        });\n\n        throw new Error(e);\n      }\n    };\n\n    this.renderer.setSize(this.player_.currentWidth(), this.player_.currentHeight(), false);\n    this.effect = new VREffect(this.renderer);\n    this.effect.setSize(this.player_.currentWidth(), this.player_.currentHeight(), false);\n    this.vrDisplay = null; // Previous timestamps for gamepad updates\n\n    this.prevTimestamps_ = [];\n    this.renderedCanvas = this.renderer.domElement;\n    this.renderedCanvas.setAttribute('style', 'width: 100%; height: 100%; position: absolute; top:0;');\n    var videoElStyle = this.getVideoEl_().style;\n    this.player_.el().insertBefore(this.renderedCanvas, this.player_.el().firstChild);\n    videoElStyle.zIndex = '-1';\n    videoElStyle.opacity = '0';\n\n    if (window$1.navigator.getVRDisplays) {\n      this.log('is supported, getting vr displays');\n      window$1.navigator.getVRDisplays().then(function (displays) {\n        if (displays.length > 0) {\n          _this4.log('Displays found', displays);\n\n          _this4.vrDisplay = displays[0]; // Native WebVR Head Mounted Displays (HMDs) like the HTC Vive\n          // also need the cardboard button to enter fully immersive mode\n          // so, we want to add the button if we're not polyfilled.\n\n          if (!_this4.vrDisplay.isPolyfilled) {\n            _this4.log('Real HMD found using VRControls', _this4.vrDisplay);\n\n            _this4.addCardboardButton_(); // We use VRControls here since we are working with an HMD\n            // and we only want orientation controls.\n\n\n            _this4.controls3d = new VRControls(_this4.camera);\n          }\n        }\n\n        if (!_this4.controls3d) {\n          _this4.log('no HMD found Using Orbit & Orientation Controls');\n\n          var options = {\n            camera: _this4.camera,\n            canvas: _this4.renderedCanvas,\n            // check if its a half sphere view projection\n            halfView: _this4.currentProjection_.indexOf('180') === 0,\n            orientation: videojs.browser.IS_IOS || videojs.browser.IS_ANDROID || false\n          };\n\n          if (_this4.options_.motionControls === false) {\n            options.orientation = false;\n          }\n\n          _this4.controls3d = new OrbitOrientationControls(options);\n          _this4.canvasPlayerControls = new CanvasPlayerControls(_this4.player_, _this4.renderedCanvas, _this4.options_);\n        }\n\n        _this4.animationFrameId_ = _this4.requestAnimationFrame(_this4.animate_);\n      });\n    } else if (window$1.navigator.getVRDevices) {\n      this.triggerError_({\n        code: 'web-vr-out-of-date',\n        dismiss: false\n      });\n    } else {\n      this.triggerError_({\n        code: 'web-vr-not-supported',\n        dismiss: false\n      });\n    }\n\n    if (this.options_.omnitone) {\n      var audiocontext = AudioContext.getContext();\n      this.omniController = new OmnitoneController(audiocontext, this.options_.omnitone, this.getVideoEl_(), this.options_.omnitoneOptions);\n      this.omniController.one('audiocontext-suspended', function () {\n        _this4.player.pause();\n\n        _this4.player.one('playing', function () {\n          audiocontext.resume();\n        });\n      });\n    }\n\n    this.on(this.player_, 'fullscreenchange', this.handleResize_);\n    window$1.addEventListener('vrdisplaypresentchange', this.handleResize_, true);\n    window$1.addEventListener('resize', this.handleResize_, true);\n    window$1.addEventListener('vrdisplayactivate', this.handleVrDisplayActivate_, true);\n    window$1.addEventListener('vrdisplaydeactivate', this.handleVrDisplayDeactivate_, true);\n    this.initialized_ = true;\n    this.trigger('initialized');\n  };\n\n  _proto.addCardboardButton_ = function addCardboardButton_() {\n    if (!this.player_.controlBar.getChild('CardboardButton')) {\n      this.player_.controlBar.addChild('CardboardButton', {});\n    }\n  };\n\n  _proto.getVideoEl_ = function getVideoEl_() {\n    return this.player_.el().getElementsByTagName('video')[0];\n  };\n\n  _proto.reset = function reset() {\n    if (!this.initialized_) {\n      return;\n    }\n\n    if (this.omniController) {\n      this.omniController.off('audiocontext-suspended');\n      this.omniController.dispose();\n      this.omniController = undefined;\n    }\n\n    if (this.controls3d) {\n      this.controls3d.dispose();\n      this.controls3d = null;\n    }\n\n    if (this.canvasPlayerControls) {\n      this.canvasPlayerControls.dispose();\n      this.canvasPlayerControls = null;\n    }\n\n    if (this.effect) {\n      this.effect.dispose();\n      this.effect = null;\n    }\n\n    window$1.removeEventListener('resize', this.handleResize_, true);\n    window$1.removeEventListener('vrdisplaypresentchange', this.handleResize_, true);\n    window$1.removeEventListener('vrdisplayactivate', this.handleVrDisplayActivate_, true);\n    window$1.removeEventListener('vrdisplaydeactivate', this.handleVrDisplayDeactivate_, true); // re-add the big play button to player\n\n    if (!this.player_.getChild('BigPlayButton')) {\n      this.player_.addChild('BigPlayButton', {}, this.bigPlayButtonIndex_);\n    }\n\n    if (this.player_.getChild('BigVrPlayButton')) {\n      this.player_.removeChild('BigVrPlayButton');\n    } // remove the cardboard button\n\n\n    if (this.player_.getChild('CardboardButton')) {\n      this.player_.controlBar.removeChild('CardboardButton');\n    } // show the fullscreen again\n\n\n    if (videojs.browser.IS_IOS && this.player_.controlBar && this.player_.controlBar.fullscreenToggle) {\n      this.player_.controlBar.fullscreenToggle.show();\n    } // reset the video element style so that it will be displayed\n\n\n    var videoElStyle = this.getVideoEl_().style;\n    videoElStyle.zIndex = '';\n    videoElStyle.opacity = ''; // set the current projection to the default\n\n    this.currentProjection_ = this.defaultProjection_; // reset the ios touch to click workaround\n\n    if (this.iosRevertTouchToClick_) {\n      this.iosRevertTouchToClick_();\n    } // remove the old canvas\n\n\n    if (this.renderedCanvas) {\n      this.renderedCanvas.parentNode.removeChild(this.renderedCanvas);\n    }\n\n    if (this.animationFrameId_) {\n      this.cancelAnimationFrame(this.animationFrameId_);\n    }\n\n    this.initialized_ = false;\n  };\n\n  _proto.dispose = function dispose() {\n    _Plugin.prototype.dispose.call(this);\n\n    this.reset();\n  };\n\n  _proto.polyfillVersion = function polyfillVersion() {\n    return WebVRPolyfill.version;\n  };\n\n  return VR;\n}(Plugin);\n\nVR.prototype.setTimeout = Component.prototype.setTimeout;\nVR.prototype.clearTimeout = Component.prototype.clearTimeout;\nVR.VERSION = version;\nvideojs.registerPlugin('vr', VR);\n\nexport default VR;\n"]},"metadata":{},"sourceType":"module"}