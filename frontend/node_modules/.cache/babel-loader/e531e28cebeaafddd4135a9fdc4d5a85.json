{"ast":null,"code":"var _jsxFileName = \"/Users/kian/HAKEE/annotator_app/frontend/src/components/DescriptionPane.jsx\";\nimport React from \"react\";\nimport \"./DescriptionPane.css\";\nimport { DragDropContext, Draggable, Droppable } from \"react-beautiful-dnd\";\nimport StepDescription from \"./StepDescription\";\nimport { sendDataToServer } from \"../apiCalls\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class DescriptionPane extends React.Component {\n  constructor(props) {\n    super(props);\n    this.counter = 0;\n    this.sessionTime = \"\";\n    this.state = {\n      descriptions: [{\n        key: 0,\n        mode: \"writing\",\n        level: 1,\n        selected: true,\n        text: \"\"\n      }]\n    };\n    this.counter += 1;\n    this.setModeByKey = this.setModeByKey.bind(this);\n    this.getMode = this.getMode.bind(this);\n    this.addStepAfter = this.addStepAfter.bind(this);\n    this.removeWritingStep = this.removeWritingStep.bind(this);\n    this.getSelected = this.getSelected.bind(this);\n    this.getWritingStep = this.getWritingStep.bind(this);\n    this.deselectAll = this.deselectAll.bind(this);\n    this.getIndex = this.getIndex.bind(this);\n    this.getWritingIndex = this.getWritingIndex.bind(this);\n    this.removeItem = this.removeItem.bind(this);\n    this.updateDescendents = this.updateDescendents.bind(this);\n    this.getDescendents = this.getDescendents.bind(this);\n    this.deleteItems = this.deleteItems.bind(this);\n    this.getPrevSibling = this.getPrevSibling.bind(this);\n    this.groupDescriptions = this.groupDescriptions.bind(this);\n    this.getSessionTime = this.getSessionTime.bind(this);\n    this.handleSingleClick = this.handleSingleClick.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.handleKeyAction = this.handleKeyAction.bind(this);\n    this.handleDragEnd = this.handleDragEnd.bind(this);\n    this.handleWindowResize = this.handleWindowResize.bind(this);\n  }\n\n  render() {\n    if (this.counter === 2) {\n      this.sessionTime = this.getSessionTime();\n    }\n\n    let descriptionListG = this.groupDescriptions([...this.state.descriptions]);\n    let stepComponentsList = descriptionListG.map((stepList, index) => /*#__PURE__*/_jsxDEV(Draggable, {\n      draggableId: index.toString(),\n      index: index,\n      children: provided => /*#__PURE__*/_jsxDEV(\"div\", {\n        id: index.toString(),\n        className: \"step-div\",\n        ...provided.draggableProps,\n        ...provided.dragHandleProps,\n        ref: provided.innerRef,\n        children: stepList.map((item, index) => /*#__PURE__*/_jsxDEV(StepDescription, {\n          id: item.key.toString(),\n          onSingleClick: this.handleSingleClick,\n          onDoubleClick: this.handleDoubleClick,\n          onBlur: this.handleBlur,\n          onKeyPress: this.handleKeyAction,\n          item: item\n        }, item.key.toString(), false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 8\n        }, this))\n      }, index.toString(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 6\n      }, this)\n    }, index.toString(), false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 4\n    }, this));\n    return /*#__PURE__*/_jsxDEV(DragDropContext, {\n      onDragEnd: this.handleDragEnd,\n      children: /*#__PURE__*/_jsxDEV(Droppable, {\n        droppableId: \"description-pane-droppable\",\n        children: provided => /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"description-pane-droppable-div\",\n          style: {\n            width: this.props.width,\n            height: this.props.height\n          },\n          ref: provided.innerRef,\n          ...provided.droppableProps,\n          children: [stepComponentsList, provided.placeholder]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 4\n    }, this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.videoID !== this.props.videoID) {\n      this.setState({\n        descriptions: [{\n          key: 0,\n          mode: \"writing\",\n          level: 1,\n          selected: true,\n          text: \"\"\n        }]\n      });\n    }\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.handleWindowResize);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.handleWindowResize);\n  }\n\n  handleWindowResize() {// const windowWidth = window.innerWidth;\n    // const windowHeight = window.innerHeight;\n    // if (windowWidth < 1600) {\n    //     let paneContainer = document.getElementById(\"description-pane-container\");\n    // \tpaneContainer.style.width = 490;\n    // } else {\n    // \tlet paneContainer = document.getElementById(\"description-pane-container\");\n    // \tpaneContainer.style.width = 550;\n    // }\n    // console.log(\"width: \", windowWidth);\n    // console.log(\"height: \", windowHeight);\n  }\n\n  getSessionTime() {\n    let d = new Date();\n    const sessionTime = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}-${d.getHours()}-${d.getMinutes()}-${d.getSeconds()}`;\n    return sessionTime;\n  }\n\n  groupDescriptions(descriptions) {\n    let descriptionListG = [];\n    let stepDescriptionList = [];\n\n    for (let i = 0; i < descriptions.length; i++) {\n      // new step\n      if (descriptions[i].level === 1) {\n        if (stepDescriptionList.length) {\n          descriptionListG.push(stepDescriptionList);\n        }\n\n        stepDescriptionList = [descriptions[i]];\n      } else {\n        // descendents\n        stepDescriptionList.push(descriptions[i]);\n      }\n\n      if (i === descriptions.length - 1) {\n        if (stepDescriptionList.length) {\n          descriptionListG.push(stepDescriptionList);\n        }\n      }\n    }\n\n    return descriptionListG;\n  }\n\n  handleDragEnd(result) {\n    if (result.destination == null) return;\n    if (result.destination.index === result.source.index) return;\n    let items = [...this.state.descriptions]; // step-set level index\n\n    const sourceStepIndex = result.source.index;\n    const destinationStepIndex = result.destination.index;\n    let steps = this.groupDescriptions(items);\n    let destinationOffset = destinationStepIndex > sourceStepIndex ? 1 : 0;\n    let sourceOffset = destinationStepIndex > sourceStepIndex ? 0 : 1; // move a copy of source step into the new location\n\n    steps.splice(destinationStepIndex + destinationOffset, 0, steps[sourceStepIndex]); // remove the old copy of source step\n\n    steps.splice(sourceStepIndex + sourceOffset, 1);\n    sendDataToServer(items, this.sessionTime, this.props.videoID, this.context);\n    this.setState({\n      descriptions: steps.flat()\n    });\n  }\n\n  handleSingleClick(key, txt) {\n    let items = [...this.state.descriptions];\n\n    if (txt !== \"\") {\n      let index = this.getIndex(items, key, 0);\n      const oldWritingIndex = this.getWritingIndex(items);\n\n      if (oldWritingIndex >= 0) {\n        items[oldWritingIndex].mode = \"not_writing\";\n      }\n\n      items[index].mode = \"writing\";\n      items = this.deselectAll(items);\n      items[index].selected = true;\n      this.setState({\n        descriptions: items\n      });\n    }\n  }\n\n  handleBlur(key, txt) {\n    let items = [...this.state.descriptions];\n\n    if (txt !== \"\") {\n      const index = this.getIndex(items, key, 0);\n      items[index].mode = \"not_writing\";\n      items[index].text = txt;\n    } else if (txt === \"\" && items.length > 1) {\n      items = this.removeWritingStep(items);\n    } //sendDataToServer(items, this.sessionTime, this.props.videoID, this.props.user);\n\n\n    this.setState({\n      descriptions: items\n    });\n  }\n\n  handleKeyAction(key, txt, event) {\n    let items = [...this.state.descriptions]; // del --> delete step\n\n    if (event.which === 46 || event.type === \"click\" && txt === \"close_btn\") {\n      let currentStepIndex = null;\n\n      if (key === null) {\n        // delete (window listener)\n        currentStepIndex = this.getSelected(items);\n      } else {\n        // delete (<input> listener)\n        currentStepIndex = this.getIndex(items, key, 0);\n      }\n\n      if ((items[currentStepIndex].selected || event.type === \"click\" && txt === \"close_btn\") && items.length >= 2) {\n        // select the previous/next step\n        items = this.deselectAll(items);\n        const descIndexList = this.getDescendents(items, currentStepIndex);\n\n        if (currentStepIndex === 0) {\n          items[currentStepIndex + descIndexList.length].selected = true;\n        } else {\n          const prevSiblingIndex = this.getPrevSibling(items, currentStepIndex);\n          let offset = 1;\n\n          if (!(prevSiblingIndex == null)) {\n            const prevStepDescIndexList = this.getDescendents(items, prevSiblingIndex);\n            offset = prevStepDescIndexList.length;\n          }\n\n          items[currentStepIndex - offset].selected = true;\n        } // do not delete everything\n\n\n        if (descIndexList.length < items.length) {\n          items = this.deleteItems(items, descIndexList);\n          sendDataToServer(items, this.sessionTime, this.props.videoID, this.context);\n          this.setState({\n            descriptions: items\n          });\n        }\n      }\n    } // Enter --> nex step (writing)\n    else if (event.which === 13 && txt !== \"\") {\n      const currentStepMode = this.getMode(items, key, 0);\n      const curretnStepIndex = this.getIndex(items, key, 0);\n      let newStepIndex = curretnStepIndex;\n\n      if (currentStepMode === \"writing\" || currentStepMode === \"not_writing\" && items[curretnStepIndex].selected) {\n        // change the current step to non-writing and add one writing step after it\n        items[curretnStepIndex].mode = \"not_writing\";\n        items[curretnStepIndex].text = txt; // select the current step\n\n        items = this.deselectAll(items);\n        [items, newStepIndex] = this.addStepAfter(items, key, \"writing\", null);\n        items[newStepIndex].selected = true;\n        items[newStepIndex].mode = \"writing\";\n        sendDataToServer(items, this.sessionTime, this.props.videoID, this.context);\n        this.setState({\n          descriptions: items\n        });\n      }\n    } // Tab or Shift + Tab\n    else if (event.which === 9 || event.type === \"click\") {\n      event.preventDefault(); // perform indention if it is writing\n\n      const currentStepIndex = this.getIndex(items, key, 0);\n\n      if (currentStepIndex > 0) {\n        const descIndexList = this.getDescendents(items, currentStepIndex); // only tab\n\n        if (!event.shiftKey || txt === \"indent_btn\") {\n          if ((items[currentStepIndex].mode === \"writing\" || txt === \"indent_btn\") && items.length > 1) {\n            if (items[currentStepIndex - 1].level >= items[currentStepIndex].level && items[currentStepIndex].level <= 2) {\n              items[currentStepIndex].level += 1;\n              items = this.updateDescendents(items, descIndexList, \"level_increase\");\n              sendDataToServer(items, this.sessionTime, this.props.videoID, this.context);\n              this.setState({\n                descriptions: items\n              });\n            }\n          }\n        }\n\n        if (event.shiftKey || txt === \"outdent_btn\") {\n          // shift + tab\n          if (items[currentStepIndex].level >= 2) {\n            items[currentStepIndex].level -= 1;\n            items = this.updateDescendents(items, descIndexList, \"level_decrease\");\n            sendDataToServer(items, this.sessionTime, this.props.videoID, this.context);\n            this.setState({\n              descriptions: items\n            });\n          }\n        }\n      }\n    } // down\n    else if (event.which === 40) {\n      items = [...this.state.descriptions];\n      const oldIndex = this.getIndex(items, key, 0); // can't go down\n\n      if (oldIndex === items.length - 1) {\n        this.setState({\n          descriptions: items\n        });\n        return;\n      } // update the selected item\n\n\n      if (txt !== \"\") {\n        // keep the old item\n        items[oldIndex].text = txt;\n        items[oldIndex].selected = false;\n        items[oldIndex].mode = \"not_writing\"; // select the new item\n\n        items[oldIndex + 1].selected = true;\n        items[oldIndex + 1].mode = \"writing\";\n      } else {\n        // must be removed\n        items = this.removeItem(items, oldIndex); // select the new item\n\n        items[oldIndex].selected = true;\n        items[oldIndex].mode = \"writing\";\n      }\n\n      this.setState({\n        descriptions: items\n      });\n    } // up\n    else if (event.which === 38) {\n      items = [...this.state.descriptions];\n      const oldIndex = this.getIndex(items, key, 0); // can't go up\n\n      if (oldIndex === 0) {\n        this.setState({\n          descriptions: items\n        });\n        return;\n      } // update the selected item\n\n\n      if (txt !== \"\") {\n        // keep the old item\n        items[oldIndex].text = txt;\n        items[oldIndex].selected = false;\n        items[oldIndex].mode = \"not_writing\"; // select the new item\n\n        items[oldIndex - 1].selected = true;\n        items[oldIndex - 1].mode = \"writing\";\n      } else {\n        // must be removed\n        items = this.removeItem(items, oldIndex); // select the new item\n\n        items[oldIndex - 1].selected = true;\n        items[oldIndex - 1].mode = \"writing\";\n      }\n\n      this.setState({\n        descriptions: items\n      });\n    } else if (event.which === 40 || event.which === 38) {\n      items = [...this.state.descriptions];\n      const oldIndex = this.getIndex(items, key, 0);\n      if (oldIndex === items.length - 1 && event.which === 40) return;\n      if (oldIndex === 0 && event.which === 38) return; // take care of the old selected item\n\n      let oldItemIsRemoved = false;\n\n      if (txt === \"\") {\n        if (items.length > 1) {\n          // should be  deleted\n          items = this.removeItem(items, oldIndex);\n          oldItemIsRemoved = true;\n        } else {\n          return; // length = 0 --> you cannot go to another item\n        }\n      } else {\n        items[oldIndex].text = txt;\n        items[oldIndex].selected = false;\n        items[oldIndex].mode = \"not_writing\";\n      } // selected the new item (already know that items.length > 1)\n\n\n      let newIndex = oldIndex;\n\n      if (event.which === 40) {\n        // down\n        if (!oldItemIsRemoved && oldIndex < items.length - 1) {\n          newIndex = oldIndex + 1;\n        }\n      } else {\n        // up\n        if (oldIndex > 0) newIndex = oldIndex - 1;\n      }\n\n      items = this.deselectAll(items);\n      items[newIndex].selected = true;\n      items[newIndex].mode = \"writing\";\n      this.setState({\n        descriptions: items\n      });\n    }\n  }\n\n  getIndex(stateItems, descriptionKey, offset) {\n    let items = [...stateItems];\n    let itemIndex = items.map(item => item.key).indexOf(parseInt(descriptionKey));\n\n    if (itemIndex >= 0) {\n      return itemIndex + offset;\n    }\n\n    return -1;\n  }\n\n  getWritingIndex(items) {\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].mode === \"writing\") {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  setModeByKey(stateItems, descriptionKey, mode) {\n    let items = [...stateItems];\n    let itemIndex = items.map(item => item.key).indexOf(parseInt(descriptionKey));\n\n    if (itemIndex >= 0) {\n      items[itemIndex].mode = mode;\n    } else {\n      console.log(\"step description does not exist\");\n    }\n\n    return items;\n  }\n\n  getMode(stateItems, descriptionKey, offset) {\n    let items = [...stateItems];\n    let itemIndex = items.map(item => item.key).indexOf(parseInt(descriptionKey));\n\n    if (items[itemIndex + offset] !== undefined) {\n      return items[itemIndex + offset].mode;\n    }\n\n    return undefined;\n  }\n\n  getSelected(items) {\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].selected) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  getWritingStep(items) {\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].mode === \"writing\") {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  deselectAll(items) {\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].selected) {\n        items[i].selected = false;\n      }\n    }\n\n    return items;\n  }\n\n  addStepAfter(itemsState, key, mode, level) {\n    let items = [...itemsState];\n    let itemIndex = items.map(item => item.key).indexOf(parseInt(key)); // add the new step\n\n    let mLevel = level;\n\n    if (level === null) {\n      mLevel = items[itemIndex].level;\n    }\n\n    const descIndexList = this.getDescendents(items, itemIndex);\n    let newItemIndex = descIndexList[descIndexList.length - 1] + 1;\n    items.splice(newItemIndex, 0, {\n      key: this.counter,\n      mode: mode,\n      level: mLevel,\n      selected: true,\n      text: \"\"\n    });\n    this.counter += 1;\n    return [items, newItemIndex];\n  }\n\n  removeWritingStep(itemsState) {\n    let items = [...itemsState];\n    let newItems = [...items];\n\n    for (let i = 1; i < items.length; i++) {\n      if (items[i].mode === \"writing\") {\n        newItems.splice(i, 1);\n        return newItems;\n      }\n    }\n\n    console.log(\"Didn't find the item, to remove\");\n    return newItems;\n  }\n\n  removeItem(items, index) {\n    items.splice(index, 1);\n    return items;\n  }\n\n  getDescendents(items, index) {\n    let descIndexList = [index];\n    const currentStepLevel = items[index].level;\n\n    for (let i = index + 1; i < items.length; i++) {\n      if (items[i].level > currentStepLevel) {\n        descIndexList.push(i);\n      } else {\n        break;\n      }\n    }\n\n    return descIndexList;\n  }\n\n  updateDescendents(items, desIndexList, action) {\n    for (let i = 1; i < desIndexList.length; i++) {\n      if (action === \"level_increase\") {\n        items[desIndexList[i]].level += 1;\n      } else if (action === \"level_decrease\") {\n        items[desIndexList[i]].level -= 1;\n      }\n    }\n\n    return items;\n  }\n\n  deleteItems(items, indexList) {\n    let newItems = [];\n    items.forEach((item, index) => {\n      if (!indexList.includes(index)) {\n        newItems.push(item);\n      }\n    });\n    return newItems;\n  }\n\n  getPrevSibling(items, index) {\n    // pre-condition: index > 0\n    for (let i = index - 1; i > 0; i--) {\n      if (items[i].level < items[index].level) {\n        return null;\n      }\n\n      if (items[index].level === items[i].level) {\n        return i;\n      }\n    }\n\n    return null;\n  }\n\n  saveUserData(descriptions, fileName) {//const descriptionsJson = JSON.stringify(descriptions);\n  }\n\n}","map":{"version":3,"sources":["/Users/kian/HAKEE/annotator_app/frontend/src/components/DescriptionPane.jsx"],"names":["React","DragDropContext","Draggable","Droppable","StepDescription","sendDataToServer","DescriptionPane","Component","constructor","props","counter","sessionTime","state","descriptions","key","mode","level","selected","text","setModeByKey","bind","getMode","addStepAfter","removeWritingStep","getSelected","getWritingStep","deselectAll","getIndex","getWritingIndex","removeItem","updateDescendents","getDescendents","deleteItems","getPrevSibling","groupDescriptions","getSessionTime","handleSingleClick","handleBlur","handleKeyAction","handleDragEnd","handleWindowResize","render","descriptionListG","stepComponentsList","map","stepList","index","toString","provided","draggableProps","dragHandleProps","innerRef","item","handleDoubleClick","width","height","droppableProps","placeholder","componentDidUpdate","prevProps","videoID","setState","componentDidMount","window","addEventListener","componentWillUnmount","removeEventListener","d","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","stepDescriptionList","i","length","push","result","destination","source","items","sourceStepIndex","destinationStepIndex","steps","destinationOffset","sourceOffset","splice","context","flat","txt","oldWritingIndex","event","which","type","currentStepIndex","descIndexList","prevSiblingIndex","offset","prevStepDescIndexList","currentStepMode","curretnStepIndex","newStepIndex","preventDefault","shiftKey","oldIndex","oldItemIsRemoved","newIndex","stateItems","descriptionKey","itemIndex","indexOf","parseInt","console","log","undefined","itemsState","mLevel","newItemIndex","newItems","currentStepLevel","desIndexList","action","indexList","forEach","includes","saveUserData","fileName"],"mappings":"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","sourcesContent":["import React from \"react\";\n\nimport \"./DescriptionPane.css\";\nimport { DragDropContext, Draggable, Droppable } from \"react-beautiful-dnd\";\n\nimport StepDescription from \"./StepDescription\";\nimport { sendDataToServer } from \"../apiCalls\";\n\nexport default class DescriptionPane extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.counter = 0;\n\t\tthis.sessionTime = \"\";\n\t\tthis.state = {\n\t\t\tdescriptions: [\n\t\t\t\t{ key: 0, mode: \"writing\", level: 1, selected: true, text: \"\" },\n\t\t\t],\n\t\t};\n\t\tthis.counter += 1;\n\n\t\tthis.setModeByKey = this.setModeByKey.bind(this);\n\t\tthis.getMode = this.getMode.bind(this);\n\t\tthis.addStepAfter = this.addStepAfter.bind(this);\n\t\tthis.removeWritingStep = this.removeWritingStep.bind(this);\n\t\tthis.getSelected = this.getSelected.bind(this);\n\t\tthis.getWritingStep = this.getWritingStep.bind(this);\n\t\tthis.deselectAll = this.deselectAll.bind(this);\n\t\tthis.getIndex = this.getIndex.bind(this);\n\t\tthis.getWritingIndex = this.getWritingIndex.bind(this);\n\t\tthis.removeItem = this.removeItem.bind(this);\n\t\tthis.updateDescendents = this.updateDescendents.bind(this);\n\t\tthis.getDescendents = this.getDescendents.bind(this);\n\t\tthis.deleteItems = this.deleteItems.bind(this);\n\t\tthis.getPrevSibling = this.getPrevSibling.bind(this);\n\t\tthis.groupDescriptions = this.groupDescriptions.bind(this);\n\t\tthis.getSessionTime = this.getSessionTime.bind(this);\n\n\t\tthis.handleSingleClick = this.handleSingleClick.bind(this);\n\t\tthis.handleBlur = this.handleBlur.bind(this);\n\t\tthis.handleKeyAction = this.handleKeyAction.bind(this);\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\n\t\tthis.handleWindowResize = this.handleWindowResize.bind(this);\n\t}\n\n\trender() {\n\t\tif (this.counter === 2) {\n\t\t\tthis.sessionTime = this.getSessionTime();\n\t\t}\n\n\t\tlet descriptionListG = this.groupDescriptions([...this.state.descriptions]);\n\n\t\tlet stepComponentsList = descriptionListG.map((stepList, index) => (\n\t\t\t<Draggable\n\t\t\t\tdraggableId={index.toString()}\n\t\t\t\tkey={index.toString()}\n\t\t\t\tindex={index}>\n\t\t\t\t{(provided) => (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={index.toString()}\n\t\t\t\t\t\tid={index.toString()}\n\t\t\t\t\t\tclassName=\"step-div\"\n\t\t\t\t\t\t{...provided.draggableProps}\n\t\t\t\t\t\t{...provided.dragHandleProps}\n\t\t\t\t\t\tref={provided.innerRef}>\n\t\t\t\t\t\t{stepList.map((item, index) => (\n\t\t\t\t\t\t\t<StepDescription\n\t\t\t\t\t\t\t\tid={item.key.toString()}\n\t\t\t\t\t\t\t\tkey={item.key.toString()}\n\t\t\t\t\t\t\t\tonSingleClick={this.handleSingleClick}\n\t\t\t\t\t\t\t\tonDoubleClick={this.handleDoubleClick}\n\t\t\t\t\t\t\t\tonBlur={this.handleBlur}\n\t\t\t\t\t\t\t\tonKeyPress={this.handleKeyAction}\n\t\t\t\t\t\t\t\titem={item}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</Draggable>\n\t\t));\n\n\t\treturn (\n\t\t\t<DragDropContext onDragEnd={this.handleDragEnd}>\n\t\t\t\t<Droppable droppableId=\"description-pane-droppable\">\n\t\t\t\t\t{(provided) => (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid=\"description-pane-droppable-div\"\n\t\t\t\t\t\t\tstyle={{ width: this.props.width, height: this.props.height }}\n\t\t\t\t\t\t\tref={provided.innerRef}\n\t\t\t\t\t\t\t{...provided.droppableProps}>\n\t\t\t\t\t\t\t{stepComponentsList}\n\t\t\t\t\t\t\t{provided.placeholder}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</Droppable>\n\t\t\t</DragDropContext>\n\t\t);\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif (prevProps.videoID !== this.props.videoID) {\n\t\t\tthis.setState({\n\t\t\t\tdescriptions: [\n\t\t\t\t\t{ key: 0, mode: \"writing\", level: 1, selected: true, text: \"\" },\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener(\"resize\", this.handleWindowResize);\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"resize\", this.handleWindowResize);\n\t}\n\n\thandleWindowResize() {\n\t\t// const windowWidth = window.innerWidth;\n\t\t// const windowHeight = window.innerHeight;\n\t\t// if (windowWidth < 1600) {\n\t\t//     let paneContainer = document.getElementById(\"description-pane-container\");\n\t\t// \tpaneContainer.style.width = 490;\n\t\t// } else {\n\t\t// \tlet paneContainer = document.getElementById(\"description-pane-container\");\n\t\t// \tpaneContainer.style.width = 550;\n\t\t// }\n\t\t// console.log(\"width: \", windowWidth);\n\t\t// console.log(\"height: \", windowHeight);\n\t}\n\n\tgetSessionTime() {\n\t\tlet d = new Date();\n\t\tconst sessionTime = `${d.getFullYear()}-${d.getMonth() + 1\n\t\t\t}-${d.getDate()}-${d.getHours()}-${d.getMinutes()}-${d.getSeconds()}`;\n\t\treturn sessionTime;\n\t}\n\n\tgroupDescriptions(descriptions) {\n\t\tlet descriptionListG = [];\n\t\tlet stepDescriptionList = [];\n\t\tfor (let i = 0; i < descriptions.length; i++) {\n\t\t\t// new step\n\t\t\tif (descriptions[i].level === 1) {\n\t\t\t\tif (stepDescriptionList.length) {\n\t\t\t\t\tdescriptionListG.push(stepDescriptionList);\n\t\t\t\t}\n\t\t\t\tstepDescriptionList = [descriptions[i]];\n\t\t\t} else {\n\t\t\t\t// descendents\n\t\t\t\tstepDescriptionList.push(descriptions[i]);\n\t\t\t}\n\t\t\tif (i === descriptions.length - 1) {\n\t\t\t\tif (stepDescriptionList.length) {\n\t\t\t\t\tdescriptionListG.push(stepDescriptionList);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn descriptionListG;\n\t}\n\n\thandleDragEnd(result) {\n\t\tif (result.destination == null) return;\n\t\tif (result.destination.index === result.source.index) return;\n\n\t\tlet items = [...this.state.descriptions];\n\t\t// step-set level index\n\t\tconst sourceStepIndex = result.source.index;\n\t\tconst destinationStepIndex = result.destination.index;\n\n\t\tlet steps = this.groupDescriptions(items);\n\t\tlet destinationOffset = destinationStepIndex > sourceStepIndex ? 1 : 0;\n\t\tlet sourceOffset = destinationStepIndex > sourceStepIndex ? 0 : 1;\n\n\t\t// move a copy of source step into the new location\n\t\tsteps.splice(destinationStepIndex + destinationOffset, 0, steps[sourceStepIndex]);\n\t\t// remove the old copy of source step\n\t\tsteps.splice(sourceStepIndex + sourceOffset, 1);\n\t\tsendDataToServer(items, this.sessionTime, this.props.videoID, this.context);\n\t\tthis.setState({ descriptions: steps.flat() });\n\t}\n\n\thandleSingleClick(key, txt) {\n\t\tlet items = [...this.state.descriptions];\n\t\tif (txt !== \"\") {\n\t\t\tlet index = this.getIndex(items, key, 0);\n\t\t\tconst oldWritingIndex = this.getWritingIndex(items);\n\t\t\tif (oldWritingIndex >= 0) {\n\t\t\t\titems[oldWritingIndex].mode = \"not_writing\";\n\t\t\t}\n\t\t\titems[index].mode = \"writing\";\n\t\t\titems = this.deselectAll(items);\n\t\t\titems[index].selected = true;\n\t\t\tthis.setState({ descriptions: items });\n\t\t}\n\t}\n\n\thandleBlur(key, txt) {\n\t\tlet items = [...this.state.descriptions];\n\t\tif (txt !== \"\") {\n\t\t\tconst index = this.getIndex(items, key, 0);\n\t\t\titems[index].mode = \"not_writing\";\n\t\t\titems[index].text = txt;\n\t\t} else if (txt === \"\" && items.length > 1) {\n\t\t\titems = this.removeWritingStep(items);\n\t\t}\n\t\t//sendDataToServer(items, this.sessionTime, this.props.videoID, this.props.user);\n\t\tthis.setState({ descriptions: items });\n\t}\n\n\thandleKeyAction(key, txt, event) {\n\t\tlet items = [...this.state.descriptions];\n\n\t\t// del --> delete step\n\t\tif (event.which === 46 || (event.type === \"click\" && txt === \"close_btn\")) {\n\t\t\tlet currentStepIndex = null;\n\t\t\tif (key === null) {\n\t\t\t\t// delete (window listener)\n\t\t\t\tcurrentStepIndex = this.getSelected(items);\n\t\t\t} else {\n\t\t\t\t// delete (<input> listener)\n\t\t\t\tcurrentStepIndex = this.getIndex(items, key, 0);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(items[currentStepIndex].selected ||\n\t\t\t\t\t(event.type === \"click\" && txt === \"close_btn\")) &&\n\t\t\t\titems.length >= 2\n\t\t\t) {\n\t\t\t\t// select the previous/next step\n\t\t\t\titems = this.deselectAll(items);\n\t\t\t\tconst descIndexList = this.getDescendents(items, currentStepIndex);\n\t\t\t\tif (currentStepIndex === 0) {\n\t\t\t\t\titems[currentStepIndex + descIndexList.length].selected = true;\n\t\t\t\t} else {\n\t\t\t\t\tconst prevSiblingIndex = this.getPrevSibling(items, currentStepIndex);\n\t\t\t\t\tlet offset = 1;\n\t\t\t\t\tif (!(prevSiblingIndex == null)) {\n\t\t\t\t\t\tconst prevStepDescIndexList = this.getDescendents(\n\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\tprevSiblingIndex\n\t\t\t\t\t\t);\n\t\t\t\t\t\toffset = prevStepDescIndexList.length;\n\t\t\t\t\t}\n\t\t\t\t\titems[currentStepIndex - offset].selected = true;\n\t\t\t\t}\n\t\t\t\t// do not delete everything\n\t\t\t\tif (descIndexList.length < items.length) {\n\t\t\t\t\titems = this.deleteItems(items, descIndexList);\n\t\t\t\t\tsendDataToServer(\n\t\t\t\t\t\titems,\n\t\t\t\t\t\tthis.sessionTime,\n\t\t\t\t\t\tthis.props.videoID,\n\t\t\t\t\t\tthis.context\n\t\t\t\t\t);\n\t\t\t\t\tthis.setState({ descriptions: items });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Enter --> nex step (writing)\n\t\telse if (event.which === 13 && txt !== \"\") {\n\t\t\tconst currentStepMode = this.getMode(items, key, 0);\n\t\t\tconst curretnStepIndex = this.getIndex(items, key, 0);\n\t\t\tlet newStepIndex = curretnStepIndex;\n\t\t\tif (\n\t\t\t\tcurrentStepMode === \"writing\" ||\n\t\t\t\t(currentStepMode === \"not_writing\" && items[curretnStepIndex].selected)\n\t\t\t) {\n\t\t\t\t// change the current step to non-writing and add one writing step after it\n\t\t\t\titems[curretnStepIndex].mode = \"not_writing\";\n\t\t\t\titems[curretnStepIndex].text = txt;\n\t\t\t\t// select the current step\n\t\t\t\titems = this.deselectAll(items);\n\t\t\t\t[items, newStepIndex] = this.addStepAfter(items, key, \"writing\", null);\n\t\t\t\titems[newStepIndex].selected = true;\n\t\t\t\titems[newStepIndex].mode = \"writing\";\n\t\t\t\tsendDataToServer(\n\t\t\t\t\titems,\n\t\t\t\t\tthis.sessionTime,\n\t\t\t\t\tthis.props.videoID,\n\t\t\t\t\tthis.context\n\t\t\t\t);\n\t\t\t\tthis.setState({ descriptions: items });\n\t\t\t}\n\t\t}\n\n\t\t// Tab or Shift + Tab\n\t\telse if (event.which === 9 || event.type === \"click\") {\n\t\t\tevent.preventDefault();\n\t\t\t// perform indention if it is writing\n\t\t\tconst currentStepIndex = this.getIndex(items, key, 0);\n\n\t\t\tif (currentStepIndex > 0) {\n\t\t\t\tconst descIndexList = this.getDescendents(items, currentStepIndex);\n\t\t\t\t// only tab\n\t\t\t\tif (!event.shiftKey || txt === \"indent_btn\") {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(items[currentStepIndex].mode === \"writing\" ||\n\t\t\t\t\t\t\ttxt === \"indent_btn\") &&\n\t\t\t\t\t\titems.length > 1\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\titems[currentStepIndex - 1].level >=\n\t\t\t\t\t\t\titems[currentStepIndex].level &&\n\t\t\t\t\t\t\titems[currentStepIndex].level <= 2\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\titems[currentStepIndex].level += 1;\n\t\t\t\t\t\t\titems = this.updateDescendents(\n\t\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\t\tdescIndexList,\n\t\t\t\t\t\t\t\t\"level_increase\"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tsendDataToServer(\n\t\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\t\tthis.sessionTime,\n\t\t\t\t\t\t\t\tthis.props.videoID,\n\t\t\t\t\t\t\t\tthis.context\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.setState({ descriptions: items });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (event.shiftKey || txt === \"outdent_btn\") {\n\t\t\t\t\t// shift + tab\n\t\t\t\t\tif (items[currentStepIndex].level >= 2) {\n\t\t\t\t\t\titems[currentStepIndex].level -= 1;\n\t\t\t\t\t\titems = this.updateDescendents(\n\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\tdescIndexList,\n\t\t\t\t\t\t\t\"level_decrease\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\tsendDataToServer(\n\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\tthis.sessionTime,\n\t\t\t\t\t\t\tthis.props.videoID,\n\t\t\t\t\t\t\tthis.context\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setState({ descriptions: items });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// down\n\t\telse if (event.which === 40) {\n\t\t\titems = [...this.state.descriptions];\n\t\t\tconst oldIndex = this.getIndex(items, key, 0);\n\n\t\t\t// can't go down\n\t\t\tif (oldIndex === items.length - 1) {\n\t\t\t\tthis.setState({ descriptions: items });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update the selected item\n\t\t\tif (txt !== \"\") {\n\t\t\t\t// keep the old item\n\t\t\t\titems[oldIndex].text = txt;\n\t\t\t\titems[oldIndex].selected = false;\n\t\t\t\titems[oldIndex].mode = \"not_writing\";\n\n\t\t\t\t// select the new item\n\t\t\t\titems[oldIndex + 1].selected = true;\n\t\t\t\titems[oldIndex + 1].mode = \"writing\";\n\t\t\t} else {\n\t\t\t\t// must be removed\n\t\t\t\titems = this.removeItem(items, oldIndex);\n\n\t\t\t\t// select the new item\n\t\t\t\titems[oldIndex].selected = true;\n\t\t\t\titems[oldIndex].mode = \"writing\";\n\t\t\t}\n\t\t\tthis.setState({ descriptions: items });\n\t\t}\n\n\t\t// up\n\t\telse if (event.which === 38) {\n\t\t\titems = [...this.state.descriptions];\n\t\t\tconst oldIndex = this.getIndex(items, key, 0);\n\n\t\t\t// can't go up\n\t\t\tif (oldIndex === 0) {\n\t\t\t\tthis.setState({ descriptions: items });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update the selected item\n\t\t\tif (txt !== \"\") {\n\t\t\t\t// keep the old item\n\t\t\t\titems[oldIndex].text = txt;\n\t\t\t\titems[oldIndex].selected = false;\n\t\t\t\titems[oldIndex].mode = \"not_writing\";\n\n\t\t\t\t// select the new item\n\t\t\t\titems[oldIndex - 1].selected = true;\n\t\t\t\titems[oldIndex - 1].mode = \"writing\";\n\t\t\t} else {\n\t\t\t\t// must be removed\n\t\t\t\titems = this.removeItem(items, oldIndex);\n\n\t\t\t\t// select the new item\n\t\t\t\titems[oldIndex - 1].selected = true;\n\t\t\t\titems[oldIndex - 1].mode = \"writing\";\n\t\t\t}\n\t\t\tthis.setState({ descriptions: items });\n\t\t} else if (event.which === 40 || event.which === 38) {\n\t\t\titems = [...this.state.descriptions];\n\t\t\tconst oldIndex = this.getIndex(items, key, 0);\n\n\t\t\tif (oldIndex === items.length - 1 && event.which === 40) return;\n\t\t\tif (oldIndex === 0 && event.which === 38) return;\n\n\t\t\t// take care of the old selected item\n\t\t\tlet oldItemIsRemoved = false;\n\t\t\tif (txt === \"\") {\n\t\t\t\tif (items.length > 1) {\n\t\t\t\t\t// should be  deleted\n\t\t\t\t\titems = this.removeItem(items, oldIndex);\n\t\t\t\t\toldItemIsRemoved = true;\n\t\t\t\t} else {\n\t\t\t\t\treturn; // length = 0 --> you cannot go to another item\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titems[oldIndex].text = txt;\n\t\t\t\titems[oldIndex].selected = false;\n\t\t\t\titems[oldIndex].mode = \"not_writing\";\n\t\t\t}\n\n\t\t\t// selected the new item (already know that items.length > 1)\n\t\t\tlet newIndex = oldIndex;\n\t\t\tif (event.which === 40) {\n\t\t\t\t// down\n\t\t\t\tif (!oldItemIsRemoved && oldIndex < items.length - 1) {\n\t\t\t\t\tnewIndex = oldIndex + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// up\n\t\t\t\tif (oldIndex > 0) newIndex = oldIndex - 1;\n\t\t\t}\n\t\t\titems = this.deselectAll(items);\n\t\t\titems[newIndex].selected = true;\n\t\t\titems[newIndex].mode = \"writing\";\n\t\t\tthis.setState({ descriptions: items });\n\t\t}\n\t}\n\n\tgetIndex(stateItems, descriptionKey, offset) {\n\t\tlet items = [...stateItems];\n\t\tlet itemIndex = items.map((item) => item.key).indexOf(parseInt(descriptionKey));\n\t\tif (itemIndex >= 0) {\n\t\t\treturn itemIndex + offset;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tgetWritingIndex(items) {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].mode === \"writing\") {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tsetModeByKey(stateItems, descriptionKey, mode) {\n\t\tlet items = [...stateItems];\n\t\tlet itemIndex = items.map((item) => item.key).indexOf(parseInt(descriptionKey));\n\t\tif (itemIndex >= 0) {\n\t\t\titems[itemIndex].mode = mode;\n\t\t} else {\n\t\t\tconsole.log(\"step description does not exist\");\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetMode(stateItems, descriptionKey, offset) {\n\t\tlet items = [...stateItems];\n\t\tlet itemIndex = items.map((item) => item.key).indexOf(parseInt(descriptionKey));\n\t\tif (items[itemIndex + offset] !== undefined) {\n\t\t\treturn items[itemIndex + offset].mode;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetSelected(items) {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].selected) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tgetWritingStep(items) {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].mode === \"writing\") {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tdeselectAll(items) {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].selected) {\n\t\t\t\titems[i].selected = false;\n\t\t\t}\n\t\t}\n\t\treturn items;\n\t}\n\n\taddStepAfter(itemsState, key, mode, level) {\n\t\tlet items = [...itemsState];\n\t\tlet itemIndex = items.map((item) => item.key).indexOf(parseInt(key));\n\t\t// add the new step\n\t\tlet mLevel = level;\n\t\tif (level === null) {\n\t\t\tmLevel = items[itemIndex].level;\n\t\t}\n\t\tconst descIndexList = this.getDescendents(items, itemIndex);\n\t\tlet newItemIndex = descIndexList[descIndexList.length - 1] + 1;\n\t\titems.splice(newItemIndex, 0, {\n\t\t\tkey: this.counter,\n\t\t\tmode: mode,\n\t\t\tlevel: mLevel,\n\t\t\tselected: true,\n\t\t\ttext: \"\",\n\t\t});\n\t\tthis.counter += 1;\n\n\t\treturn [items, newItemIndex];\n\t}\n\n\tremoveWritingStep(itemsState) {\n\t\tlet items = [...itemsState];\n\t\tlet newItems = [...items];\n\t\tfor (let i = 1; i < items.length; i++) {\n\t\t\tif (items[i].mode === \"writing\") {\n\t\t\t\tnewItems.splice(i, 1);\n\t\t\t\treturn newItems;\n\t\t\t}\n\t\t}\n\t\tconsole.log(\"Didn't find the item, to remove\");\n\t\treturn newItems;\n\t}\n\n\tremoveItem(items, index) {\n\t\titems.splice(index, 1);\n\t\treturn items;\n\t}\n\n\tgetDescendents(items, index) {\n\t\tlet descIndexList = [index];\n\t\tconst currentStepLevel = items[index].level;\n\t\tfor (let i = index + 1; i < items.length; i++) {\n\t\t\tif (items[i].level > currentStepLevel) {\n\t\t\t\tdescIndexList.push(i);\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn descIndexList;\n\t}\n\n\tupdateDescendents(items, desIndexList, action) {\n\t\tfor (let i = 1; i < desIndexList.length; i++) {\n\t\t\tif (action === \"level_increase\") {\n\t\t\t\titems[desIndexList[i]].level += 1;\n\t\t\t} else if (action === \"level_decrease\") {\n\t\t\t\titems[desIndexList[i]].level -= 1;\n\t\t\t}\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tdeleteItems(items, indexList) {\n\t\tlet newItems = [];\n\t\titems.forEach((item, index) => {\n\t\t\tif (!indexList.includes(index)) {\n\t\t\t\tnewItems.push(item);\n\t\t\t}\n\t\t});\n\t\treturn newItems;\n\t}\n\n\tgetPrevSibling(items, index) {\n\t\t// pre-condition: index > 0\n\t\tfor (let i = index - 1; i > 0; i--) {\n\t\t\tif (items[i].level < items[index].level) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tif (items[index].level === items[i].level) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsaveUserData(descriptions, fileName) {\n\t\t//const descriptionsJson = JSON.stringify(descriptions);\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}